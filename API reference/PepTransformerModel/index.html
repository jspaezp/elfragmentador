
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      <link rel="icon" href="../../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-8.5.10">
    
    
      
        <title>PepTransformerModel - ElFragmentador Documentation</title>
      
    
    
      <link rel="stylesheet" href="../../assets/stylesheets/main.975780f9.min.css">
      
        
        <link rel="stylesheet" href="../../assets/stylesheets/palette.2505c338.min.css">
        
      
      

    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      
  


  
  


  <script id="__analytics">function __md_analytics(){function n(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],n("js",new Date),n("config","G-QKEQ9R2MR7"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){this.value&&n("event","search",{search_term:this.value})}),document$.subscribe(function(){var a=document.forms.feedback;if(void 0!==a)for(var e of a.querySelectorAll("[type=submit]"))e.addEventListener("click",function(e){e.preventDefault();var t=document.location.pathname,e=this.getAttribute("data-md-value");n("event","feedback",{page:t,data:e}),a.firstElementChild.disabled=!0;e=a.querySelector(".md-feedback__note [data-md-value='"+e+"']");e&&(e.hidden=!1)}),a.hidden=!1}),location$.subscribe(function(e){n("config","G-QKEQ9R2MR7",{page_path:e.pathname})})});var e=document.createElement("script");e.async=!0,e.src="https://www.googletagmanager.com/gtag/js?id=G-QKEQ9R2MR7",document.getElementById("__analytics").insertAdjacentElement("afterEnd",e)}</script>

  
    <script>"undefined"!=typeof __md_analytics&&__md_analytics()</script>
  

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="None" data-md-color-accent="None">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#peptransformermodel" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../.." title="ElFragmentador Documentation" class="md-header__button md-logo" aria-label="ElFragmentador Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            ElFragmentador Documentation
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              PepTransformerModel
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../.." title="ElFragmentador Documentation" class="md-nav__button md-logo" aria-label="ElFragmentador Documentation" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    ElFragmentador Documentation
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../.." class="md-nav__link">
        Home
      </a>
    </li>
  

    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../quickstart/" class="md-nav__link">
        Quickstart
      </a>
    </li>
  

    
      
      
      

  
  
    
  
  
    
    <li class="md-nav__item md-nav__item--active md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_3" type="checkbox" id="__nav_3" checked>
      
      
      
      
        <label class="md-nav__link" for="__nav_3">
          API reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="API reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          API reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
    
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" data-md-toggle="toc" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          PepTransformerModel
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        PepTransformerModel
      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model" class="md-nav__link">
    model
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.LiteralFalse" class="md-nav__link">
    LiteralFalse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel" class="md-nav__link">
    PepTransformerModel
  </a>
  
    <nav class="md-nav" aria-label="PepTransformerModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.accepted_schedulers" class="md-nav__link">
    accepted_schedulers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.__version__" class="md-nav__link">
    __version__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.ms2ml_config" class="md-nav__link">
    ms2ml_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.NUM_FRAGMENT_EMBEDDINGS" class="md-nav__link">
    NUM_FRAGMENT_EMBEDDINGS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.main_model" class="md-nav__link">
    main_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.metric_calculator" class="md-nav__link">
    metric_calculator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.mse_loss" class="md-nav__link">
    mse_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.cosine_loss" class="md-nav__link">
    cosine_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.angle_loss" class="md-nav__link">
    angle_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.lr" class="md-nav__link">
    lr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.scheduler" class="md-nav__link">
    scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.lr_ratio" class="md-nav__link">
    lr_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.steps_per_epoch" class="md-nav__link">
    steps_per_epoch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.loss_ratio" class="md-nav__link">
    loss_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.irt_metric" class="md-nav__link">
    irt_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.loss_metric" class="md-nav__link">
    loss_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.spectra_metric" class="md-nav__link">
    spectra_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.spectra_metric2" class="md-nav__link">
    spectra_metric2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.summarize" class="md-nav__link">
    summarize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.predict_from_seq" class="md-nav__link">
    predict_from_seq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.torch_batch_from_seq" class="md-nav__link">
    torch_batch_from_seq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.to_torchscript" class="md-nav__link">
    to_torchscript()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.add_model_specific_args" class="md-nav__link">
    add_model_specific_args()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_plateau" class="md-nav__link">
    configure_scheduler_plateau()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_cosine" class="md-nav__link">
    configure_scheduler_cosine()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_oncecycle" class="md-nav__link">
    configure_scheduler_oncecycle()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_optimizers" class="md-nav__link">
    configure_optimizers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.plot_scheduler_lr" class="md-nav__link">
    plot_scheduler_lr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.training_step" class="md-nav__link">
    training_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_train_start" class="md-nav__link">
    on_train_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.validation_step" class="md-nav__link">
    validation_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.validation_epoch_end" class="md-nav__link">
    validation_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.test_step" class="md-nav__link">
    test_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.test_epoch_end" class="md-nav__link">
    test_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.predict_step" class="md-nav__link">
    predict_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_after_backward" class="md-nav__link">
    on_after_backward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_train_epoch_end" class="md-nav__link">
    on_train_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.load_from_checkpoint" class="md-nav__link">
    load_from_checkpoint()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.evaluate_landmark_rt" class="md-nav__link">
    evaluate_landmark_rt()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer" class="md-nav__link">
    peptransformer
  </a>
  
    <nav class="md-nav" aria-label="peptransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase" class="md-nav__link">
    PepTransformerBase
  </a>
  
    <nav class="md-nav" aria-label="PepTransformerBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.decoder" class="md-nav__link">
    decoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.irt_decoder" class="md-nav__link">
    irt_decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.predict_from_seq" class="md-nav__link">
    predict_from_seq()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers" class="md-nav__link">
    ms_transformer_layers
  </a>
  
    <nav class="md-nav" aria-label="ms_transformer_layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.CONFIG" class="md-nav__link">
    CONFIG
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder" class="md-nav__link">
    IRTDecoder
  </a>
  
    <nav class="md-nav" aria-label="IRTDecoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.aa_embed" class="md-nav__link">
    aa_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.decoder" class="md-nav__link">
    decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder" class="md-nav__link">
    PeptideTransformerEncoder
  </a>
  
    <nav class="md-nav" aria-label="PeptideTransformerEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.aa_embed" class="md-nav__link">
    aa_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder" class="md-nav__link">
    FragmentTransformerDecoder
  </a>
  
    <nav class="md-nav" aria-label="FragmentTransformerDecoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.charge_encoder" class="md-nav__link">
    charge_encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.nce_encoder" class="md-nav__link">
    nce_encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.init_weights" class="md-nav__link">
    init_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.preprocess_query" class="md-nav__link">
    preprocess_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding" class="md-nav__link">
    nn_encoding
  </a>
  
    <nav class="md-nav" aria-label="nn_encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.LiteralFalse" class="md-nav__link">
    LiteralFalse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder" class="md-nav__link">
    ConcatenationEncoder
  </a>
  
    <nav class="md-nav" aria-label="ConcatenationEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.static_size" class="md-nav__link">
    static_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.dims_add" class="md-nav__link">
    dims_add
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.scaling" class="md-nav__link">
    scaling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding" class="md-nav__link">
    FourierPositionalEncoding
  </a>
  
    <nav class="md-nav" aria-label="FourierPositionalEncoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.d_model" class="md-nav__link">
    d_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.static_size" class="md-nav__link">
    static_size
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.plot_encoding" class="md-nav__link">
    plot_encoding()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding" class="md-nav__link">
    AASequenceEmbedding
  </a>
  
    <nav class="md-nav" aria-label="AASequenceEmbedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_names" class="md-nav__link">
    aa_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_names" class="md-nav__link">
    mod_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.position_embed" class="md-nav__link">
    position_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_encoder" class="md-nav__link">
    aa_encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_encoder" class="md-nav__link">
    mod_encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.init_weights" class="md-nav__link">
    init_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.as_DataFrames" class="md-nav__link">
    as_DataFrames()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
        <input class="md-nav__toggle md-toggle" data-md-toggle="__nav_4" type="checkbox" id="__nav_4" >
      
      
      
      
        <label class="md-nav__link" for="__nav_4">
          CLI reference
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" aria-label="CLI reference" data-md-level="1">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          CLI reference
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../CLI%20reference/cli/" class="md-nav__link">
        Usage of the multiple command line interface options ...
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model" class="md-nav__link">
    model
  </a>
  
    <nav class="md-nav" aria-label="model">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.LiteralFalse" class="md-nav__link">
    LiteralFalse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel" class="md-nav__link">
    PepTransformerModel
  </a>
  
    <nav class="md-nav" aria-label="PepTransformerModel">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.accepted_schedulers" class="md-nav__link">
    accepted_schedulers
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.__version__" class="md-nav__link">
    __version__
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.ms2ml_config" class="md-nav__link">
    ms2ml_config
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.NUM_FRAGMENT_EMBEDDINGS" class="md-nav__link">
    NUM_FRAGMENT_EMBEDDINGS
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.main_model" class="md-nav__link">
    main_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.metric_calculator" class="md-nav__link">
    metric_calculator
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.mse_loss" class="md-nav__link">
    mse_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.cosine_loss" class="md-nav__link">
    cosine_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.angle_loss" class="md-nav__link">
    angle_loss
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.lr" class="md-nav__link">
    lr
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.scheduler" class="md-nav__link">
    scheduler
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.lr_ratio" class="md-nav__link">
    lr_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.steps_per_epoch" class="md-nav__link">
    steps_per_epoch
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.loss_ratio" class="md-nav__link">
    loss_ratio
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.irt_metric" class="md-nav__link">
    irt_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.loss_metric" class="md-nav__link">
    loss_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.spectra_metric" class="md-nav__link">
    spectra_metric
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.spectra_metric2" class="md-nav__link">
    spectra_metric2
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.summarize" class="md-nav__link">
    summarize()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.predict_from_seq" class="md-nav__link">
    predict_from_seq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.torch_batch_from_seq" class="md-nav__link">
    torch_batch_from_seq()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.to_torchscript" class="md-nav__link">
    to_torchscript()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.add_model_specific_args" class="md-nav__link">
    add_model_specific_args()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_plateau" class="md-nav__link">
    configure_scheduler_plateau()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_cosine" class="md-nav__link">
    configure_scheduler_cosine()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_scheduler_oncecycle" class="md-nav__link">
    configure_scheduler_oncecycle()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.configure_optimizers" class="md-nav__link">
    configure_optimizers()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.plot_scheduler_lr" class="md-nav__link">
    plot_scheduler_lr()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.training_step" class="md-nav__link">
    training_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_train_start" class="md-nav__link">
    on_train_start()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.validation_step" class="md-nav__link">
    validation_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.validation_epoch_end" class="md-nav__link">
    validation_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.test_step" class="md-nav__link">
    test_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.test_epoch_end" class="md-nav__link">
    test_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.predict_step" class="md-nav__link">
    predict_step()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_after_backward" class="md-nav__link">
    on_after_backward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.on_train_epoch_end" class="md-nav__link">
    on_train_epoch_end()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.PepTransformerModel.load_from_checkpoint" class="md-nav__link">
    load_from_checkpoint()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.evaluate_landmark_rt" class="md-nav__link">
    evaluate_landmark_rt()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer" class="md-nav__link">
    peptransformer
  </a>
  
    <nav class="md-nav" aria-label="peptransformer">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase" class="md-nav__link">
    PepTransformerBase
  </a>
  
    <nav class="md-nav" aria-label="PepTransformerBase">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.decoder" class="md-nav__link">
    decoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.irt_decoder" class="md-nav__link">
    irt_decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.peptransformer.PepTransformerBase.predict_from_seq" class="md-nav__link">
    predict_from_seq()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers" class="md-nav__link">
    ms_transformer_layers
  </a>
  
    <nav class="md-nav" aria-label="ms_transformer_layers">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.CONFIG" class="md-nav__link">
    CONFIG
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder" class="md-nav__link">
    IRTDecoder
  </a>
  
    <nav class="md-nav" aria-label="IRTDecoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.aa_embed" class="md-nav__link">
    aa_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.decoder" class="md-nav__link">
    decoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.IRTDecoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder" class="md-nav__link">
    PeptideTransformerEncoder
  </a>
  
    <nav class="md-nav" aria-label="PeptideTransformerEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.aa_embed" class="md-nav__link">
    aa_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.encoder" class="md-nav__link">
    encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder" class="md-nav__link">
    FragmentTransformerDecoder
  </a>
  
    <nav class="md-nav" aria-label="FragmentTransformerDecoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.charge_encoder" class="md-nav__link">
    charge_encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.nce_encoder" class="md-nav__link">
    nce_encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.init_weights" class="md-nav__link">
    init_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.preprocess_query" class="md-nav__link">
    preprocess_query()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.ms_transformer_layers-functions" class="md-nav__link">
    Functions
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding" class="md-nav__link">
    nn_encoding
  </a>
  
    <nav class="md-nav" aria-label="nn_encoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.LiteralFalse" class="md-nav__link">
    LiteralFalse
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding-classes" class="md-nav__link">
    Classes
  </a>
  
    <nav class="md-nav" aria-label="Classes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder" class="md-nav__link">
    ConcatenationEncoder
  </a>
  
    <nav class="md-nav" aria-label="ConcatenationEncoder">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.static_size" class="md-nav__link">
    static_size
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.dims_add" class="md-nav__link">
    dims_add
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.scaling" class="md-nav__link">
    scaling
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.ConcatenationEncoder.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding" class="md-nav__link">
    FourierPositionalEncoding
  </a>
  
    <nav class="md-nav" aria-label="FourierPositionalEncoding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.d_model" class="md-nav__link">
    d_model
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.static_size" class="md-nav__link">
    static_size
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.FourierPositionalEncoding.plot_encoding" class="md-nav__link">
    plot_encoding()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding" class="md-nav__link">
    AASequenceEmbedding
  </a>
  
    <nav class="md-nav" aria-label="AASequenceEmbedding">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding-attributes" class="md-nav__link">
    Attributes
  </a>
  
    <nav class="md-nav" aria-label="Attributes">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_names" class="md-nav__link">
    aa_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_names" class="md-nav__link">
    mod_names
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.position_embed" class="md-nav__link">
    position_embed
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_encoder" class="md-nav__link">
    aa_encoder
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_encoder" class="md-nav__link">
    mod_encoder
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding-functions" class="md-nav__link">
    Functions
  </a>
  
    <nav class="md-nav" aria-label="Functions">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.init_weights" class="md-nav__link">
    init_weights()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.forward" class="md-nav__link">
    forward()
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#elfragmentador.model.nn_encoding.AASequenceEmbedding.as_DataFrames" class="md-nav__link">
    as_DataFrames()
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="peptransformermodel">PepTransformerModel</h1>


<div class="doc doc-object doc-module">



<h2 id="elfragmentador.model" class="doc doc-heading">
          <code>elfragmentador.model</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h3 id="elfragmentador.model-attributes">Attributes</h3>

<div class="doc doc-object doc-attribute">



<h4 id="elfragmentador.model.LiteralFalse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">LiteralFalse</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  </div>

</div>
<h3 id="elfragmentador.model-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.PepTransformerModel" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">PepTransformerModel</span><span class="p">(</span><span class="n">num_decoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">num_encoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span> <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">combine_embeds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">combine_encoders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">final_decoder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">,</span> <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.0001</span><span class="p">,</span> <span class="n">scheduler</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;plateau&#39;</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span> <span class="n">loss_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="pytorch_lightning">pl</span>.<span title="pytorch_lightning.LightningModule">LightningModule</span></code></p>

  
      <p>PepTransformerModel Predicts retention times and HCD spectra from peptides.</p>

  
      <p><strong>init</strong> Instantiates the class.</p>
<p>Generates a new instance of the PepTransformerModel</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>num_decoder_layers</code></td>
          <td class="doc-param-details">
            <p>int, optional
Number of layers in the transformer decoder, by default 6</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>6</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>num_encoder_layers</code></td>
          <td class="doc-param-details">
            <p>int, optional
Number of laters in the transformer encoder, by default 6</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>6</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>nhid</code></td>
          <td class="doc-param-details">
            <p>int, optional
Number of dimensions used in the feedforward networks inside
the transformer encoder and decoders, by default 2024</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>2024</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>d_model</code></td>
          <td class="doc-param-details">
            <p>int, optional
Number of features to pass to the transformer encoder.
The embedding transforms the input to this input, by default 516</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>516</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>nhead</code></td>
          <td class="doc-param-details">
            <p>int, optional
Number of multi-attention heads in the transformer, by default 4</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>4</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>dropout</code></td>
          <td class="doc-param-details">
            <p>float, optional
dropout, by default 0.1</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>0.1</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>combine_embeds</code></td>
          <td class="doc-param-details">
            <p>bool, optional
Whether the embeddings for modifications and sequences
should be shared for irt and fragment predictions</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>bool</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>True</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>combine_encoders</code></td>
          <td class="doc-param-details">
            <p>bool = True,
Whether the transformer encoders for for irt and
fragments should be shared.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>bool</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>True</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>lr</code></td>
          <td class="doc-param-details">
            <p>float, optional
Learning rate, by default 1e-4</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>0.0001</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>scheduler</code></td>
          <td class="doc-param-details">
            <p>str, optional
What scheduler to use, check the available ones with
<code>PepTransformerModel.accepted_schedulers</code>, by default "plateau"</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>&#39;plateau&#39;</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>lr_ratio</code></td>
          <td class="doc-param-details">
            <p>Union[float, int], optional
For cosine annealing:
Ratio of the initial learning rate to use with cosine annealing for
instance a lr or 1 and a ratio of 10 would have a minimum learning
rate of 0.1.</p>
<p>For onecycle:
Ratio of the initial lr and and maximum one,
for instance if lr is 0.1 and ratio is 10, the max learn rate
would be 1.0.</p>
<p>by default 200</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>200</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>steps_per_epoch</code></td>
          <td class="doc-param-details">
            <p>None, optional
expected number of steps per epoch, used internally to calculate
learning rates when using the oncecycle scheduler, by default None</p>
            <p>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>None</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>loss_ratio</code></td>
          <td class="doc-param-details">
            <p>float, optional
The ratio of the spectrum to retention time loss to use when adding
before passing to the optimizer. Higher values mean more weight to
spectra with respect to the retention time. By default 5</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>5</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-52"> 52</a></span>
<span class="normal"><a href="#__codelineno-0-53"> 53</a></span>
<span class="normal"><a href="#__codelineno-0-54"> 54</a></span>
<span class="normal"><a href="#__codelineno-0-55"> 55</a></span>
<span class="normal"><a href="#__codelineno-0-56"> 56</a></span>
<span class="normal"><a href="#__codelineno-0-57"> 57</a></span>
<span class="normal"><a href="#__codelineno-0-58"> 58</a></span>
<span class="normal"><a href="#__codelineno-0-59"> 59</a></span>
<span class="normal"><a href="#__codelineno-0-60"> 60</a></span>
<span class="normal"><a href="#__codelineno-0-61"> 61</a></span>
<span class="normal"><a href="#__codelineno-0-62"> 62</a></span>
<span class="normal"><a href="#__codelineno-0-63"> 63</a></span>
<span class="normal"><a href="#__codelineno-0-64"> 64</a></span>
<span class="normal"><a href="#__codelineno-0-65"> 65</a></span>
<span class="normal"><a href="#__codelineno-0-66"> 66</a></span>
<span class="normal"><a href="#__codelineno-0-67"> 67</a></span>
<span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>    <span class="n">num_decoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="n">num_encoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>    <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="n">combine_embeds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>    <span class="n">combine_encoders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="n">final_decoder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="n">lr</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">1e-4</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="n">scheduler</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;plateau&quot;</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="n">lr_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">|</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">200</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="n">steps_per_epoch</span><span class="p">:</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="n">loss_ratio</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span>
<a id="__codelineno-0-68" name="__codelineno-0-68"></a>    <span class="o">*</span><span class="n">args</span><span class="p">,</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="o">**</span><span class="n">kwargs</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a><span class="sd">    __init__ Instantiates the class.</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">    Generates a new instance of the PepTransformerModel</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        num_decoder_layers : int, optional</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            Number of layers in the transformer decoder, by default 6</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">        num_encoder_layers : int, optional</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">            Number of laters in the transformer encoder, by default 6</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        nhid : int, optional</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">            Number of dimensions used in the feedforward networks inside</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">            the transformer encoder and decoders, by default 2024</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        d_model : int, optional</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">            Number of features to pass to the transformer encoder.</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">            The embedding transforms the input to this input, by default 516</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        nhead : int, optional</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            Number of multi-attention heads in the transformer, by default 4</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        dropout : float, optional</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            dropout, by default 0.1</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        combine_embeds: bool, optional</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            Whether the embeddings for modifications and sequences</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">            should be shared for irt and fragment predictions</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">        combine_encoders: bool = True,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            Whether the transformer encoders for for irt and</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">            fragments should be shared.</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">        lr : float, optional</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">            Learning rate, by default 1e-4</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a><span class="sd">        scheduler : str, optional</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a><span class="sd">            What scheduler to use, check the available ones with</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a><span class="sd">            `PepTransformerModel.accepted_schedulers`, by default &quot;plateau&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a><span class="sd">        lr_ratio : Union[float, int], optional</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a><span class="sd">            For cosine annealing:</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a><span class="sd">            Ratio of the initial learning rate to use with cosine annealing for</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a><span class="sd">            instance a lr or 1 and a ratio of 10 would have a minimum learning</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a><span class="sd">            rate of 0.1.</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="sd">            For onecycle:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a><span class="sd">            Ratio of the initial lr and and maximum one,</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a><span class="sd">            for instance if lr is 0.1 and ratio is 10, the max learn rate</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="sd">            would be 1.0.</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="sd">            by default 200</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="sd">        steps_per_epoch : None, optional</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a><span class="sd">            expected number of steps per epoch, used internally to calculate</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="sd">            learning rates when using the oncecycle scheduler, by default None</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="sd">        loss_ratio: float, optional</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a><span class="sd">            The ratio of the spectrum to retention time loss to use when adding</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">            before passing to the optimizer. Higher values mean more weight to</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">            spectra with respect to the retention time. By default 5</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">ms2ml_config</span> <span class="o">=</span> <span class="n">CONFIG</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">NUM_FRAGMENT_EMBEDDINGS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms2ml_config</span><span class="o">.</span><span class="n">num_fragment_embeddings</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">save_hyperparameters</span><span class="p">()</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>        <span class="sa">f</span><span class="s2">&quot;num_decoder_layers </span><span class="si">{</span><span class="n">num_decoder_layers</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>        <span class="sa">f</span><span class="s2">&quot;num_encoder_layers </span><span class="si">{</span><span class="n">num_encoder_layers</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>        <span class="sa">f</span><span class="s2">&quot;nhid </span><span class="si">{</span><span class="n">nhid</span><span class="si">}</span><span class="s2"> d_model </span><span class="si">{</span><span class="n">d_model</span><span class="si">}</span><span class="s2"> &quot;</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>        <span class="sa">f</span><span class="s2">&quot;nhead </span><span class="si">{</span><span class="n">nhead</span><span class="si">}</span><span class="s2"> dropout </span><span class="si">{</span><span class="n">dropout</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>        <span class="sa">f</span><span class="s2">&quot;combined embeds </span><span class="si">{</span><span class="n">combine_embeds</span><span class="si">}</span><span class="s2"> combined encoders </span><span class="si">{</span><span class="n">combine_encoders</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a>    <span class="p">)</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span> <span class="o">=</span> <span class="n">PepTransformerBase</span><span class="p">(</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a>        <span class="n">num_fragments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NUM_FRAGMENT_EMBEDDINGS</span><span class="p">,</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>        <span class="n">num_decoder_layers</span><span class="o">=</span><span class="n">num_decoder_layers</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>        <span class="n">num_encoder_layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>        <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>        <span class="n">combine_embeds</span><span class="o">=</span><span class="n">combine_embeds</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>        <span class="n">combine_encoders</span><span class="o">=</span><span class="n">combine_encoders</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>        <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="p">)</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span> <span class="o">=</span> <span class="n">MetricCalculator</span><span class="p">()</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mse_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s2">&quot;none&quot;</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">cosine_loss</span> <span class="o">=</span> <span class="n">CosineLoss</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">angle_loss</span> <span class="o">=</span> <span class="n">SpectralAngleLoss</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-8</span><span class="p">)</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="c1"># Training related things</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">scheduler</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">accepted_schedulers</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>    <span class="p">),</span> <span class="sa">f</span><span class="s2">&quot;Passed scheduler &#39;</span><span class="si">{</span><span class="n">scheduler</span><span class="si">}</span><span class="s2"> is not one of </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">accepted_schedulers</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span> <span class="o">=</span> <span class="n">lr_ratio</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="n">steps_per_epoch</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_ratio</span> <span class="o">=</span> <span class="n">loss_ratio</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">irt_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric2</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.PepTransformerModel-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.accepted_schedulers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">accepted_schedulers</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;plateau&#39;</span><span class="p">,</span> <span class="s1">&#39;cosine&#39;</span><span class="p">,</span> <span class="s1">&#39;onecycle&#39;</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.__version__" class="doc doc-heading">
<code class="highlight language-python"><span class="n">__version__</span> <span class="o">=</span> <span class="n">elfragmentador</span><span class="o">.</span><span class="n">__version__</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-class-attribute"><code>class-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.ms2ml_config" class="doc doc-heading">
<code class="highlight language-python"><span class="n">ms2ml_config</span> <span class="o">=</span> <span class="n">CONFIG</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.NUM_FRAGMENT_EMBEDDINGS" class="doc doc-heading">
<code class="highlight language-python"><span class="n">NUM_FRAGMENT_EMBEDDINGS</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ms2ml_config</span><span class="o">.</span><span class="n">num_fragment_embeddings</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.main_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">main_model</span> <span class="o">=</span> <span class="n">PepTransformerBase</span><span class="p">(</span><span class="n">num_fragments</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">NUM_FRAGMENT_EMBEDDINGS</span><span class="p">,</span> <span class="n">num_decoder_layers</span><span class="o">=</span><span class="n">num_decoder_layers</span><span class="p">,</span> <span class="n">num_encoder_layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span> <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span> <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">combine_embeds</span><span class="o">=</span><span class="n">combine_embeds</span><span class="p">,</span> <span class="n">combine_encoders</span><span class="o">=</span><span class="n">combine_encoders</span><span class="p">,</span> <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.metric_calculator" class="doc doc-heading">
<code class="highlight language-python"><span class="n">metric_calculator</span> <span class="o">=</span> <span class="n">MetricCalculator</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.mse_loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mse_loss</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">MSELoss</span><span class="p">(</span><span class="n">reduction</span><span class="o">=</span><span class="s1">&#39;none&#39;</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.cosine_loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">cosine_loss</span> <span class="o">=</span> <span class="n">CosineLoss</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.angle_loss" class="doc doc-heading">
<code class="highlight language-python"><span class="n">angle_loss</span> <span class="o">=</span> <span class="n">SpectralAngleLoss</span><span class="p">(</span><span class="n">dim</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">eps</span><span class="o">=</span><span class="mf">1e-08</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.lr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lr</span> <span class="o">=</span> <span class="n">lr</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.scheduler" class="doc doc-heading">
<code class="highlight language-python"><span class="n">scheduler</span> <span class="o">=</span> <span class="n">scheduler</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.lr_ratio" class="doc doc-heading">
<code class="highlight language-python"><span class="n">lr_ratio</span> <span class="o">=</span> <span class="n">lr_ratio</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.steps_per_epoch" class="doc doc-heading">
<code class="highlight language-python"><span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="n">steps_per_epoch</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.loss_ratio" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss_ratio</span> <span class="o">=</span> <span class="n">loss_ratio</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.irt_metric" class="doc doc-heading">
<code class="highlight language-python"><span class="n">irt_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.loss_metric" class="doc doc-heading">
<code class="highlight language-python"><span class="n">loss_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.spectra_metric" class="doc doc-heading">
<code class="highlight language-python"><span class="n">spectra_metric</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.PepTransformerModel.spectra_metric2" class="doc doc-heading">
<code class="highlight language-python"><span class="n">spectra_metric2</span> <span class="o">=</span> <span class="n">MissingDataAverager</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.PepTransformerModel-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.summarize" class="doc doc-heading">
<code class="highlight language-python"><span class="n">summarize</span><span class="p">(</span><span class="n">max_depth</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="k">def</span> <span class="nf">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_depth</span><span class="o">=</span><span class="mi">3</span><span class="p">):</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="k">return</span> <span class="n">summarize</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">max_depth</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>    <span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>    <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a><span class="p">):</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span> <span class="n">nce</span><span class="o">=</span><span class="n">nce</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.predict_from_seq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict_from_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nce</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">as_spectrum</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span> <span class="o">|</span> <span class="n">Spectrum</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="k">def</span> <span class="nf">predict_from_seq</span><span class="p">(</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="n">seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="n">nce</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">as_spectrum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span> <span class="o">|</span> <span class="n">Spectrum</span><span class="p">:</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">predict_from_seq</span><span class="p">(</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>        <span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a>        <span class="n">nce</span><span class="o">=</span><span class="n">nce</span><span class="p">,</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>        <span class="n">as_spectrum</span><span class="o">=</span><span class="n">as_spectrum</span><span class="p">,</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.torch_batch_from_seq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">torch_batch_from_seq</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForwardBatch</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a><span class="k">def</span> <span class="nf">torch_batch_from_seq</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">ForwardBatch</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>    <span class="n">torch_batch_from_seq</span><span class="o">.</span><span class="vm">__doc__</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">return</span> <span class="n">torch_batch_from_seq</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.to_torchscript" class="doc doc-heading">
<code class="highlight language-python"><span class="n">to_torchscript</span><span class="p">()</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Convert the model to torchscript.</p>
<p>Example:</p>
<blockquote>
<blockquote>
<blockquote>
<p>model = PepTransformerModel()
ts = model.to_torchscript()
type(ts)
<class 'torch.jit._trace.TopLevelTracedModule'></p>
</blockquote>
</blockquote>
</blockquote>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span>
<span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span>
<span class="normal"><a href="#__codelineno-0-204">204</a></span>
<span class="normal"><a href="#__codelineno-0-205">205</a></span>
<span class="normal"><a href="#__codelineno-0-206">206</a></span>
<span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-196" name="__codelineno-0-196"></a><span class="k">def</span> <span class="nf">to_torchscript</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a><span class="sd">    Convert the model to torchscript.</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>
<a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="sd">    Example:</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a><span class="sd">    &gt;&gt;&gt; model = PepTransformerModel()</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a><span class="sd">    &gt;&gt;&gt; ts = model.to_torchscript()</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a><span class="sd">    &gt;&gt;&gt; type(ts)</span>
<a id="__codelineno-0-204" name="__codelineno-0-204"></a><span class="sd">    &lt;class &#39;torch.jit._trace.TopLevelTracedModule&#39;&gt;</span>
<a id="__codelineno-0-205" name="__codelineno-0-205"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-206" name="__codelineno-0-206"></a>    <span class="n">_fake_input_data_torchscript</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">torch_batch_from_seq</span><span class="p">(</span>
<a id="__codelineno-0-207" name="__codelineno-0-207"></a>        <span class="n">seq</span><span class="o">=</span><span class="s2">&quot;MYM[U:35]DIFIEDPEPTYDE&quot;</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span> <span class="n">nce</span><span class="o">=</span><span class="mf">27.0</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="p">)</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">backup_calculator</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="n">bkp_1</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">nce_encoder</span><span class="o">.</span><span class="n">static_size</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">nce_encoder</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">NUM_FRAGMENT_EMBEDDINGS</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>    <span class="n">bkp_2</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">charge_encoder</span><span class="o">.</span><span class="n">static_size</span>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">charge_encoder</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">NUM_FRAGMENT_EMBEDDINGS</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>    <span class="p">)</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>    <span class="n">script</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">to_torchscript</span><span class="p">(</span>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>        <span class="n">example_inputs</span><span class="o">=</span><span class="n">_fake_input_data_torchscript</span><span class="p">,</span> <span class="n">method</span><span class="o">=</span><span class="s2">&quot;trace&quot;</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="p">)</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">nce_encoder</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="n">bkp_1</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">decoder</span><span class="o">.</span><span class="n">charge_encoder</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="n">bkp_2</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">main_model</span><span class="o">.</span><span class="n">metric_calculator</span> <span class="o">=</span> <span class="n">backup_calculator</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="k">return</span> <span class="n">script</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.add_model_specific_args" class="doc doc-heading">
<code class="highlight language-python"><span class="n">add_model_specific_args</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">_ArgumentGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ArgumentGroup</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  
      <p>Add_model_specific_args Adds arguments to a parser.</p>
<p>It is used to add the command line arguments for the training/generation
of the model.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>parser</code></td>
          <td class="doc-param-details">
            <p>An argparser parser (anything that has the <code>.add_argument</code> method) to
which the arguments will be added</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="argparse._ArgumentGroup">_ArgumentGroup</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="argparse._ArgumentGroup">_ArgumentGroup</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>_ArgumentGroup, the same parser with the added arguments</p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span>
<span class="normal"><a href="#__codelineno-0-241">241</a></span>
<span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span>
<span class="normal"><a href="#__codelineno-0-250">250</a></span>
<span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span>
<span class="normal"><a href="#__codelineno-0-263">263</a></span>
<span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span>
<span class="normal"><a href="#__codelineno-0-297">297</a></span>
<span class="normal"><a href="#__codelineno-0-298">298</a></span>
<span class="normal"><a href="#__codelineno-0-299">299</a></span>
<span class="normal"><a href="#__codelineno-0-300">300</a></span>
<span class="normal"><a href="#__codelineno-0-301">301</a></span>
<span class="normal"><a href="#__codelineno-0-302">302</a></span>
<span class="normal"><a href="#__codelineno-0-303">303</a></span>
<span class="normal"><a href="#__codelineno-0-304">304</a></span>
<span class="normal"><a href="#__codelineno-0-305">305</a></span>
<span class="normal"><a href="#__codelineno-0-306">306</a></span>
<span class="normal"><a href="#__codelineno-0-307">307</a></span>
<span class="normal"><a href="#__codelineno-0-308">308</a></span>
<span class="normal"><a href="#__codelineno-0-309">309</a></span>
<span class="normal"><a href="#__codelineno-0-310">310</a></span>
<span class="normal"><a href="#__codelineno-0-311">311</a></span>
<span class="normal"><a href="#__codelineno-0-312">312</a></span>
<span class="normal"><a href="#__codelineno-0-313">313</a></span>
<span class="normal"><a href="#__codelineno-0-314">314</a></span>
<span class="normal"><a href="#__codelineno-0-315">315</a></span>
<span class="normal"><a href="#__codelineno-0-316">316</a></span>
<span class="normal"><a href="#__codelineno-0-317">317</a></span>
<span class="normal"><a href="#__codelineno-0-318">318</a></span>
<span class="normal"><a href="#__codelineno-0-319">319</a></span>
<span class="normal"><a href="#__codelineno-0-320">320</a></span>
<span class="normal"><a href="#__codelineno-0-321">321</a></span>
<span class="normal"><a href="#__codelineno-0-322">322</a></span>
<span class="normal"><a href="#__codelineno-0-323">323</a></span>
<span class="normal"><a href="#__codelineno-0-324">324</a></span>
<span class="normal"><a href="#__codelineno-0-325">325</a></span>
<span class="normal"><a href="#__codelineno-0-326">326</a></span>
<span class="normal"><a href="#__codelineno-0-327">327</a></span>
<span class="normal"><a href="#__codelineno-0-328">328</a></span>
<span class="normal"><a href="#__codelineno-0-329">329</a></span>
<span class="normal"><a href="#__codelineno-0-330">330</a></span>
<span class="normal"><a href="#__codelineno-0-331">331</a></span>
<span class="normal"><a href="#__codelineno-0-332">332</a></span>
<span class="normal"><a href="#__codelineno-0-333">333</a></span>
<span class="normal"><a href="#__codelineno-0-334">334</a></span>
<span class="normal"><a href="#__codelineno-0-335">335</a></span>
<span class="normal"><a href="#__codelineno-0-336">336</a></span>
<span class="normal"><a href="#__codelineno-0-337">337</a></span>
<span class="normal"><a href="#__codelineno-0-338">338</a></span>
<span class="normal"><a href="#__codelineno-0-339">339</a></span>
<span class="normal"><a href="#__codelineno-0-340">340</a></span>
<span class="normal"><a href="#__codelineno-0-341">341</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-230" name="__codelineno-0-230"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a><span class="k">def</span> <span class="nf">add_model_specific_args</span><span class="p">(</span><span class="n">parser</span><span class="p">:</span> <span class="n">_ArgumentGroup</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">_ArgumentGroup</span><span class="p">:</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a><span class="sd">    Add_model_specific_args Adds arguments to a parser.</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a><span class="sd">    It is used to add the command line arguments for the training/generation</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a><span class="sd">    of the model.</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a><span class="sd">        parser (_ArgumentGroup):</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a><span class="sd">            An argparser parser (anything that has the `.add_argument` method) to</span>
<a id="__codelineno-0-241" name="__codelineno-0-241"></a><span class="sd">            which the arguments will be added</span>
<a id="__codelineno-0-242" name="__codelineno-0-242"></a>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a><span class="sd">        _ArgumentGroup, the same parser with the added arguments</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>        <span class="s2">&quot;--num_queries&quot;</span><span class="p">,</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>        <span class="n">default</span><span class="o">=</span><span class="mi">150</span><span class="p">,</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-250" name="__codelineno-0-250"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Expected encoding length of the spectra&quot;</span><span class="p">,</span>
<a id="__codelineno-0-251" name="__codelineno-0-251"></a>    <span class="p">)</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>        <span class="s2">&quot;--num_decoder_layers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>        <span class="n">default</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of sub-encoder-layers in the encoder&quot;</span><span class="p">,</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>    <span class="p">)</span>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>        <span class="s2">&quot;--num_encoder_layers&quot;</span><span class="p">,</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>        <span class="n">default</span><span class="o">=</span><span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of sub-encoder-layers in the decoder&quot;</span><span class="p">,</span>
<a id="__codelineno-0-263" name="__codelineno-0-263"></a>    <span class="p">)</span>
<a id="__codelineno-0-264" name="__codelineno-0-264"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a>        <span class="s2">&quot;--nhid&quot;</span><span class="p">,</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a>        <span class="n">default</span><span class="o">=</span><span class="mi">1024</span><span class="p">,</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Dimension of the feedforward networks&quot;</span><span class="p">,</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a>    <span class="p">)</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a>        <span class="s2">&quot;--d_model&quot;</span><span class="p">,</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>        <span class="n">default</span><span class="o">=</span><span class="mi">516</span><span class="p">,</span>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a>        <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of input features to the transformer encoder&quot;</span><span class="p">,</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a>    <span class="p">)</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a>        <span class="s2">&quot;--nhead&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mi">12</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">int</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Number of attention heads&quot;</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a>    <span class="p">)</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--dropout&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">0.1</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a>        <span class="s2">&quot;--combine_embeds&quot;</span><span class="p">,</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a>        <span class="n">action</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">BooleanOptionalAction</span><span class="p">,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a>            <span class="s2">&quot;Whether the embeddings for aminoacid and modifications&quot;</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a>            <span class="s2">&quot; should be shared between the irt and fragment sections&quot;</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a>        <span class="p">),</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a>    <span class="p">)</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a>        <span class="s2">&quot;--combine_encoders&quot;</span><span class="p">,</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>        <span class="n">action</span><span class="o">=</span><span class="n">argparse</span><span class="o">.</span><span class="n">BooleanOptionalAction</span><span class="p">,</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>            <span class="s2">&quot;Whether the encoders for aminoacid and modifications&quot;</span>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>            <span class="s2">&quot; should be shared between the irt and fragment sections&quot;</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>        <span class="p">),</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>    <span class="p">)</span>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-297" name="__codelineno-0-297"></a>        <span class="s2">&quot;--final_decoder&quot;</span><span class="p">,</span>
<a id="__codelineno-0-298" name="__codelineno-0-298"></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;mlp&quot;</span><span class="p">,</span>
<a id="__codelineno-0-299" name="__codelineno-0-299"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-300" name="__codelineno-0-300"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-301" name="__codelineno-0-301"></a>            <span class="s2">&quot;What kind of final layer should the docer have to&quot;</span>
<a id="__codelineno-0-302" name="__codelineno-0-302"></a>            <span class="s2">&quot; output a single number, options are &#39;mlp&#39; and &#39;linear&#39;&quot;</span>
<a id="__codelineno-0-303" name="__codelineno-0-303"></a>        <span class="p">),</span>
<a id="__codelineno-0-304" name="__codelineno-0-304"></a>    <span class="p">)</span>
<a id="__codelineno-0-305" name="__codelineno-0-305"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--lr&quot;</span><span class="p">,</span> <span class="n">default</span><span class="o">=</span><span class="mf">1e-4</span><span class="p">,</span> <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">)</span>
<a id="__codelineno-0-306" name="__codelineno-0-306"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-307" name="__codelineno-0-307"></a>        <span class="s2">&quot;--scheduler&quot;</span><span class="p">,</span>
<a id="__codelineno-0-308" name="__codelineno-0-308"></a>        <span class="n">default</span><span class="o">=</span><span class="s2">&quot;plateau&quot;</span><span class="p">,</span>
<a id="__codelineno-0-309" name="__codelineno-0-309"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-310" name="__codelineno-0-310"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-311" name="__codelineno-0-311"></a>            <span class="s2">&quot;Scheduler to use during training, &quot;</span>
<a id="__codelineno-0-312" name="__codelineno-0-312"></a>            <span class="sa">f</span><span class="s2">&quot;either of </span><span class="si">{</span><span class="n">PepTransformerModel</span><span class="o">.</span><span class="n">accepted_schedulers</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-313" name="__codelineno-0-313"></a>        <span class="p">),</span>
<a id="__codelineno-0-314" name="__codelineno-0-314"></a>    <span class="p">)</span>
<a id="__codelineno-0-315" name="__codelineno-0-315"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-316" name="__codelineno-0-316"></a>        <span class="s2">&quot;--lr_ratio&quot;</span><span class="p">,</span>
<a id="__codelineno-0-317" name="__codelineno-0-317"></a>        <span class="n">default</span><span class="o">=</span><span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-0-318" name="__codelineno-0-318"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-319" name="__codelineno-0-319"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-320" name="__codelineno-0-320"></a>            <span class="s2">&quot;For cosine annealing: &quot;</span>
<a id="__codelineno-0-321" name="__codelineno-0-321"></a>            <span class="s2">&quot;Ratio of the initial learning rate to use with cosine annealing&quot;</span>
<a id="__codelineno-0-322" name="__codelineno-0-322"></a>            <span class="s2">&quot; for instance a lr or 1 and a ratio of 10 would have a minimum&quot;</span>
<a id="__codelineno-0-323" name="__codelineno-0-323"></a>            <span class="s2">&quot; learning rate of 0.1</span><span class="se">\n</span><span class="s2">&quot;</span>
<a id="__codelineno-0-324" name="__codelineno-0-324"></a>            <span class="s2">&quot;For onecycle: &quot;</span>
<a id="__codelineno-0-325" name="__codelineno-0-325"></a>            <span class="s2">&quot;Ratio of the initial lr and and maximum one, &quot;</span>
<a id="__codelineno-0-326" name="__codelineno-0-326"></a>            <span class="s2">&quot;for instance if lr is 0.1 and ratio is 10, the max learn rate&quot;</span>
<a id="__codelineno-0-327" name="__codelineno-0-327"></a>            <span class="s2">&quot;would be 1.0&quot;</span>
<a id="__codelineno-0-328" name="__codelineno-0-328"></a>        <span class="p">),</span>
<a id="__codelineno-0-329" name="__codelineno-0-329"></a>    <span class="p">)</span>
<a id="__codelineno-0-330" name="__codelineno-0-330"></a>    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span>
<a id="__codelineno-0-331" name="__codelineno-0-331"></a>        <span class="s2">&quot;--loss_ratio&quot;</span><span class="p">,</span>
<a id="__codelineno-0-332" name="__codelineno-0-332"></a>        <span class="n">default</span><span class="o">=</span><span class="mf">5.0</span><span class="p">,</span>
<a id="__codelineno-0-333" name="__codelineno-0-333"></a>        <span class="nb">type</span><span class="o">=</span><span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-334" name="__codelineno-0-334"></a>        <span class="n">help</span><span class="o">=</span><span class="p">(</span>
<a id="__codelineno-0-335" name="__codelineno-0-335"></a>            <span class="s2">&quot;Ratio between the retention time and the spectrum loss&quot;</span>
<a id="__codelineno-0-336" name="__codelineno-0-336"></a>            <span class="s2">&quot; (higher values mean more weight to the spectra loss&quot;</span>
<a id="__codelineno-0-337" name="__codelineno-0-337"></a>            <span class="s2">&quot; with respect to the retention time loss)&quot;</span>
<a id="__codelineno-0-338" name="__codelineno-0-338"></a>        <span class="p">),</span>
<a id="__codelineno-0-339" name="__codelineno-0-339"></a>    <span class="p">)</span>
<a id="__codelineno-0-340" name="__codelineno-0-340"></a>
<a id="__codelineno-0-341" name="__codelineno-0-341"></a>    <span class="k">return</span> <span class="n">parser</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.configure_scheduler_plateau" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_scheduler_plateau</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-343">343</a></span>
<span class="normal"><a href="#__codelineno-0-344">344</a></span>
<span class="normal"><a href="#__codelineno-0-345">345</a></span>
<span class="normal"><a href="#__codelineno-0-346">346</a></span>
<span class="normal"><a href="#__codelineno-0-347">347</a></span>
<span class="normal"><a href="#__codelineno-0-348">348</a></span>
<span class="normal"><a href="#__codelineno-0-349">349</a></span>
<span class="normal"><a href="#__codelineno-0-350">350</a></span>
<span class="normal"><a href="#__codelineno-0-351">351</a></span>
<span class="normal"><a href="#__codelineno-0-352">352</a></span>
<span class="normal"><a href="#__codelineno-0-353">353</a></span>
<span class="normal"><a href="#__codelineno-0-354">354</a></span>
<span class="normal"><a href="#__codelineno-0-355">355</a></span>
<span class="normal"><a href="#__codelineno-0-356">356</a></span>
<span class="normal"><a href="#__codelineno-0-357">357</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-343" name="__codelineno-0-343"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-344" name="__codelineno-0-344"></a><span class="k">def</span> <span class="nf">configure_scheduler_plateau</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">):</span>
<a id="__codelineno-0-345" name="__codelineno-0-345"></a>    <span class="k">assert</span> <span class="n">lr_ratio</span> <span class="o">&lt;</span> <span class="mi">1</span>
<a id="__codelineno-0-346" name="__codelineno-0-346"></a>    <span class="n">scheduler_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-347" name="__codelineno-0-347"></a>        <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">ReduceLROnPlateau</span><span class="p">(</span>
<a id="__codelineno-0-348" name="__codelineno-0-348"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-349" name="__codelineno-0-349"></a>            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;min&quot;</span><span class="p">,</span>
<a id="__codelineno-0-350" name="__codelineno-0-350"></a>            <span class="n">factor</span><span class="o">=</span><span class="n">lr_ratio</span><span class="p">,</span>
<a id="__codelineno-0-351" name="__codelineno-0-351"></a>            <span class="n">patience</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-352" name="__codelineno-0-352"></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-353" name="__codelineno-0-353"></a>        <span class="p">),</span>
<a id="__codelineno-0-354" name="__codelineno-0-354"></a>        <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;epoch&quot;</span><span class="p">,</span>
<a id="__codelineno-0-355" name="__codelineno-0-355"></a>        <span class="s2">&quot;monitor&quot;</span><span class="p">:</span> <span class="s2">&quot;val_l&quot;</span><span class="p">,</span>
<a id="__codelineno-0-356" name="__codelineno-0-356"></a>    <span class="p">}</span>
<a id="__codelineno-0-357" name="__codelineno-0-357"></a>    <span class="k">return</span> <span class="n">scheduler_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.configure_scheduler_cosine" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_scheduler_cosine</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">,</span> <span class="n">min_lr</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-359">359</a></span>
<span class="normal"><a href="#__codelineno-0-360">360</a></span>
<span class="normal"><a href="#__codelineno-0-361">361</a></span>
<span class="normal"><a href="#__codelineno-0-362">362</a></span>
<span class="normal"><a href="#__codelineno-0-363">363</a></span>
<span class="normal"><a href="#__codelineno-0-364">364</a></span>
<span class="normal"><a href="#__codelineno-0-365">365</a></span>
<span class="normal"><a href="#__codelineno-0-366">366</a></span>
<span class="normal"><a href="#__codelineno-0-367">367</a></span>
<span class="normal"><a href="#__codelineno-0-368">368</a></span>
<span class="normal"><a href="#__codelineno-0-369">369</a></span>
<span class="normal"><a href="#__codelineno-0-370">370</a></span>
<span class="normal"><a href="#__codelineno-0-371">371</a></span>
<span class="normal"><a href="#__codelineno-0-372">372</a></span>
<span class="normal"><a href="#__codelineno-0-373">373</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-359" name="__codelineno-0-359"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-360" name="__codelineno-0-360"></a><span class="k">def</span> <span class="nf">configure_scheduler_cosine</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">,</span> <span class="n">min_lr</span><span class="p">):</span>
<a id="__codelineno-0-361" name="__codelineno-0-361"></a>    <span class="k">assert</span> <span class="n">lr_ratio</span> <span class="o">&gt;</span> <span class="mi">1</span>
<a id="__codelineno-0-362" name="__codelineno-0-362"></a>    <span class="n">scheduler_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-363" name="__codelineno-0-363"></a>        <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">CosineAnnealingWarmRestarts</span><span class="p">(</span>
<a id="__codelineno-0-364" name="__codelineno-0-364"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-365" name="__codelineno-0-365"></a>            <span class="n">T_0</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-366" name="__codelineno-0-366"></a>            <span class="n">T_mult</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
<a id="__codelineno-0-367" name="__codelineno-0-367"></a>            <span class="n">eta_min</span><span class="o">=</span><span class="n">min_lr</span><span class="p">,</span>
<a id="__codelineno-0-368" name="__codelineno-0-368"></a>            <span class="n">last_epoch</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-369" name="__codelineno-0-369"></a>            <span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-370" name="__codelineno-0-370"></a>        <span class="p">),</span>
<a id="__codelineno-0-371" name="__codelineno-0-371"></a>        <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
<a id="__codelineno-0-372" name="__codelineno-0-372"></a>    <span class="p">}</span>
<a id="__codelineno-0-373" name="__codelineno-0-373"></a>    <span class="k">return</span> <span class="n">scheduler_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.configure_scheduler_oncecycle" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_scheduler_oncecycle</span><span class="p">(</span><span class="n">optimizer</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="p">,</span> <span class="n">learning_rate</span><span class="p">,</span> <span class="n">steps_per_epoch</span><span class="p">,</span> <span class="n">accumulate_grad_batches</span><span class="p">,</span> <span class="n">max_epochs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-staticmethod"><code>staticmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-375">375</a></span>
<span class="normal"><a href="#__codelineno-0-376">376</a></span>
<span class="normal"><a href="#__codelineno-0-377">377</a></span>
<span class="normal"><a href="#__codelineno-0-378">378</a></span>
<span class="normal"><a href="#__codelineno-0-379">379</a></span>
<span class="normal"><a href="#__codelineno-0-380">380</a></span>
<span class="normal"><a href="#__codelineno-0-381">381</a></span>
<span class="normal"><a href="#__codelineno-0-382">382</a></span>
<span class="normal"><a href="#__codelineno-0-383">383</a></span>
<span class="normal"><a href="#__codelineno-0-384">384</a></span>
<span class="normal"><a href="#__codelineno-0-385">385</a></span>
<span class="normal"><a href="#__codelineno-0-386">386</a></span>
<span class="normal"><a href="#__codelineno-0-387">387</a></span>
<span class="normal"><a href="#__codelineno-0-388">388</a></span>
<span class="normal"><a href="#__codelineno-0-389">389</a></span>
<span class="normal"><a href="#__codelineno-0-390">390</a></span>
<span class="normal"><a href="#__codelineno-0-391">391</a></span>
<span class="normal"><a href="#__codelineno-0-392">392</a></span>
<span class="normal"><a href="#__codelineno-0-393">393</a></span>
<span class="normal"><a href="#__codelineno-0-394">394</a></span>
<span class="normal"><a href="#__codelineno-0-395">395</a></span>
<span class="normal"><a href="#__codelineno-0-396">396</a></span>
<span class="normal"><a href="#__codelineno-0-397">397</a></span>
<span class="normal"><a href="#__codelineno-0-398">398</a></span>
<span class="normal"><a href="#__codelineno-0-399">399</a></span>
<span class="normal"><a href="#__codelineno-0-400">400</a></span>
<span class="normal"><a href="#__codelineno-0-401">401</a></span>
<span class="normal"><a href="#__codelineno-0-402">402</a></span>
<span class="normal"><a href="#__codelineno-0-403">403</a></span>
<span class="normal"><a href="#__codelineno-0-404">404</a></span>
<span class="normal"><a href="#__codelineno-0-405">405</a></span>
<span class="normal"><a href="#__codelineno-0-406">406</a></span>
<span class="normal"><a href="#__codelineno-0-407">407</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-375" name="__codelineno-0-375"></a><span class="nd">@staticmethod</span>
<a id="__codelineno-0-376" name="__codelineno-0-376"></a><span class="k">def</span> <span class="nf">configure_scheduler_oncecycle</span><span class="p">(</span>
<a id="__codelineno-0-377" name="__codelineno-0-377"></a>    <span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-378" name="__codelineno-0-378"></a>    <span class="n">lr_ratio</span><span class="p">,</span>
<a id="__codelineno-0-379" name="__codelineno-0-379"></a>    <span class="n">learning_rate</span><span class="p">,</span>
<a id="__codelineno-0-380" name="__codelineno-0-380"></a>    <span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-381" name="__codelineno-0-381"></a>    <span class="n">accumulate_grad_batches</span><span class="p">,</span>
<a id="__codelineno-0-382" name="__codelineno-0-382"></a>    <span class="n">max_epochs</span><span class="p">,</span>
<a id="__codelineno-0-383" name="__codelineno-0-383"></a><span class="p">):</span>
<a id="__codelineno-0-384" name="__codelineno-0-384"></a>    <span class="n">max_lr</span> <span class="o">=</span> <span class="n">learning_rate</span> <span class="o">*</span> <span class="n">lr_ratio</span>
<a id="__codelineno-0-385" name="__codelineno-0-385"></a>    <span class="n">spe</span> <span class="o">=</span> <span class="n">steps_per_epoch</span> <span class="o">//</span> <span class="n">accumulate_grad_batches</span>
<a id="__codelineno-0-386" name="__codelineno-0-386"></a>    <span class="n">pct_start</span> <span class="o">=</span> <span class="mf">0.3</span>
<a id="__codelineno-0-387" name="__codelineno-0-387"></a>
<a id="__codelineno-0-388" name="__codelineno-0-388"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span>
<a id="__codelineno-0-389" name="__codelineno-0-389"></a>        <span class="sa">f</span><span class="s2">&quot;&gt;&gt; Scheduler setup: max_lr </span><span class="si">{</span><span class="n">max_lr</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-390" name="__codelineno-0-390"></a>        <span class="sa">f</span><span class="s2">&quot;Max Epochs: </span><span class="si">{</span><span class="n">max_epochs</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-391" name="__codelineno-0-391"></a>        <span class="sa">f</span><span class="s2">&quot;Steps per epoch: </span><span class="si">{</span><span class="n">steps_per_epoch</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-392" name="__codelineno-0-392"></a>        <span class="sa">f</span><span class="s2">&quot;SPE (after accum grad batches) </span><span class="si">{</span><span class="n">spe</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-393" name="__codelineno-0-393"></a>        <span class="sa">f</span><span class="s2">&quot;Percent Warmup </span><span class="si">{</span><span class="n">pct_start</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-394" name="__codelineno-0-394"></a>        <span class="sa">f</span><span class="s2">&quot;Accumulate Batches </span><span class="si">{</span><span class="n">accumulate_grad_batches</span><span class="si">}</span><span class="s2">, &quot;</span>
<a id="__codelineno-0-395" name="__codelineno-0-395"></a>    <span class="p">)</span>
<a id="__codelineno-0-396" name="__codelineno-0-396"></a>
<a id="__codelineno-0-397" name="__codelineno-0-397"></a>    <span class="n">scheduler_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-398" name="__codelineno-0-398"></a>        <span class="s2">&quot;scheduler&quot;</span><span class="p">:</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">lr_scheduler</span><span class="o">.</span><span class="n">OneCycleLR</span><span class="p">(</span>
<a id="__codelineno-0-399" name="__codelineno-0-399"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">optimizer</span><span class="p">,</span>
<a id="__codelineno-0-400" name="__codelineno-0-400"></a>            <span class="n">max_lr</span><span class="o">=</span><span class="n">max_lr</span><span class="p">,</span>
<a id="__codelineno-0-401" name="__codelineno-0-401"></a>            <span class="n">epochs</span><span class="o">=</span><span class="n">max_epochs</span><span class="p">,</span>
<a id="__codelineno-0-402" name="__codelineno-0-402"></a>            <span class="n">pct_start</span><span class="o">=</span><span class="n">pct_start</span><span class="p">,</span>
<a id="__codelineno-0-403" name="__codelineno-0-403"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="n">spe</span><span class="p">,</span>
<a id="__codelineno-0-404" name="__codelineno-0-404"></a>        <span class="p">),</span>
<a id="__codelineno-0-405" name="__codelineno-0-405"></a>        <span class="s2">&quot;interval&quot;</span><span class="p">:</span> <span class="s2">&quot;step&quot;</span><span class="p">,</span>
<a id="__codelineno-0-406" name="__codelineno-0-406"></a>    <span class="p">}</span>
<a id="__codelineno-0-407" name="__codelineno-0-407"></a>    <span class="k">return</span> <span class="n">scheduler_dict</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.configure_optimizers" class="doc doc-heading">
<code class="highlight language-python"><span class="n">configure_optimizers</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">CosineAnnealingWarmRestarts</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span> <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OneCycleLR</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Configure_optimizers COnfigures the optimizers for training.</p>
<p>It is internally used by pytorch_lightning during training, so far I
implemented 3 options (set when making the module).</p>
<p>OneCycleLR seems to give the best results overall in the least amount
of time. The only tradeoff that I see is that resuming training does
not seem to be really easy.</p>
<p>Check the pytorch_lightning documentation to see how this is used in the
training loop</p>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code>tuple[list[<span title="torch.optim.adamw.AdamW">AdamW</span>], list[dict[str, <span title="torch.optim.lr_scheduler.ReduceLROnPlateau">ReduceLROnPlateau</span> | str]]] | tuple[list[<span title="torch.optim.adamw.AdamW">AdamW</span>], list[dict[str, <span title="torch.optim.lr_scheduler.CosineAnnealingWarmRestarts">CosineAnnealingWarmRestarts</span> | str]]] | tuple[list[<span title="torch.optim.adamw.AdamW">AdamW</span>], list[dict[str, <span title="torch.optim.lr_scheduler.OneCycleLR">OneCycleLR</span> | str]]]</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Two lists, one containing the optimizer and another contining the scheduler.</p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-409">409</a></span>
<span class="normal"><a href="#__codelineno-0-410">410</a></span>
<span class="normal"><a href="#__codelineno-0-411">411</a></span>
<span class="normal"><a href="#__codelineno-0-412">412</a></span>
<span class="normal"><a href="#__codelineno-0-413">413</a></span>
<span class="normal"><a href="#__codelineno-0-414">414</a></span>
<span class="normal"><a href="#__codelineno-0-415">415</a></span>
<span class="normal"><a href="#__codelineno-0-416">416</a></span>
<span class="normal"><a href="#__codelineno-0-417">417</a></span>
<span class="normal"><a href="#__codelineno-0-418">418</a></span>
<span class="normal"><a href="#__codelineno-0-419">419</a></span>
<span class="normal"><a href="#__codelineno-0-420">420</a></span>
<span class="normal"><a href="#__codelineno-0-421">421</a></span>
<span class="normal"><a href="#__codelineno-0-422">422</a></span>
<span class="normal"><a href="#__codelineno-0-423">423</a></span>
<span class="normal"><a href="#__codelineno-0-424">424</a></span>
<span class="normal"><a href="#__codelineno-0-425">425</a></span>
<span class="normal"><a href="#__codelineno-0-426">426</a></span>
<span class="normal"><a href="#__codelineno-0-427">427</a></span>
<span class="normal"><a href="#__codelineno-0-428">428</a></span>
<span class="normal"><a href="#__codelineno-0-429">429</a></span>
<span class="normal"><a href="#__codelineno-0-430">430</a></span>
<span class="normal"><a href="#__codelineno-0-431">431</a></span>
<span class="normal"><a href="#__codelineno-0-432">432</a></span>
<span class="normal"><a href="#__codelineno-0-433">433</a></span>
<span class="normal"><a href="#__codelineno-0-434">434</a></span>
<span class="normal"><a href="#__codelineno-0-435">435</a></span>
<span class="normal"><a href="#__codelineno-0-436">436</a></span>
<span class="normal"><a href="#__codelineno-0-437">437</a></span>
<span class="normal"><a href="#__codelineno-0-438">438</a></span>
<span class="normal"><a href="#__codelineno-0-439">439</a></span>
<span class="normal"><a href="#__codelineno-0-440">440</a></span>
<span class="normal"><a href="#__codelineno-0-441">441</a></span>
<span class="normal"><a href="#__codelineno-0-442">442</a></span>
<span class="normal"><a href="#__codelineno-0-443">443</a></span>
<span class="normal"><a href="#__codelineno-0-444">444</a></span>
<span class="normal"><a href="#__codelineno-0-445">445</a></span>
<span class="normal"><a href="#__codelineno-0-446">446</a></span>
<span class="normal"><a href="#__codelineno-0-447">447</a></span>
<span class="normal"><a href="#__codelineno-0-448">448</a></span>
<span class="normal"><a href="#__codelineno-0-449">449</a></span>
<span class="normal"><a href="#__codelineno-0-450">450</a></span>
<span class="normal"><a href="#__codelineno-0-451">451</a></span>
<span class="normal"><a href="#__codelineno-0-452">452</a></span>
<span class="normal"><a href="#__codelineno-0-453">453</a></span>
<span class="normal"><a href="#__codelineno-0-454">454</a></span>
<span class="normal"><a href="#__codelineno-0-455">455</a></span>
<span class="normal"><a href="#__codelineno-0-456">456</a></span>
<span class="normal"><a href="#__codelineno-0-457">457</a></span>
<span class="normal"><a href="#__codelineno-0-458">458</a></span>
<span class="normal"><a href="#__codelineno-0-459">459</a></span>
<span class="normal"><a href="#__codelineno-0-460">460</a></span>
<span class="normal"><a href="#__codelineno-0-461">461</a></span>
<span class="normal"><a href="#__codelineno-0-462">462</a></span>
<span class="normal"><a href="#__codelineno-0-463">463</a></span>
<span class="normal"><a href="#__codelineno-0-464">464</a></span>
<span class="normal"><a href="#__codelineno-0-465">465</a></span>
<span class="normal"><a href="#__codelineno-0-466">466</a></span>
<span class="normal"><a href="#__codelineno-0-467">467</a></span>
<span class="normal"><a href="#__codelineno-0-468">468</a></span>
<span class="normal"><a href="#__codelineno-0-469">469</a></span>
<span class="normal"><a href="#__codelineno-0-470">470</a></span>
<span class="normal"><a href="#__codelineno-0-471">471</a></span>
<span class="normal"><a href="#__codelineno-0-472">472</a></span>
<span class="normal"><a href="#__codelineno-0-473">473</a></span>
<span class="normal"><a href="#__codelineno-0-474">474</a></span>
<span class="normal"><a href="#__codelineno-0-475">475</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-409" name="__codelineno-0-409"></a><span class="k">def</span> <span class="nf">configure_optimizers</span><span class="p">(</span>
<a id="__codelineno-0-410" name="__codelineno-0-410"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-411" name="__codelineno-0-411"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="p">(</span>
<a id="__codelineno-0-412" name="__codelineno-0-412"></a>    <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">ReduceLROnPlateau</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span>
<a id="__codelineno-0-413" name="__codelineno-0-413"></a>    <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">CosineAnnealingWarmRestarts</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span>
<a id="__codelineno-0-414" name="__codelineno-0-414"></a>    <span class="o">|</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">list</span><span class="p">[</span><span class="n">AdamW</span><span class="p">],</span> <span class="nb">list</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">OneCycleLR</span> <span class="o">|</span> <span class="nb">str</span><span class="p">]]]</span>
<a id="__codelineno-0-415" name="__codelineno-0-415"></a><span class="p">):</span>
<a id="__codelineno-0-416" name="__codelineno-0-416"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-417" name="__codelineno-0-417"></a><span class="sd">    Configure_optimizers COnfigures the optimizers for training.</span>
<a id="__codelineno-0-418" name="__codelineno-0-418"></a>
<a id="__codelineno-0-419" name="__codelineno-0-419"></a><span class="sd">    It is internally used by pytorch_lightning during training, so far I</span>
<a id="__codelineno-0-420" name="__codelineno-0-420"></a><span class="sd">    implemented 3 options (set when making the module).</span>
<a id="__codelineno-0-421" name="__codelineno-0-421"></a>
<a id="__codelineno-0-422" name="__codelineno-0-422"></a><span class="sd">    OneCycleLR seems to give the best results overall in the least amount</span>
<a id="__codelineno-0-423" name="__codelineno-0-423"></a><span class="sd">    of time. The only tradeoff that I see is that resuming training does</span>
<a id="__codelineno-0-424" name="__codelineno-0-424"></a><span class="sd">    not seem to be really easy.</span>
<a id="__codelineno-0-425" name="__codelineno-0-425"></a>
<a id="__codelineno-0-426" name="__codelineno-0-426"></a><span class="sd">    Check the pytorch_lightning documentation to see how this is used in the</span>
<a id="__codelineno-0-427" name="__codelineno-0-427"></a><span class="sd">    training loop</span>
<a id="__codelineno-0-428" name="__codelineno-0-428"></a>
<a id="__codelineno-0-429" name="__codelineno-0-429"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-430" name="__codelineno-0-430"></a><span class="sd">      Two lists, one containing the optimizer and another contining the scheduler.</span>
<a id="__codelineno-0-431" name="__codelineno-0-431"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-432" name="__codelineno-0-432"></a>    <span class="n">opt</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">optim</span><span class="o">.</span><span class="n">AdamW</span><span class="p">(</span>
<a id="__codelineno-0-433" name="__codelineno-0-433"></a>        <span class="nb">filter</span><span class="p">(</span><span class="k">lambda</span> <span class="n">p</span><span class="p">:</span> <span class="n">p</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">()),</span>
<a id="__codelineno-0-434" name="__codelineno-0-434"></a>        <span class="n">lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span>
<a id="__codelineno-0-435" name="__codelineno-0-435"></a>        <span class="n">betas</span><span class="o">=</span><span class="p">(</span><span class="mf">0.9</span><span class="p">,</span> <span class="mf">0.98</span><span class="p">),</span>
<a id="__codelineno-0-436" name="__codelineno-0-436"></a>    <span class="p">)</span>
<a id="__codelineno-0-437" name="__codelineno-0-437"></a>
<a id="__codelineno-0-438" name="__codelineno-0-438"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">==</span> <span class="s2">&quot;plateau&quot;</span><span class="p">:</span>
<a id="__codelineno-0-439" name="__codelineno-0-439"></a>        <span class="n">sched_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_scheduler_plateau</span><span class="p">(</span>
<a id="__codelineno-0-440" name="__codelineno-0-440"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span>
<a id="__codelineno-0-441" name="__codelineno-0-441"></a>        <span class="p">)</span>
<a id="__codelineno-0-442" name="__codelineno-0-442"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">==</span> <span class="s2">&quot;cosine&quot;</span><span class="p">:</span>
<a id="__codelineno-0-443" name="__codelineno-0-443"></a>        <span class="n">sched_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_scheduler_cosine</span><span class="p">(</span>
<a id="__codelineno-0-444" name="__codelineno-0-444"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span> <span class="n">lr_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span><span class="p">,</span> <span class="n">min_lr</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span>
<a id="__codelineno-0-445" name="__codelineno-0-445"></a>        <span class="p">)</span>
<a id="__codelineno-0-446" name="__codelineno-0-446"></a>    <span class="k">elif</span> <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span> <span class="o">==</span> <span class="s2">&quot;onecycle&quot;</span><span class="p">:</span>
<a id="__codelineno-0-447" name="__codelineno-0-447"></a>        <span class="k">assert</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_epoch</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">,</span> <span class="s2">&quot;Please set steps_per_epoch&quot;</span>
<a id="__codelineno-0-448" name="__codelineno-0-448"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_epochs</span> <span class="o">==</span> <span class="mi">1000</span><span class="p">:</span>
<a id="__codelineno-0-449" name="__codelineno-0-449"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span><span class="s2">&quot;Max epochs was 1000, make sure you want this&quot;</span><span class="p">)</span>
<a id="__codelineno-0-450" name="__codelineno-0-450"></a>        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span> <span class="o">&gt;</span> <span class="mi">20</span><span class="p">:</span>
<a id="__codelineno-0-451" name="__codelineno-0-451"></a>            <span class="n">warnings</span><span class="o">.</span><span class="n">warn</span><span class="p">(</span>
<a id="__codelineno-0-452" name="__codelineno-0-452"></a>                <span class="sa">f</span><span class="s2">&quot;Provided LR ratio &#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span><span class="si">}</span><span class="s2">&#39; seems a lil high,&quot;</span>
<a id="__codelineno-0-453" name="__codelineno-0-453"></a>                <span class="s2">&quot; make sure you want that for the OneCycleLR scheduler&quot;</span>
<a id="__codelineno-0-454" name="__codelineno-0-454"></a>            <span class="p">)</span>
<a id="__codelineno-0-455" name="__codelineno-0-455"></a>            <span class="n">time</span><span class="o">.</span><span class="n">sleep</span><span class="p">(</span><span class="mi">3</span><span class="p">)</span>  <span class="c1"># just so the user has time to see the message...</span>
<a id="__codelineno-0-456" name="__codelineno-0-456"></a>
<a id="__codelineno-0-457" name="__codelineno-0-457"></a>        <span class="n">sched_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_scheduler_oncecycle</span><span class="p">(</span>
<a id="__codelineno-0-458" name="__codelineno-0-458"></a>            <span class="n">optimizer</span><span class="o">=</span><span class="n">opt</span><span class="p">,</span>
<a id="__codelineno-0-459" name="__codelineno-0-459"></a>            <span class="n">lr_ratio</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr_ratio</span><span class="p">,</span>
<a id="__codelineno-0-460" name="__codelineno-0-460"></a>            <span class="n">learning_rate</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">lr</span><span class="p">,</span>
<a id="__codelineno-0-461" name="__codelineno-0-461"></a>            <span class="n">steps_per_epoch</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">steps_per_epoch</span><span class="p">,</span>
<a id="__codelineno-0-462" name="__codelineno-0-462"></a>            <span class="n">accumulate_grad_batches</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">accumulate_grad_batches</span><span class="p">,</span>
<a id="__codelineno-0-463" name="__codelineno-0-463"></a>            <span class="n">max_epochs</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_epochs</span><span class="p">,</span>
<a id="__codelineno-0-464" name="__codelineno-0-464"></a>        <span class="p">)</span>
<a id="__codelineno-0-465" name="__codelineno-0-465"></a>
<a id="__codelineno-0-466" name="__codelineno-0-466"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-467" name="__codelineno-0-467"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span>
<a id="__codelineno-0-468" name="__codelineno-0-468"></a>            <span class="s2">&quot;Scheduler should be one of &#39;plateau&#39; or &#39;cosine&#39;, passed: &quot;</span><span class="p">,</span>
<a id="__codelineno-0-469" name="__codelineno-0-469"></a>            <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="p">,</span>
<a id="__codelineno-0-470" name="__codelineno-0-470"></a>        <span class="p">)</span>
<a id="__codelineno-0-471" name="__codelineno-0-471"></a>    <span class="c1"># TODO check if using different optimizers for different parts of the</span>
<a id="__codelineno-0-472" name="__codelineno-0-472"></a>    <span class="c1"># model would work better</span>
<a id="__codelineno-0-473" name="__codelineno-0-473"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="s2">&gt;&gt;&gt; Setting up schedulers:</span><span class="se">\n\n</span><span class="si">{</span><span class="n">sched_dict</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-474" name="__codelineno-0-474"></a>
<a id="__codelineno-0-475" name="__codelineno-0-475"></a>    <span class="k">return</span> <span class="p">[</span><span class="n">opt</span><span class="p">],</span> <span class="p">[</span><span class="n">sched_dict</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.plot_scheduler_lr" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_scheduler_lr</span><span class="p">()</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Plot the learning rate of the scheduler.</p>
<p>This is useful to see how the learning rate changes during training,
and to make sure that the scheduler is working as intended.</p>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-477">477</a></span>
<span class="normal"><a href="#__codelineno-0-478">478</a></span>
<span class="normal"><a href="#__codelineno-0-479">479</a></span>
<span class="normal"><a href="#__codelineno-0-480">480</a></span>
<span class="normal"><a href="#__codelineno-0-481">481</a></span>
<span class="normal"><a href="#__codelineno-0-482">482</a></span>
<span class="normal"><a href="#__codelineno-0-483">483</a></span>
<span class="normal"><a href="#__codelineno-0-484">484</a></span>
<span class="normal"><a href="#__codelineno-0-485">485</a></span>
<span class="normal"><a href="#__codelineno-0-486">486</a></span>
<span class="normal"><a href="#__codelineno-0-487">487</a></span>
<span class="normal"><a href="#__codelineno-0-488">488</a></span>
<span class="normal"><a href="#__codelineno-0-489">489</a></span>
<span class="normal"><a href="#__codelineno-0-490">490</a></span>
<span class="normal"><a href="#__codelineno-0-491">491</a></span>
<span class="normal"><a href="#__codelineno-0-492">492</a></span>
<span class="normal"><a href="#__codelineno-0-493">493</a></span>
<span class="normal"><a href="#__codelineno-0-494">494</a></span>
<span class="normal"><a href="#__codelineno-0-495">495</a></span>
<span class="normal"><a href="#__codelineno-0-496">496</a></span>
<span class="normal"><a href="#__codelineno-0-497">497</a></span>
<span class="normal"><a href="#__codelineno-0-498">498</a></span>
<span class="normal"><a href="#__codelineno-0-499">499</a></span>
<span class="normal"><a href="#__codelineno-0-500">500</a></span>
<span class="normal"><a href="#__codelineno-0-501">501</a></span>
<span class="normal"><a href="#__codelineno-0-502">502</a></span>
<span class="normal"><a href="#__codelineno-0-503">503</a></span>
<span class="normal"><a href="#__codelineno-0-504">504</a></span>
<span class="normal"><a href="#__codelineno-0-505">505</a></span>
<span class="normal"><a href="#__codelineno-0-506">506</a></span>
<span class="normal"><a href="#__codelineno-0-507">507</a></span>
<span class="normal"><a href="#__codelineno-0-508">508</a></span>
<span class="normal"><a href="#__codelineno-0-509">509</a></span>
<span class="normal"><a href="#__codelineno-0-510">510</a></span>
<span class="normal"><a href="#__codelineno-0-511">511</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-477" name="__codelineno-0-477"></a><span class="k">def</span> <span class="nf">plot_scheduler_lr</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-478" name="__codelineno-0-478"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-479" name="__codelineno-0-479"></a><span class="sd">    Plot the learning rate of the scheduler.</span>
<a id="__codelineno-0-480" name="__codelineno-0-480"></a>
<a id="__codelineno-0-481" name="__codelineno-0-481"></a><span class="sd">    This is useful to see how the learning rate changes during training,</span>
<a id="__codelineno-0-482" name="__codelineno-0-482"></a><span class="sd">    and to make sure that the scheduler is working as intended.</span>
<a id="__codelineno-0-483" name="__codelineno-0-483"></a>
<a id="__codelineno-0-484" name="__codelineno-0-484"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-485" name="__codelineno-0-485"></a>    <span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">steps_per_epoch</span>
<a id="__codelineno-0-486" name="__codelineno-0-486"></a>    <span class="k">if</span> <span class="n">steps_per_epoch</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-487" name="__codelineno-0-487"></a>        <span class="n">steps_per_epoch</span> <span class="o">=</span> <span class="mi">1000</span>
<a id="__codelineno-0-488" name="__codelineno-0-488"></a>    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-489" name="__codelineno-0-489"></a>        <span class="n">accumulate_grad_batches</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">accumulate_grad_batches</span>
<a id="__codelineno-0-490" name="__codelineno-0-490"></a>        <span class="n">max_epochs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">max_epochs</span>
<a id="__codelineno-0-491" name="__codelineno-0-491"></a>    <span class="k">except</span> <span class="ne">RuntimeError</span><span class="p">:</span>
<a id="__codelineno-0-492" name="__codelineno-0-492"></a>        <span class="n">accumulate_grad_batches</span> <span class="o">=</span> <span class="mi">1</span>
<a id="__codelineno-0-493" name="__codelineno-0-493"></a>        <span class="n">max_epochs</span> <span class="o">=</span> <span class="mi">10</span>
<a id="__codelineno-0-494" name="__codelineno-0-494"></a>    <span class="n">spe</span> <span class="o">=</span> <span class="n">steps_per_epoch</span> <span class="o">//</span> <span class="n">accumulate_grad_batches</span>
<a id="__codelineno-0-495" name="__codelineno-0-495"></a>
<a id="__codelineno-0-496" name="__codelineno-0-496"></a>    <span class="n">optimizer</span><span class="p">,</span> <span class="n">schedulers</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">configure_optimizers</span><span class="p">()</span>
<a id="__codelineno-0-497" name="__codelineno-0-497"></a>    <span class="n">optimizer</span> <span class="o">=</span> <span class="n">optimizer</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
<a id="__codelineno-0-498" name="__codelineno-0-498"></a>    <span class="n">scheduler</span> <span class="o">=</span> <span class="n">schedulers</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;scheduler&quot;</span><span class="p">]</span>
<a id="__codelineno-0-499" name="__codelineno-0-499"></a>
<a id="__codelineno-0-500" name="__codelineno-0-500"></a>    <span class="n">xs</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">range</span><span class="p">(</span><span class="n">spe</span> <span class="o">*</span> <span class="n">max_epochs</span><span class="p">))</span>
<a id="__codelineno-0-501" name="__codelineno-0-501"></a>    <span class="n">lrs</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-502" name="__codelineno-0-502"></a>    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">xs</span><span class="p">:</span>
<a id="__codelineno-0-503" name="__codelineno-0-503"></a>        <span class="n">optimizer</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-504" name="__codelineno-0-504"></a>        <span class="n">lrs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">optimizer</span><span class="o">.</span><span class="n">param_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lr&quot;</span><span class="p">])</span>
<a id="__codelineno-0-505" name="__codelineno-0-505"></a>        <span class="n">scheduler</span><span class="o">.</span><span class="n">step</span><span class="p">()</span>
<a id="__codelineno-0-506" name="__codelineno-0-506"></a>
<a id="__codelineno-0-507" name="__codelineno-0-507"></a>    <span class="n">str_list</span> <span class="o">=</span> <span class="n">uniplot</span><span class="o">.</span><span class="n">plot_to_string</span><span class="p">(</span>
<a id="__codelineno-0-508" name="__codelineno-0-508"></a>        <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">lrs</span><span class="p">)),</span> <span class="n">xs</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Learning Rate Schedule&quot;</span>
<a id="__codelineno-0-509" name="__codelineno-0-509"></a>    <span class="p">)</span>
<a id="__codelineno-0-510" name="__codelineno-0-510"></a>    <span class="n">plot_str</span> <span class="o">=</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">str_list</span><span class="p">)</span>
<a id="__codelineno-0-511" name="__codelineno-0-511"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n\n</span><span class="si">{</span><span class="n">plot_str</span><span class="si">}</span><span class="se">\n\n</span><span class="s2">&quot;</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.training_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">training_step</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>See pytorch_lightning documentation.</p>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-600">600</a></span>
<span class="normal"><a href="#__codelineno-0-601">601</a></span>
<span class="normal"><a href="#__codelineno-0-602">602</a></span>
<span class="normal"><a href="#__codelineno-0-603">603</a></span>
<span class="normal"><a href="#__codelineno-0-604">604</a></span>
<span class="normal"><a href="#__codelineno-0-605">605</a></span>
<span class="normal"><a href="#__codelineno-0-606">606</a></span>
<span class="normal"><a href="#__codelineno-0-607">607</a></span>
<span class="normal"><a href="#__codelineno-0-608">608</a></span>
<span class="normal"><a href="#__codelineno-0-609">609</a></span>
<span class="normal"><a href="#__codelineno-0-610">610</a></span>
<span class="normal"><a href="#__codelineno-0-611">611</a></span>
<span class="normal"><a href="#__codelineno-0-612">612</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-600" name="__codelineno-0-600"></a><span class="k">def</span> <span class="nf">training_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-601" name="__codelineno-0-601"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;See pytorch_lightning documentation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-602" name="__codelineno-0-602"></a>    <span class="n">step_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="n">batch_idx</span><span class="p">)</span>
<a id="__codelineno-0-603" name="__codelineno-0-603"></a>    <span class="n">log_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;train_&quot;</span> <span class="o">+</span> <span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">step_out</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-604" name="__codelineno-0-604"></a>    <span class="n">log_dict</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="s2">&quot;LR&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span><span class="o">.</span><span class="n">optimizers</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">param_groups</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="s2">&quot;lr&quot;</span><span class="p">]})</span>
<a id="__codelineno-0-605" name="__codelineno-0-605"></a>
<a id="__codelineno-0-606" name="__codelineno-0-606"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span>
<a id="__codelineno-0-607" name="__codelineno-0-607"></a>        <span class="n">log_dict</span><span class="p">,</span>
<a id="__codelineno-0-608" name="__codelineno-0-608"></a>        <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-609" name="__codelineno-0-609"></a>        <span class="c1"># reduce_fx=nanmean,</span>
<a id="__codelineno-0-610" name="__codelineno-0-610"></a>    <span class="p">)</span>
<a id="__codelineno-0-611" name="__codelineno-0-611"></a>
<a id="__codelineno-0-612" name="__codelineno-0-612"></a>    <span class="k">return</span> <span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.on_train_start" class="doc doc-heading">
<code class="highlight language-python"><span class="n">on_train_start</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-614">614</a></span>
<span class="normal"><a href="#__codelineno-0-615">615</a></span>
<span class="normal"><a href="#__codelineno-0-616">616</a></span>
<span class="normal"><a href="#__codelineno-0-617">617</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-614" name="__codelineno-0-614"></a><span class="k">def</span> <span class="nf">on_train_start</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-615" name="__codelineno-0-615"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Weights before the start of the training epoch:&quot;</span><span class="p">)</span>
<a id="__codelineno-0-616" name="__codelineno-0-616"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">copy</span><span class="o">.</span><span class="n">deepcopy</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">state_dict</span><span class="p">()))</span>
<a id="__codelineno-0-617" name="__codelineno-0-617"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_start</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.validation_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validation_step</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>See pytorch_lightning documentation.</p>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-619">619</a></span>
<span class="normal"><a href="#__codelineno-0-620">620</a></span>
<span class="normal"><a href="#__codelineno-0-621">621</a></span>
<span class="normal"><a href="#__codelineno-0-622">622</a></span>
<span class="normal"><a href="#__codelineno-0-623">623</a></span>
<span class="normal"><a href="#__codelineno-0-624">624</a></span>
<span class="normal"><a href="#__codelineno-0-625">625</a></span>
<span class="normal"><a href="#__codelineno-0-626">626</a></span>
<span class="normal"><a href="#__codelineno-0-627">627</a></span>
<span class="normal"><a href="#__codelineno-0-628">628</a></span>
<span class="normal"><a href="#__codelineno-0-629">629</a></span>
<span class="normal"><a href="#__codelineno-0-630">630</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-619" name="__codelineno-0-619"></a><span class="k">def</span> <span class="nf">validation_step</span><span class="p">(</span>
<a id="__codelineno-0-620" name="__codelineno-0-620"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-621" name="__codelineno-0-621"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-622" name="__codelineno-0-622"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;See pytorch_lightning documentation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-623" name="__codelineno-0-623"></a>    <span class="n">step_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="n">batch_idx</span><span class="p">)</span>
<a id="__codelineno-0-624" name="__codelineno-0-624"></a>
<a id="__codelineno-0-625" name="__codelineno-0-625"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">irt_metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;irt_l&quot;</span><span class="p">])</span>
<a id="__codelineno-0-626" name="__codelineno-0-626"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">])</span>
<a id="__codelineno-0-627" name="__codelineno-0-627"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;spec_l&quot;</span><span class="p">])</span>
<a id="__codelineno-0-628" name="__codelineno-0-628"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric2</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;spec_l2&quot;</span><span class="p">])</span>
<a id="__codelineno-0-629" name="__codelineno-0-629"></a>
<a id="__codelineno-0-630" name="__codelineno-0-630"></a>    <span class="k">return</span> <span class="n">step_out</span><span class="p">[</span><span class="s2">&quot;l&quot;</span><span class="p">]</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.validation_epoch_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">validation_epoch_end</span><span class="p">(</span><span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>See pytorch lightning documentation.</p>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-632">632</a></span>
<span class="normal"><a href="#__codelineno-0-633">633</a></span>
<span class="normal"><a href="#__codelineno-0-634">634</a></span>
<span class="normal"><a href="#__codelineno-0-635">635</a></span>
<span class="normal"><a href="#__codelineno-0-636">636</a></span>
<span class="normal"><a href="#__codelineno-0-637">637</a></span>
<span class="normal"><a href="#__codelineno-0-638">638</a></span>
<span class="normal"><a href="#__codelineno-0-639">639</a></span>
<span class="normal"><a href="#__codelineno-0-640">640</a></span>
<span class="normal"><a href="#__codelineno-0-641">641</a></span>
<span class="normal"><a href="#__codelineno-0-642">642</a></span>
<span class="normal"><a href="#__codelineno-0-643">643</a></span>
<span class="normal"><a href="#__codelineno-0-644">644</a></span>
<span class="normal"><a href="#__codelineno-0-645">645</a></span>
<span class="normal"><a href="#__codelineno-0-646">646</a></span>
<span class="normal"><a href="#__codelineno-0-647">647</a></span>
<span class="normal"><a href="#__codelineno-0-648">648</a></span>
<span class="normal"><a href="#__codelineno-0-649">649</a></span>
<span class="normal"><a href="#__codelineno-0-650">650</a></span>
<span class="normal"><a href="#__codelineno-0-651">651</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-632" name="__codelineno-0-632"></a><span class="k">def</span> <span class="nf">validation_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">outputs</span><span class="p">:</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">[</span><span class="n">Tensor</span><span class="p">]:</span>
<a id="__codelineno-0-633" name="__codelineno-0-633"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;See pytorch lightning documentation.&quot;&quot;&quot;</span>
<a id="__codelineno-0-634" name="__codelineno-0-634"></a>    <span class="n">log_dict</span> <span class="o">=</span> <span class="p">{</span>
<a id="__codelineno-0-635" name="__codelineno-0-635"></a>        <span class="s2">&quot;val_irt_l&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">irt_metric</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
<a id="__codelineno-0-636" name="__codelineno-0-636"></a>        <span class="s2">&quot;val_l&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">loss_metric</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
<a id="__codelineno-0-637" name="__codelineno-0-637"></a>        <span class="s2">&quot;val_spec_l&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
<a id="__codelineno-0-638" name="__codelineno-0-638"></a>        <span class="s2">&quot;val_spec_l2&quot;</span><span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric2</span><span class="o">.</span><span class="n">compute</span><span class="p">(),</span>
<a id="__codelineno-0-639" name="__codelineno-0-639"></a>    <span class="p">}</span>
<a id="__codelineno-0-640" name="__codelineno-0-640"></a>
<a id="__codelineno-0-641" name="__codelineno-0-641"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span><span class="p">(</span>
<a id="__codelineno-0-642" name="__codelineno-0-642"></a>        <span class="n">log_dict</span><span class="p">,</span>
<a id="__codelineno-0-643" name="__codelineno-0-643"></a>        <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-644" name="__codelineno-0-644"></a>    <span class="p">)</span>
<a id="__codelineno-0-645" name="__codelineno-0-645"></a>
<a id="__codelineno-0-646" name="__codelineno-0-646"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">irt_metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-647" name="__codelineno-0-647"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">loss_metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-648" name="__codelineno-0-648"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-649" name="__codelineno-0-649"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">spectra_metric2</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<a id="__codelineno-0-650" name="__codelineno-0-650"></a>
<a id="__codelineno-0-651" name="__codelineno-0-651"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">validation_epoch_end</span><span class="p">(</span><span class="n">outputs</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.test_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_step</span><span class="p">(</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">],</span> <span class="n">PredictionResults</span><span class="p">]</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-686">686</a></span>
<span class="normal"><a href="#__codelineno-0-687">687</a></span>
<span class="normal"><a href="#__codelineno-0-688">688</a></span>
<span class="normal"><a href="#__codelineno-0-689">689</a></span>
<span class="normal"><a href="#__codelineno-0-690">690</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-686" name="__codelineno-0-686"></a><span class="k">def</span> <span class="nf">test_step</span><span class="p">(</span>
<a id="__codelineno-0-687" name="__codelineno-0-687"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span>
<a id="__codelineno-0-688" name="__codelineno-0-688"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">tuple</span><span class="p">[</span><span class="nb">dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Tensor</span><span class="p">],</span> <span class="n">PredictionResults</span><span class="p">]:</span>
<a id="__codelineno-0-689" name="__codelineno-0-689"></a>    <span class="n">losses</span><span class="p">,</span> <span class="n">pred_out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">_evaluation_step</span><span class="p">(</span><span class="n">batch</span><span class="o">=</span><span class="n">batch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="o">=</span><span class="n">batch_idx</span><span class="p">)</span>
<a id="__codelineno-0-690" name="__codelineno-0-690"></a>    <span class="k">return</span> <span class="n">losses</span><span class="p">,</span> <span class="n">pred_out</span><span class="o">.</span><span class="n">irt</span><span class="p">,</span> <span class="n">batch</span><span class="o">.</span><span class="n">irt</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.test_epoch_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">test_epoch_end</span><span class="p">(</span><span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-692">692</a></span>
<span class="normal"><a href="#__codelineno-0-693">693</a></span>
<span class="normal"><a href="#__codelineno-0-694">694</a></span>
<span class="normal"><a href="#__codelineno-0-695">695</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-692" name="__codelineno-0-692"></a><span class="k">def</span> <span class="nf">test_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">results</span><span class="p">:</span> <span class="nb">list</span><span class="p">):</span>
<a id="__codelineno-0-693" name="__codelineno-0-693"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span><span class="o">.</span><span class="n">trainer</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">trainer</span>
<a id="__codelineno-0-694" name="__codelineno-0-694"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span><span class="o">.</span><span class="n">log_dict</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">log_dict</span>
<a id="__codelineno-0-695" name="__codelineno-0-695"></a>    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">metric_calculator</span><span class="o">.</span><span class="n">test_epoch_end</span><span class="p">(</span><span class="n">results</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.predict_step" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict_step</span><span class="p">(</span><span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-697">697</a></span>
<span class="normal"><a href="#__codelineno-0-698">698</a></span>
<span class="normal"><a href="#__codelineno-0-699">699</a></span>
<span class="normal"><a href="#__codelineno-0-700">700</a></span>
<span class="normal"><a href="#__codelineno-0-701">701</a></span>
<span class="normal"><a href="#__codelineno-0-702">702</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-697" name="__codelineno-0-697"></a><span class="k">def</span> <span class="nf">predict_step</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">batch</span><span class="p">:</span> <span class="n">TrainBatch</span><span class="p">,</span> <span class="n">batch_idx</span><span class="p">:</span> <span class="nb">int</span> <span class="o">|</span> <span class="kc">None</span> <span class="o">=</span> <span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-698" name="__codelineno-0-698"></a>    <span class="n">yhat_irt</span><span class="p">,</span> <span class="n">yhat_spectra</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span>
<a id="__codelineno-0-699" name="__codelineno-0-699"></a>        <span class="n">seq</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">mods</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span> <span class="n">nce</span><span class="o">=</span><span class="n">batch</span><span class="o">.</span><span class="n">nce</span>
<a id="__codelineno-0-700" name="__codelineno-0-700"></a>    <span class="p">)</span>
<a id="__codelineno-0-701" name="__codelineno-0-701"></a>    <span class="n">pred_out</span> <span class="o">=</span> <span class="n">PredictionResults</span><span class="p">(</span><span class="n">irt</span><span class="o">=</span><span class="n">yhat_irt</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">relu</span><span class="p">(</span><span class="n">yhat_spectra</span><span class="p">))</span>
<a id="__codelineno-0-702" name="__codelineno-0-702"></a>    <span class="k">return</span> <span class="n">pred_out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.on_after_backward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">on_after_backward</span><span class="p">()</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-704">704</a></span>
<span class="normal"><a href="#__codelineno-0-705">705</a></span>
<span class="normal"><a href="#__codelineno-0-706">706</a></span>
<span class="normal"><a href="#__codelineno-0-707">707</a></span>
<span class="normal"><a href="#__codelineno-0-708">708</a></span>
<span class="normal"><a href="#__codelineno-0-709">709</a></span>
<span class="normal"><a href="#__codelineno-0-710">710</a></span>
<span class="normal"><a href="#__codelineno-0-711">711</a></span>
<span class="normal"><a href="#__codelineno-0-712">712</a></span>
<span class="normal"><a href="#__codelineno-0-713">713</a></span>
<span class="normal"><a href="#__codelineno-0-714">714</a></span>
<span class="normal"><a href="#__codelineno-0-715">715</a></span>
<span class="normal"><a href="#__codelineno-0-716">716</a></span>
<span class="normal"><a href="#__codelineno-0-717">717</a></span>
<span class="normal"><a href="#__codelineno-0-718">718</a></span>
<span class="normal"><a href="#__codelineno-0-719">719</a></span>
<span class="normal"><a href="#__codelineno-0-720">720</a></span>
<span class="normal"><a href="#__codelineno-0-721">721</a></span>
<span class="normal"><a href="#__codelineno-0-722">722</a></span>
<span class="normal"><a href="#__codelineno-0-723">723</a></span>
<span class="normal"><a href="#__codelineno-0-724">724</a></span>
<span class="normal"><a href="#__codelineno-0-725">725</a></span>
<span class="normal"><a href="#__codelineno-0-726">726</a></span>
<span class="normal"><a href="#__codelineno-0-727">727</a></span>
<span class="normal"><a href="#__codelineno-0-728">728</a></span>
<span class="normal"><a href="#__codelineno-0-729">729</a></span>
<span class="normal"><a href="#__codelineno-0-730">730</a></span>
<span class="normal"><a href="#__codelineno-0-731">731</a></span>
<span class="normal"><a href="#__codelineno-0-732">732</a></span>
<span class="normal"><a href="#__codelineno-0-733">733</a></span>
<span class="normal"><a href="#__codelineno-0-734">734</a></span>
<span class="normal"><a href="#__codelineno-0-735">735</a></span>
<span class="normal"><a href="#__codelineno-0-736">736</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-704" name="__codelineno-0-704"></a><span class="k">def</span> <span class="nf">on_after_backward</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-705" name="__codelineno-0-705"></a>    <span class="n">msg</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-706" name="__codelineno-0-706"></a>    <span class="n">global_step</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">global_step</span>
<a id="__codelineno-0-707" name="__codelineno-0-707"></a>    <span class="k">if</span> <span class="p">(</span><span class="n">global_step</span> <span class="o">%</span> <span class="mi">50</span><span class="p">)</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-708" name="__codelineno-0-708"></a>        <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">param</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">named_parameters</span><span class="p">():</span>
<a id="__codelineno-0-709" name="__codelineno-0-709"></a>            <span class="k">if</span> <span class="s2">&quot;weight&quot;</span> <span class="ow">in</span> <span class="n">name</span> <span class="ow">and</span> <span class="s2">&quot;norm&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">name</span><span class="p">:</span>
<a id="__codelineno-0-710" name="__codelineno-0-710"></a>                <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">requires_grad</span><span class="p">:</span>
<a id="__codelineno-0-711" name="__codelineno-0-711"></a>                    <span class="k">try</span><span class="p">:</span>
<a id="__codelineno-0-712" name="__codelineno-0-712"></a>                        <span class="k">if</span> <span class="n">param</span><span class="o">.</span><span class="n">grad</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-713" name="__codelineno-0-713"></a>                            <span class="k">raise</span> <span class="ne">AttributeError</span>
<a id="__codelineno-0-714" name="__codelineno-0-714"></a>                        <span class="k">if</span> <span class="nb">any</span><span class="p">(</span>
<a id="__codelineno-0-715" name="__codelineno-0-715"></a>                            <span class="n">x</span> <span class="ow">in</span> <span class="n">name</span>
<a id="__codelineno-0-716" name="__codelineno-0-716"></a>                            <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="p">[</span>
<a id="__codelineno-0-717" name="__codelineno-0-717"></a>                                <span class="s2">&quot;aa_encoder.weight&quot;</span><span class="p">,</span>
<a id="__codelineno-0-718" name="__codelineno-0-718"></a>                                <span class="s2">&quot;mod_encoder.weight&quot;</span><span class="p">,</span>
<a id="__codelineno-0-719" name="__codelineno-0-719"></a>                                <span class="s2">&quot;trans_decoder_embedding.weight&quot;</span><span class="p">,</span>
<a id="__codelineno-0-720" name="__codelineno-0-720"></a>                            <span class="p">]</span>
<a id="__codelineno-0-721" name="__codelineno-0-721"></a>                        <span class="p">):</span>
<a id="__codelineno-0-722" name="__codelineno-0-722"></a>                            <span class="n">val</span> <span class="o">=</span> <span class="n">param</span><span class="o">.</span><span class="n">grad</span><span class="o">.</span><span class="n">abs</span><span class="p">()</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
<a id="__codelineno-0-723" name="__codelineno-0-723"></a>                            <span class="k">if</span> <span class="n">torch</span><span class="o">.</span><span class="n">any</span><span class="p">(</span><span class="n">torch</span><span class="o">.</span><span class="n">isnan</span><span class="p">(</span><span class="n">val</span><span class="p">)):</span>
<a id="__codelineno-0-724" name="__codelineno-0-724"></a>                                <span class="n">logger</span><span class="o">.</span><span class="n">error</span><span class="p">(</span>
<a id="__codelineno-0-725" name="__codelineno-0-725"></a>                                    <span class="sa">f</span><span class="s2">&quot;nan mean gradient for </span><span class="si">{</span><span class="n">name</span><span class="si">}</span><span class="s2">: </span><span class="si">{</span><span class="n">param</span><span class="o">.</span><span class="n">grad</span><span class="si">}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-726" name="__codelineno-0-726"></a>                                <span class="p">)</span>
<a id="__codelineno-0-727" name="__codelineno-0-727"></a>                            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">prog_bar</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">on_step</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-728" name="__codelineno-0-728"></a>                    <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
<a id="__codelineno-0-729" name="__codelineno-0-729"></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-730" name="__codelineno-0-730"></a>                    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span>
<a id="__codelineno-0-731" name="__codelineno-0-731"></a>                        <span class="n">msg</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">name</span><span class="p">)</span>
<a id="__codelineno-0-732" name="__codelineno-0-732"></a>
<a id="__codelineno-0-733" name="__codelineno-0-733"></a>    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
<a id="__codelineno-0-734" name="__codelineno-0-734"></a>        <span class="n">logger</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
<a id="__codelineno-0-735" name="__codelineno-0-735"></a>            <span class="s2">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Did not have gradients in step </span><span class="si">{global_step}</span><span class="s2">&quot;</span>
<a id="__codelineno-0-736" name="__codelineno-0-736"></a>        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.on_train_epoch_end" class="doc doc-heading">
<code class="highlight language-python"><span class="n">on_train_epoch_end</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-738">738</a></span>
<span class="normal"><a href="#__codelineno-0-739">739</a></span>
<span class="normal"><a href="#__codelineno-0-740">740</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-738" name="__codelineno-0-738"></a><span class="k">def</span> <span class="nf">on_train_epoch_end</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-739" name="__codelineno-0-739"></a>    <span class="n">evaluate_landmark_rt</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>
<a id="__codelineno-0-740" name="__codelineno-0-740"></a>    <span class="k">return</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">on_train_epoch_end</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.PepTransformerModel.load_from_checkpoint" class="doc doc-heading">
<code class="highlight language-python"><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="n">args</span><span class="p">,</span> <span class="n">kwargs</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-classmethod"><code>classmethod</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-742">742</a></span>
<span class="normal"><a href="#__codelineno-0-743">743</a></span>
<span class="normal"><a href="#__codelineno-0-744">744</a></span>
<span class="normal"><a href="#__codelineno-0-745">745</a></span>
<span class="normal"><a href="#__codelineno-0-746">746</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-742" name="__codelineno-0-742"></a><span class="nd">@classmethod</span>
<a id="__codelineno-0-743" name="__codelineno-0-743"></a><span class="k">def</span> <span class="nf">load_from_checkpoint</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
<a id="__codelineno-0-744" name="__codelineno-0-744"></a>    <span class="n">mod</span> <span class="o">=</span> <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="n">load_from_checkpoint</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
<a id="__codelineno-0-745" name="__codelineno-0-745"></a>    <span class="n">evaluate_landmark_rt</span><span class="p">(</span><span class="n">mod</span><span class="p">)</span>
<a id="__codelineno-0-746" name="__codelineno-0-746"></a>    <span class="k">return</span> <span class="n">mod</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h3 id="elfragmentador.model-functions">Functions</h3>

<div class="doc doc-object doc-function">



<h4 id="elfragmentador.model.evaluate_landmark_rt" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">evaluate_landmark_rt</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">PepTransformerModel</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
  
      <p>Checks the prediction of the model on the iRT peptides.</p>
<p>Predicts all the procal and Biognosys iRT peptides and checks the correlation
of the theoretical iRT values and the predicted ones</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>model</code></td>
          <td class="doc-param-details">
            <p>PepTransformerModel
A model to test the predictions on</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><a class="autorefs autorefs-internal" title="elfragmentador.model.PepTransformerModel" href="#elfragmentador.model.PepTransformerModel">PepTransformerModel</a></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/__init__.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-749">749</a></span>
<span class="normal"><a href="#__codelineno-0-750">750</a></span>
<span class="normal"><a href="#__codelineno-0-751">751</a></span>
<span class="normal"><a href="#__codelineno-0-752">752</a></span>
<span class="normal"><a href="#__codelineno-0-753">753</a></span>
<span class="normal"><a href="#__codelineno-0-754">754</a></span>
<span class="normal"><a href="#__codelineno-0-755">755</a></span>
<span class="normal"><a href="#__codelineno-0-756">756</a></span>
<span class="normal"><a href="#__codelineno-0-757">757</a></span>
<span class="normal"><a href="#__codelineno-0-758">758</a></span>
<span class="normal"><a href="#__codelineno-0-759">759</a></span>
<span class="normal"><a href="#__codelineno-0-760">760</a></span>
<span class="normal"><a href="#__codelineno-0-761">761</a></span>
<span class="normal"><a href="#__codelineno-0-762">762</a></span>
<span class="normal"><a href="#__codelineno-0-763">763</a></span>
<span class="normal"><a href="#__codelineno-0-764">764</a></span>
<span class="normal"><a href="#__codelineno-0-765">765</a></span>
<span class="normal"><a href="#__codelineno-0-766">766</a></span>
<span class="normal"><a href="#__codelineno-0-767">767</a></span>
<span class="normal"><a href="#__codelineno-0-768">768</a></span>
<span class="normal"><a href="#__codelineno-0-769">769</a></span>
<span class="normal"><a href="#__codelineno-0-770">770</a></span>
<span class="normal"><a href="#__codelineno-0-771">771</a></span>
<span class="normal"><a href="#__codelineno-0-772">772</a></span>
<span class="normal"><a href="#__codelineno-0-773">773</a></span>
<span class="normal"><a href="#__codelineno-0-774">774</a></span>
<span class="normal"><a href="#__codelineno-0-775">775</a></span>
<span class="normal"><a href="#__codelineno-0-776">776</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-749" name="__codelineno-0-749"></a><span class="k">def</span> <span class="nf">evaluate_landmark_rt</span><span class="p">(</span><span class="n">model</span><span class="p">:</span> <span class="n">PepTransformerModel</span><span class="p">):</span>
<a id="__codelineno-0-750" name="__codelineno-0-750"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Checks the prediction of the model on the iRT peptides.</span>
<a id="__codelineno-0-751" name="__codelineno-0-751"></a>
<a id="__codelineno-0-752" name="__codelineno-0-752"></a><span class="sd">    Predicts all the procal and Biognosys iRT peptides and checks the correlation</span>
<a id="__codelineno-0-753" name="__codelineno-0-753"></a><span class="sd">    of the theoretical iRT values and the predicted ones</span>
<a id="__codelineno-0-754" name="__codelineno-0-754"></a>
<a id="__codelineno-0-755" name="__codelineno-0-755"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-756" name="__codelineno-0-756"></a><span class="sd">        model: PepTransformerModel</span>
<a id="__codelineno-0-757" name="__codelineno-0-757"></a><span class="sd">            A model to test the predictions on</span>
<a id="__codelineno-0-758" name="__codelineno-0-758"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-759" name="__codelineno-0-759"></a>    <span class="n">model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-760" name="__codelineno-0-760"></a>    <span class="n">real_rt</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-761" name="__codelineno-0-761"></a>    <span class="n">pred_rt</span> <span class="o">=</span> <span class="p">[]</span>
<a id="__codelineno-0-762" name="__codelineno-0-762"></a>    <span class="k">for</span> <span class="n">seq</span><span class="p">,</span> <span class="n">desc</span> <span class="ow">in</span> <span class="n">IRT_PEPTIDES</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
<a id="__codelineno-0-763" name="__codelineno-0-763"></a>        <span class="k">with</span> <span class="n">torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">():</span>
<a id="__codelineno-0-764" name="__codelineno-0-764"></a>            <span class="n">out</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict_from_seq</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">seq</span><span class="si">}</span><span class="s2">/2&quot;</span><span class="p">,</span> <span class="mi">25</span><span class="p">)</span>
<a id="__codelineno-0-765" name="__codelineno-0-765"></a>            <span class="n">pred_rt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">out</span><span class="o">.</span><span class="n">irt</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
<a id="__codelineno-0-766" name="__codelineno-0-766"></a>            <span class="n">real_rt</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">desc</span><span class="p">[</span><span class="s2">&quot;irt&quot;</span><span class="p">]))</span>
<a id="__codelineno-0-767" name="__codelineno-0-767"></a>
<a id="__codelineno-0-768" name="__codelineno-0-768"></a>    <span class="n">fit</span> <span class="o">=</span> <span class="n">polyfit</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_rt</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred_rt</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">())</span>
<a id="__codelineno-0-769" name="__codelineno-0-769"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">fit</span><span class="p">)</span>
<a id="__codelineno-0-770" name="__codelineno-0-770"></a>    <span class="n">plot_str</span> <span class="o">=</span> <span class="n">uniplot</span><span class="o">.</span><span class="n">plot_to_string</span><span class="p">(</span>
<a id="__codelineno-0-771" name="__codelineno-0-771"></a>        <span class="n">xs</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">real_rt</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-772" name="__codelineno-0-772"></a>        <span class="n">ys</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">pred_rt</span><span class="p">)</span><span class="o">.</span><span class="n">flatten</span><span class="p">(),</span>
<a id="__codelineno-0-773" name="__codelineno-0-773"></a>        <span class="n">title</span><span class="o">=</span><span class="s2">&quot;Prediction vs real iRT of biognosys and procal peptides&quot;</span><span class="p">,</span>
<a id="__codelineno-0-774" name="__codelineno-0-774"></a>    <span class="p">)</span>
<a id="__codelineno-0-775" name="__codelineno-0-775"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">plot_str</span><span class="p">),</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>
<a id="__codelineno-0-776" name="__codelineno-0-776"></a>    <span class="k">return</span> <span class="n">fit</span><span class="p">,</span> <span class="n">plot_str</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="elfragmentador.model.peptransformer" class="doc doc-heading">
          <code>elfragmentador.model.peptransformer</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">






<h3 id="elfragmentador.model.peptransformer-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.peptransformer.PepTransformerBase" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">peptransformer</span><span class="o">.</span><span class="n">PepTransformerBase</span><span class="p">(</span><span class="n">num_fragments</span><span class="p">,</span> <span class="n">num_decoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">num_encoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span> <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span> <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span> <span class="n">combine_embeds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">combine_encoders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">final_decoder</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>



          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/peptransformer.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-19" name="__codelineno-0-19"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">num_fragments</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">num_decoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="n">num_encoder_layers</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">6</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">2024</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">516</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.1</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>    <span class="n">combine_embeds</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a>    <span class="n">combine_encoders</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>    <span class="n">final_decoder</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>    <span class="c1"># Peptide encoder</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">PeptideTransformerEncoder</span><span class="p">(</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>        <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a>        <span class="n">layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a>    <span class="p">)</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>    <span class="c1"># Peptide decoder</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">FragmentTransformerDecoder</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">layers</span><span class="o">=</span><span class="n">num_decoder_layers</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>        <span class="n">num_fragments</span><span class="o">=</span><span class="n">num_fragments</span><span class="p">,</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>    <span class="p">)</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">irt_decoder</span> <span class="o">=</span> <span class="n">IRTDecoder</span><span class="p">(</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>        <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">n_layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>        <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">,</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>    <span class="p">)</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="k">if</span> <span class="n">combine_embeds</span><span class="p">:</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">irt_decoder</span><span class="o">.</span><span class="n">aa_embed</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">aa_embed</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="k">if</span> <span class="n">combine_encoders</span><span class="p">:</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="bp">self</span><span class="o">.</span><span class="n">irt_decoder</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="o">.</span><span class="n">encoder</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.peptransformer.PepTransformerBase-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.peptransformer.PepTransformerBase.encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">encoder</span> <span class="o">=</span> <span class="n">PeptideTransformerEncoder</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span> <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.peptransformer.PepTransformerBase.decoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">decoder</span> <span class="o">=</span> <span class="n">FragmentTransformerDecoder</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span> <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">num_decoder_layers</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">num_fragments</span><span class="o">=</span><span class="n">num_fragments</span><span class="p">,</span> <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.peptransformer.PepTransformerBase.irt_decoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">irt_decoder</span> <span class="o">=</span> <span class="n">IRTDecoder</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span> <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span> <span class="n">n_layers</span><span class="o">=</span><span class="n">num_encoder_layers</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.peptransformer.PepTransformerBase-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.peptransformer.PepTransformerBase.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Forward Generate predictions.</p>
<p>Privides the function for the forward pass to the model.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seq</code></td>
          <td class="doc-param-details">
            <p>Encoded pepide sequence [B, L] (view details)</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>mods</code></td>
          <td class="doc-param-details">
            <p>Encoded modification sequence [B, L], by default None</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>nce</code></td>
          <td class="doc-param-details">
            <p>float Tensor with the charges [B, 1]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>charge</code></td>
          <td class="doc-param-details">
            <p>long Tensor with the charges [B, 1], by default None</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

<details class="details">
  <summary>Details</summary>
  <p>seq:
    The peptide is encoded as integers for the aminoacid.
    "AAA" encoded for a max length of 5 would be
    torch.Tensor([ 1,  1,  1,  0,  0]).long()
nce:
    Normalized collision energy to use during the prediction.
charge:
    A tensor corresponding to the charges of each of the
    peptide precursors (long)
mods:
    Modifications encoded as integers</p>
</details>
      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/peptransformer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-68"> 68</a></span>
<span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span>
<span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-68" name="__codelineno-0-68"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
<a id="__codelineno-0-69" name="__codelineno-0-69"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>    <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span><span class="p">:</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">    Forward Generate predictions.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">    Privides the function for the forward pass to the model.</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">        seq (Tensor): Encoded pepide sequence [B, L] (view details)</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        mods (Tensor): Encoded modification sequence [B, L], by default None</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        nce (Tensor): float Tensor with the charges [B, 1]</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a><span class="sd">        charge (Tensor): long Tensor with the charges [B, 1], by default None</span>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">    Details:</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        seq:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">            The peptide is encoded as integers for the aminoacid.</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">            &quot;AAA&quot; encoded for a max length of 5 would be</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">            torch.Tensor([ 1,  1,  1,  0,  0]).long()</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        nce:</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">            Normalized collision energy to use during the prediction.</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">        charge:</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a><span class="sd">            A tensor corresponding to the charges of each of the</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a><span class="sd">            peptide precursors (long)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a><span class="sd">        mods:</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a><span class="sd">            Modifications encoded as integers</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>    <span class="n">trans_encoder_output</span><span class="p">,</span> <span class="n">mem_mask</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">)</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>    <span class="n">rt_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">irt_decoder</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">)</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">spectra_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>        <span class="n">memory</span><span class="o">=</span><span class="n">trans_encoder_output</span><span class="p">,</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>        <span class="n">charge</span><span class="o">=</span><span class="n">charge</span><span class="p">,</span>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>        <span class="n">nce</span><span class="o">=</span><span class="n">nce</span><span class="p">,</span>
<a id="__codelineno-0-108" name="__codelineno-0-108"></a>        <span class="n">memory_key_padding_mask</span><span class="o">=</span><span class="n">mem_mask</span><span class="p">,</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="p">)</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="k">return</span> <span class="n">PredictionResults</span><span class="p">(</span><span class="n">irt</span><span class="o">=</span><span class="n">rt_output</span><span class="p">,</span> <span class="n">spectra</span><span class="o">=</span><span class="n">spectra_output</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.peptransformer.PepTransformerBase.predict_from_seq" class="doc doc-heading">
<code class="highlight language-python"><span class="n">predict_from_seq</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">nce</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">as_spectrum</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span> <span class="o">|</span> <span class="n">AnnotatedPeptideSpectrum</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Predict_from_seq Predicts spectra from a sequence as a string.</p>
<p>Utility method that gets a sequence as a string, encodes it internally
to the correct input form and outputs the predicted spectra.</p>
<p>Note that the spectra is not decoded as an output, please check
<code>elfragmentador.encoding_decoding.decode_fragment_tensor</code> for the
decoding.</p>
<p>The irt is scaled by 100 and is in the Biognosys scale.</p>
<p>TODO: consider if the output should be decoded ...</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>seq</code></td>
          <td class="doc-param-details">
            <p>Sequence to use for prediction, supports modifications in the form
of S[PHOSPHO], S[+80] and T[181]</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>str</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>nce</code></td>
          <td class="doc-param-details">
            <p>Normalized collision energy to use during the prediction</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>as_spectrum</code></td>
          <td class="doc-param-details">
            <p>Wether to return a Spectrum object instead of the raw tensor predictions
(Default value = False)</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>bool</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>False</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <code>PredictionResults</code>
          </td>
          <td class="doc-returns-details">
            <p>A named tuple with two named results; irt and spectra</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="elfragmentador.named_batches.PredictionResults">PredictionResults</span> | <span title="ms2ml.AnnotatedPeptideSpectrum">AnnotatedPeptideSpectrum</span></code>
                </span>
              </p>
          </td>
        </tr>
        <tr>
          <td>
              <code>Spectrum</code>
          </td>
          <td class="doc-returns-details">
            <p>A spectrum object with the predicted spectrum</p>
              <p>
                <span class="doc-returns-annotation">
                  <b>TYPE:</b>
                    <code><span title="elfragmentador.named_batches.PredictionResults">PredictionResults</span> | <span title="ms2ml.AnnotatedPeptideSpectrum">AnnotatedPeptideSpectrum</span></code>
                </span>
              </p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">elfragmentador.config</span> <span class="kn">import</span> <span class="n">CONFIG</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pl</span><span class="o">.</span><span class="n">seed_everything</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">42</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">my_model</span> <span class="o">=</span> <span class="n">PepTransformerBase</span><span class="p">(</span><span class="n">num_fragments</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">num_fragment_embeddings</span><span class="p">)</span> <span class="c1"># Or load the model from a checkpoint</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">_</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">eval</span><span class="p">()</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">my_model</span><span class="o">.</span><span class="n">predict_from_seq</span><span class="p">(</span><span class="s2">&quot;MYPEPT[U:21]IDEK/3&quot;</span><span class="p">,</span> <span class="mi">27</span><span class="p">)</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">PredictionResults(irt=tensor(...), spectra=tensor([...]))</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">out</span> <span class="o">=</span> <span class="n">my_model</span><span class="o">.</span><span class="n">predict_from_seq</span><span class="p">(</span><span class="s2">&quot;MYPEPT[U:21]IDEK/3&quot;</span><span class="p">,</span> <span class="mi">27</span><span class="p">,</span>             <span class="n">as_spectrum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">type</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go">&lt;class &#39;ms2ml.spectrum.AnnotatedPeptideSpectrum&#39;&gt;</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt; </span><span class="c1"># my_model.predict_from_seq(&quot;MYPEPT[U:21]IDEK/3&quot;, 27)</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/peptransformer.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-113" name="__codelineno-0-113"></a><span class="nd">@torch</span><span class="o">.</span><span class="n">no_grad</span><span class="p">()</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a><span class="k">def</span> <span class="nf">predict_from_seq</span><span class="p">(</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="n">seq</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>    <span class="n">nce</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="n">as_spectrum</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">PredictionResults</span> <span class="o">|</span> <span class="n">AnnotatedPeptideSpectrum</span><span class="p">:</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    Predict_from_seq Predicts spectra from a sequence as a string.</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a><span class="sd">    Utility method that gets a sequence as a string, encodes it internally</span>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    to the correct input form and outputs the predicted spectra.</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a><span class="sd">    Note that the spectra is not decoded as an output, please check</span>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    `elfragmentador.encoding_decoding.decode_fragment_tensor` for the</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a><span class="sd">    decoding.</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">    The irt is scaled by 100 and is in the Biognosys scale.</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">    TODO: consider if the output should be decoded ...</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">        seq (str):</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            Sequence to use for prediction, supports modifications in the form</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            of S[PHOSPHO], S[+80] and T[181]</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a><span class="sd">        nce (float):</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">            Normalized collision energy to use during the prediction</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        as_spectrum (bool, optional):</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a><span class="sd">            Wether to return a Spectrum object instead of the raw tensor predictions</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">            (Default value = False)</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">      PredictionResults: A named tuple with two named results; irt and spectra</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">      Spectrum: A spectrum object with the predicted spectrum</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">        &gt;&gt;&gt; import pytorch_lightning as pl</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a><span class="sd">        &gt;&gt;&gt; from elfragmentador.config import CONFIG</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a><span class="sd">        &gt;&gt;&gt; pl.seed_everything(42)</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a><span class="sd">        42</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a><span class="sd">        &gt;&gt;&gt; my_model = PepTransformerBase(num_fragments=CONFIG.num_fragment_embeddings) # Or load the model from a checkpoint</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a><span class="sd">        &gt;&gt;&gt; _ = my_model.eval()</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a><span class="sd">        &gt;&gt;&gt; my_model.predict_from_seq(&quot;MYPEPT[U:21]IDEK/3&quot;, 27)</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a><span class="sd">        PredictionResults(irt=tensor(...), spectra=tensor([...]))</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a><span class="sd">        &gt;&gt;&gt; out = my_model.predict_from_seq(&quot;MYPEPT[U:21]IDEK/3&quot;, 27, \</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a><span class="sd">        as_spectrum=True)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a><span class="sd">        &gt;&gt;&gt; type(out)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a><span class="sd">        &lt;class &#39;ms2ml.spectrum.AnnotatedPeptideSpectrum&#39;&gt;</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a><span class="sd">        &gt;&gt;&gt; # my_model.predict_from_seq(&quot;MYPEPT[U:21]IDEK/3&quot;, 27)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a><span class="sd">    &quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="n">in_batch</span> <span class="o">=</span> <span class="n">Tensorizer</span><span class="p">()</span><span class="o">.</span><span class="n">convert_string</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">nce</span><span class="o">=</span><span class="n">nce</span><span class="p">)</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>    <span class="n">device</span> <span class="o">=</span> <span class="nb">next</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">parameters</span><span class="p">())</span><span class="o">.</span><span class="n">device</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="n">in_batch_dict</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">to</span><span class="p">(</span><span class="n">device</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">in_batch</span><span class="o">.</span><span class="n">_asdict</span><span class="p">()</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">forward</span><span class="p">(</span><span class="o">**</span><span class="n">in_batch_dict</span><span class="p">)</span>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="n">out</span><span class="p">)</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="k">if</span> <span class="n">as_spectrum</span><span class="p">:</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a>        <span class="n">spec</span> <span class="o">=</span> <span class="n">DeTensorizer</span><span class="o">.</span><span class="n">make_spectrum</span><span class="p">(</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>            <span class="n">seq</span><span class="o">=</span><span class="n">in_batch</span><span class="o">.</span><span class="n">seq</span><span class="p">,</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>            <span class="n">mod</span><span class="o">=</span><span class="n">in_batch</span><span class="o">.</span><span class="n">mods</span><span class="p">,</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>            <span class="n">charge</span><span class="o">=</span><span class="n">in_batch</span><span class="o">.</span><span class="n">charge</span><span class="p">,</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>            <span class="n">fragment_vector</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">spectra</span><span class="p">,</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>            <span class="n">irt</span><span class="o">=</span><span class="n">out</span><span class="o">.</span><span class="n">irt</span><span class="p">,</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>        <span class="p">)</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>        <span class="n">out</span> <span class="o">=</span> <span class="n">spec</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="elfragmentador.model.ms_transformer_layers" class="doc doc-heading">
          <code>elfragmentador.model.ms_transformer_layers</code>


</h2>

  <div class="doc doc-contents first">

  

  <div class="doc doc-children">





<h3 id="elfragmentador.model.ms_transformer_layers-attributes">Attributes</h3>

<div class="doc doc-object doc-attribute">



<h4 id="elfragmentador.model.ms_transformer_layers.CONFIG" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ms_transformer_layers</span><span class="o">.</span><span class="n">CONFIG</span> <span class="o">=</span> <span class="n">get_default_config</span><span class="p">()</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  </div>

</div>
<h3 id="elfragmentador.model.ms_transformer_layers-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.ms_transformer_layers.IRTDecoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ms_transformer_layers</span><span class="o">.</span><span class="n">IRTDecoder</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">dim_feedforward</span> <span class="o">=</span> <span class="mi">224</span><span class="p">,</span> <span class="n">nhead</span> <span class="o">=</span> <span class="mi">4</span><span class="p">,</span> <span class="n">n_layers</span> <span class="o">=</span> <span class="mi">3</span><span class="p">,</span> <span class="n">dropout</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">final_decoder</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>



          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-15">15</a></span>
<span class="normal"><a href="#__codelineno-0-16">16</a></span>
<span class="normal"><a href="#__codelineno-0-17">17</a></span>
<span class="normal"><a href="#__codelineno-0-18">18</a></span>
<span class="normal"><a href="#__codelineno-0-19">19</a></span>
<span class="normal"><a href="#__codelineno-0-20">20</a></span>
<span class="normal"><a href="#__codelineno-0-21">21</a></span>
<span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-15" name="__codelineno-0-15"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-16" name="__codelineno-0-16"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-17" name="__codelineno-0-17"></a>    <span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-18" name="__codelineno-0-18"></a>    <span class="n">dim_feedforward</span><span class="o">=</span><span class="mi">224</span><span class="p">,</span>
<a id="__codelineno-0-19" name="__codelineno-0-19"></a>    <span class="n">nhead</span><span class="o">=</span><span class="mi">4</span><span class="p">,</span>
<a id="__codelineno-0-20" name="__codelineno-0-20"></a>    <span class="n">n_layers</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<a id="__codelineno-0-21" name="__codelineno-0-21"></a>    <span class="n">dropout</span><span class="o">=</span><span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-22" name="__codelineno-0-22"></a>    <span class="n">final_decoder</span><span class="o">=</span><span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a><span class="p">):</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;Decode iRTs.</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a><span class="sd">    It is technically an encoder-decoder...</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a><span class="sd">        d_model (int):</span>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">            Number of dimensions to expect as input</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">        nhead (int):</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a><span class="sd">            Number of heads in the attention layers that decode the input.</span>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">            defaults to 4</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">        dim_feedforward (int, optional):</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">            Number of hidden dimensions in the FFN that decodes the sequence.</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">            Defaults to 224</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a><span class="sd">        n_layers (int, optional):</span>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">            dropout to use in the multihead attention.</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">            Defaults to 3</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">aa_embed</span> <span class="o">=</span> <span class="n">AASequenceEmbedding</span><span class="p">(</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a>        <span class="n">aa_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_aa_order</span><span class="p">,</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a>        <span class="n">mod_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_mod_order</span><span class="p">,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a>        <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>    <span class="p">)</span>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a>    <span class="n">encoder_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoderLayer</span><span class="p">(</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a>        <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">dim_feedforward</span><span class="p">,</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a>        <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;gelu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a>    <span class="p">)</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>        <span class="n">encoder_layer</span><span class="o">=</span><span class="n">encoder_layers</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">n_layers</span>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="p">)</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span> <span class="o">=</span> <span class="n">_LearnableEmbedTransformerDecoder</span><span class="p">(</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>        <span class="n">nhid</span><span class="o">=</span><span class="n">dim_feedforward</span><span class="p">,</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>        <span class="n">layers</span><span class="o">=</span><span class="n">n_layers</span><span class="p">,</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>        <span class="n">num_outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>        <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">,</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.ms_transformer_layers.IRTDecoder-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.IRTDecoder.aa_embed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aa_embed</span> <span class="o">=</span> <span class="n">AASequenceEmbedding</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">aa_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_aa_order</span><span class="p">,</span> <span class="n">mod_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_mod_order</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.IRTDecoder.encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span><span class="n">encoder_layer</span><span class="o">=</span><span class="n">encoder_layers</span><span class="p">,</span> <span class="n">num_layers</span><span class="o">=</span><span class="n">n_layers</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.IRTDecoder.decoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">decoder</span> <span class="o">=</span> <span class="n">_LearnableEmbedTransformerDecoder</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span> <span class="n">nhid</span><span class="o">=</span><span class="n">dim_feedforward</span><span class="p">,</span> <span class="n">layers</span><span class="o">=</span><span class="n">n_layers</span><span class="p">,</span> <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span> <span class="n">num_outputs</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.ms_transformer_layers.IRTDecoder-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.ms_transformer_layers.IRTDecoder.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69">69</a></span>
<span class="normal"><a href="#__codelineno-0-70">70</a></span>
<span class="normal"><a href="#__codelineno-0-71">71</a></span>
<span class="normal"><a href="#__codelineno-0-72">72</a></span>
<span class="normal"><a href="#__codelineno-0-73">73</a></span>
<span class="normal"><a href="#__codelineno-0-74">74</a></span>
<span class="normal"><a href="#__codelineno-0-75">75</a></span>
<span class="normal"><a href="#__codelineno-0-76">76</a></span>
<span class="normal"><a href="#__codelineno-0-77">77</a></span>
<span class="normal"><a href="#__codelineno-0-78">78</a></span>
<span class="normal"><a href="#__codelineno-0-79">79</a></span>
<span class="normal"><a href="#__codelineno-0-80">80</a></span>
<span class="normal"><a href="#__codelineno-0-81">81</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">):</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a>    <span class="c1"># seq [N, S], mods [N, S]</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a>    <span class="n">trans_encoder_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>    <span class="n">trans_encoder_mask</span> <span class="o">=</span> <span class="n">trans_encoder_mask</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a>        <span class="n">seq</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a>    <span class="p">)</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">seq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a>    <span class="c1"># mask [N, S]</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a>    <span class="n">embed_seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa_embed</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">)</span>  <span class="c1"># [S, N, d_model]</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a>    <span class="n">memory</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">embed_seq</span><span class="p">,</span> <span class="n">src_key_padding_mask</span><span class="o">=</span><span class="n">trans_encoder_mask</span><span class="p">)</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>    <span class="n">out</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder</span><span class="p">(</span><span class="n">memory</span><span class="p">,</span> <span class="n">trans_encoder_mask</span><span class="p">)</span>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a>    <span class="k">return</span> <span class="n">out</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ms_transformer_layers</span><span class="o">.</span><span class="n">PeptideTransformerEncoder</span><span class="p">(</span><span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>



          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a>    <span class="c1"># Aminoacid embedding</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">aa_embed</span> <span class="o">=</span> <span class="n">AASequenceEmbedding</span><span class="p">(</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a>        <span class="n">aa_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_aa_order</span><span class="p">,</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>        <span class="n">mod_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_mod_order</span><span class="p">,</span>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>        <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>    <span class="c1"># Transformer encoder sections</span>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="n">encoder_layers</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoderLayer</span><span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>        <span class="n">dim_feedforward</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>        <span class="n">activation</span><span class="o">=</span><span class="s2">&quot;gelu&quot;</span><span class="p">,</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span><span class="n">encoder_layers</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.aa_embed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aa_embed</span> <span class="o">=</span> <span class="n">AASequenceEmbedding</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">aa_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_aa_order</span><span class="p">,</span> <span class="n">mod_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_mod_order</span><span class="p">,</span> <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">TransformerEncoder</span><span class="p">(</span><span class="n">encoder_layers</span><span class="p">,</span> <span class="n">layers</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.ms_transformer_layers.PeptideTransformerEncoder.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-108">108</a></span>
<span class="normal"><a href="#__codelineno-0-109">109</a></span>
<span class="normal"><a href="#__codelineno-0-110">110</a></span>
<span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-108" name="__codelineno-0-108"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">mods</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-109" name="__codelineno-0-109"></a>    <span class="c1"># For the mask ....</span>
<a id="__codelineno-0-110" name="__codelineno-0-110"></a>    <span class="c1"># If a BoolTensor is provided, positions with True are not allowed</span>
<a id="__codelineno-0-111" name="__codelineno-0-111"></a>    <span class="c1"># to attend while False values will be unchanged &lt;- form the pytorch docs</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="c1"># [1,1,0]</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="c1"># bool [True, True, False]</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="c1"># ~    [False, False, True]</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a>    <span class="c1"># [Attend, Attend, Dont Attend]</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>    <span class="c1"># seq shape [N, S]</span>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a>    <span class="n">trans_encoder_mask</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros_like</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a>    <span class="n">trans_encoder_mask</span> <span class="o">=</span> <span class="n">trans_encoder_mask</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a>        <span class="n">seq</span> <span class="o">&lt;=</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="s2">&quot;-inf&quot;</span><span class="p">)</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a>    <span class="p">)</span><span class="o">.</span><span class="n">masked_fill</span><span class="p">(</span><span class="n">seq</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="mf">0.0</span><span class="p">))</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a>    <span class="n">x</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa_embed</span><span class="p">(</span><span class="n">seq</span><span class="o">=</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="o">=</span><span class="n">mods</span><span class="p">)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a>    <span class="c1"># x shape [S, N, d_model]</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a>    <span class="n">trans_encoder_output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">encoder</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">src_key_padding_mask</span><span class="o">=</span><span class="n">trans_encoder_mask</span><span class="p">)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>    <span class="c1"># trans_encoder_output shape [S, N, d_model]</span>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a>    <span class="k">return</span> <span class="n">trans_encoder_output</span><span class="p">,</span> <span class="n">trans_encoder_mask</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">ms_transformer_layers</span><span class="o">.</span><span class="n">FragmentTransformerDecoder</span><span class="p">(</span><span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">num_fragments</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">charge_dims_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">nce_dims_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span> <span class="n">final_decoder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s1">&#39;linear&#39;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code><span title="elfragmentador.model.transformer_layers._LearnableEmbedTransformerDecoder">_LearnableEmbedTransformerDecoder</span></code></p>



          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span>
<span class="normal"><a href="#__codelineno-0-165">165</a></span>
<span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a>    <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a>    <span class="n">nhead</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>    <span class="n">nhid</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a>    <span class="n">layers</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a>    <span class="n">dropout</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>    <span class="n">num_fragments</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a>    <span class="n">charge_dims_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a>    <span class="n">nce_dims_pct</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.05</span><span class="p">,</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a>    <span class="n">final_decoder</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;linear&quot;</span><span class="p">,</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a>    <span class="n">charge_dims</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">d_model</span> <span class="o">*</span> <span class="n">charge_dims_pct</span><span class="p">)</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a>    <span class="n">nce_dims</span> <span class="o">=</span> <span class="n">math</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="n">d_model</span> <span class="o">*</span> <span class="n">nce_dims_pct</span><span class="p">)</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a>    <span class="n">n_embeds</span> <span class="o">=</span> <span class="n">d_model</span> <span class="o">-</span> <span class="p">(</span><span class="n">charge_dims</span> <span class="o">+</span> <span class="n">nce_dims</span><span class="p">)</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>        <span class="n">embed_dims</span><span class="o">=</span><span class="n">n_embeds</span><span class="p">,</span>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>        <span class="n">nhead</span><span class="o">=</span><span class="n">nhead</span><span class="p">,</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>        <span class="n">nhid</span><span class="o">=</span><span class="n">nhid</span><span class="p">,</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>        <span class="n">layers</span><span class="o">=</span><span class="n">layers</span><span class="p">,</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">dropout</span><span class="o">=</span><span class="n">dropout</span><span class="p">,</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="n">num_outputs</span><span class="o">=</span><span class="n">num_fragments</span><span class="p">,</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>        <span class="n">final_decoder</span><span class="o">=</span><span class="n">final_decoder</span><span class="p">,</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">charge_encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>        <span class="n">dims_add</span><span class="o">=</span><span class="n">charge_dims</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_model</span><span class="p">)</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">nce_encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span>
<a id="__codelineno-0-165" name="__codelineno-0-165"></a>        <span class="n">dims_add</span><span class="o">=</span><span class="n">nce_dims</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_model</span><span class="p">)</span>
<a id="__codelineno-0-166" name="__codelineno-0-166"></a>    <span class="p">)</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">init_weights</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.charge_encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">charge_encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span><span class="n">dims_add</span><span class="o">=</span><span class="n">charge_dims</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">10.0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_model</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.nce_encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">nce_encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span><span class="n">dims_add</span><span class="o">=</span><span class="n">nce_dims</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mf">100.0</span><span class="p">,</span> <span class="n">scaling</span><span class="o">=</span><span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_model</span><span class="p">))</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.init_weights" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_weights</span><span class="p">()</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="k">def</span> <span class="nf">init_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a>    <span class="n">initrange</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a>    <span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">trans_decoder_embedding</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="n">initrange</span><span class="p">,</span> <span class="n">initrange</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.preprocess_query" class="doc doc-heading">
<code class="highlight language-python"><span class="n">preprocess_query</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">nce</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-173" name="__codelineno-0-173"></a><span class="k">def</span> <span class="nf">preprocess_query</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">query</span><span class="p">,</span> <span class="n">charge</span><span class="p">,</span> <span class="n">nce</span><span class="p">):</span>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a>    <span class="c1"># [T, B, E2]</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a>    <span class="n">trans_decoder_tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">charge_encoder</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">charge</span><span class="p">)</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>    <span class="c1"># [T, B, E1]</span>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a>    <span class="n">trans_decoder_tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">nce_encoder</span><span class="p">(</span><span class="n">trans_decoder_tgt</span><span class="p">,</span> <span class="n">nce</span><span class="p">)</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a>    <span class="c1"># [T, B, E]</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a>    <span class="k">return</span> <span class="n">trans_decoder_tgt</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.ms_transformer_layers.FragmentTransformerDecoder.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">memory</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">memory_key_padding_mask</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/ms_transformer_layers.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span>
<span class="normal"><a href="#__codelineno-0-199">199</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a>    <span class="n">memory</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a>    <span class="n">memory_key_padding_mask</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a>    <span class="n">charge</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a>    <span class="n">nce</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a>    <span class="n">trans_decoder_tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_learnable_query</span><span class="p">(</span><span class="n">batch_size</span><span class="o">=</span><span class="n">charge</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a>    <span class="n">trans_decoder_tgt</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">preprocess_query</span><span class="p">(</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a>        <span class="n">trans_decoder_tgt</span><span class="p">,</span> <span class="n">nce</span><span class="o">=</span><span class="n">nce</span><span class="p">,</span> <span class="n">charge</span><span class="o">=</span><span class="n">charge</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a>    <span class="p">)</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="c1"># [T, B, E]</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="n">output</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">decoder_forward</span><span class="p">(</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">trans_decoder_tgt</span><span class="o">=</span><span class="n">trans_decoder_tgt</span><span class="p">,</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>        <span class="n">memory</span><span class="o">=</span><span class="n">memory</span><span class="p">,</span>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>        <span class="n">memory_key_padding_mask</span><span class="o">=</span><span class="n">memory_key_padding_mask</span><span class="p">,</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="p">)</span>
<a id="__codelineno-0-199" name="__codelineno-0-199"></a>    <span class="k">return</span> <span class="n">output</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>
<h3 id="elfragmentador.model.ms_transformer_layers-functions">Functions</h3>



  </div>

  </div>

</div>

<div class="doc doc-object doc-module">



<h2 id="elfragmentador.model.nn_encoding" class="doc doc-heading">
          <code>elfragmentador.model.nn_encoding</code>


</h2>

  <div class="doc doc-contents first">
  
      <p>Implements torch models to handle encoding and decoding of positions as well as.</p>
<p>learnable embeddings for the aminoacids and ions.</p>

  

  <div class="doc doc-children">





<h3 id="elfragmentador.model.nn_encoding-attributes">Attributes</h3>

<div class="doc doc-object doc-attribute">



<h4 id="elfragmentador.model.nn_encoding.LiteralFalse" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nn_encoding</span><span class="o">.</span><span class="n">LiteralFalse</span> <span class="o">=</span> <span class="n">Literal</span><span class="p">[</span><span class="kc">False</span><span class="p">]</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-module-attribute"><code>module-attribute</code></small>
  </span>

</h4>


  <div class="doc doc-contents ">
  </div>

</div>
<h3 id="elfragmentador.model.nn_encoding-classes">Classes</h3>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.nn_encoding.ConcatenationEncoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nn_encoding</span><span class="o">.</span><span class="n">ConcatenationEncoder</span><span class="p">(</span><span class="n">dims_add</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span> <span class="n">static_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span> <span class="n">scaling</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>


  
      <p>ConcatenationEncoder concatenates information into the embedding.</p>
<p>Adds information on continuous variables into an embedding by concatenating
an n number of dimensions to it.</p>
<p>It is meant to add different information to every element in a batch, but the
same information (number of dimensions) to every element of a sequence inside
an element of the batch. (x[i_1,j,-y:] = x[i_2,j,-y:]) ; being (y) the
number of added dimensions.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>dims_add</code></td>
          <td class="doc-param-details">
            <p>Number of dimensions to add as an encoding</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>max_val</code></td>
          <td class="doc-param-details">
            <p>maximum expected value of the variable that will be encoded,
by default 200.0</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>float</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>200.0</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>static_size</code></td>
          <td class="doc-param-details">
            <p>Optional ingeter to pass in order to make the size deterministic.
This is only required if you want to export your model to torchscript,
by default False</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="typing.Union">Union</span>[<span title="typing.Literal">Literal</span>[False], float]</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>False</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span><span class="n">dims_add</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="n">max_val</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">7</span><span class="p">]]))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">]]))</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-22">22</a></span>
<span class="normal"><a href="#__codelineno-0-23">23</a></span>
<span class="normal"><a href="#__codelineno-0-24">24</a></span>
<span class="normal"><a href="#__codelineno-0-25">25</a></span>
<span class="normal"><a href="#__codelineno-0-26">26</a></span>
<span class="normal"><a href="#__codelineno-0-27">27</a></span>
<span class="normal"><a href="#__codelineno-0-28">28</a></span>
<span class="normal"><a href="#__codelineno-0-29">29</a></span>
<span class="normal"><a href="#__codelineno-0-30">30</a></span>
<span class="normal"><a href="#__codelineno-0-31">31</a></span>
<span class="normal"><a href="#__codelineno-0-32">32</a></span>
<span class="normal"><a href="#__codelineno-0-33">33</a></span>
<span class="normal"><a href="#__codelineno-0-34">34</a></span>
<span class="normal"><a href="#__codelineno-0-35">35</a></span>
<span class="normal"><a href="#__codelineno-0-36">36</a></span>
<span class="normal"><a href="#__codelineno-0-37">37</a></span>
<span class="normal"><a href="#__codelineno-0-38">38</a></span>
<span class="normal"><a href="#__codelineno-0-39">39</a></span>
<span class="normal"><a href="#__codelineno-0-40">40</a></span>
<span class="normal"><a href="#__codelineno-0-41">41</a></span>
<span class="normal"><a href="#__codelineno-0-42">42</a></span>
<span class="normal"><a href="#__codelineno-0-43">43</a></span>
<span class="normal"><a href="#__codelineno-0-44">44</a></span>
<span class="normal"><a href="#__codelineno-0-45">45</a></span>
<span class="normal"><a href="#__codelineno-0-46">46</a></span>
<span class="normal"><a href="#__codelineno-0-47">47</a></span>
<span class="normal"><a href="#__codelineno-0-48">48</a></span>
<span class="normal"><a href="#__codelineno-0-49">49</a></span>
<span class="normal"><a href="#__codelineno-0-50">50</a></span>
<span class="normal"><a href="#__codelineno-0-51">51</a></span>
<span class="normal"><a href="#__codelineno-0-52">52</a></span>
<span class="normal"><a href="#__codelineno-0-53">53</a></span>
<span class="normal"><a href="#__codelineno-0-54">54</a></span>
<span class="normal"><a href="#__codelineno-0-55">55</a></span>
<span class="normal"><a href="#__codelineno-0-56">56</a></span>
<span class="normal"><a href="#__codelineno-0-57">57</a></span>
<span class="normal"><a href="#__codelineno-0-58">58</a></span>
<span class="normal"><a href="#__codelineno-0-59">59</a></span>
<span class="normal"><a href="#__codelineno-0-60">60</a></span>
<span class="normal"><a href="#__codelineno-0-61">61</a></span>
<span class="normal"><a href="#__codelineno-0-62">62</a></span>
<span class="normal"><a href="#__codelineno-0-63">63</a></span>
<span class="normal"><a href="#__codelineno-0-64">64</a></span>
<span class="normal"><a href="#__codelineno-0-65">65</a></span>
<span class="normal"><a href="#__codelineno-0-66">66</a></span>
<span class="normal"><a href="#__codelineno-0-67">67</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-22" name="__codelineno-0-22"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-23" name="__codelineno-0-23"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-24" name="__codelineno-0-24"></a>    <span class="n">dims_add</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-25" name="__codelineno-0-25"></a>    <span class="n">max_val</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="mf">200.0</span><span class="p">,</span>
<a id="__codelineno-0-26" name="__codelineno-0-26"></a>    <span class="n">static_size</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-27" name="__codelineno-0-27"></a>    <span class="n">scaling</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
<a id="__codelineno-0-28" name="__codelineno-0-28"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-29" name="__codelineno-0-29"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;ConcatenationEncoder concatenates information into the embedding.</span>
<a id="__codelineno-0-30" name="__codelineno-0-30"></a>
<a id="__codelineno-0-31" name="__codelineno-0-31"></a><span class="sd">    Adds information on continuous variables into an embedding by concatenating</span>
<a id="__codelineno-0-32" name="__codelineno-0-32"></a><span class="sd">    an n number of dimensions to it.</span>
<a id="__codelineno-0-33" name="__codelineno-0-33"></a>
<a id="__codelineno-0-34" name="__codelineno-0-34"></a><span class="sd">    It is meant to add different information to every element in a batch, but the</span>
<a id="__codelineno-0-35" name="__codelineno-0-35"></a><span class="sd">    same information (number of dimensions) to every element of a sequence inside</span>
<a id="__codelineno-0-36" name="__codelineno-0-36"></a><span class="sd">    an element of the batch. \(x[i_1,j,-y:] = x[i_2,j,-y:]\) ; being \(y\) the</span>
<a id="__codelineno-0-37" name="__codelineno-0-37"></a><span class="sd">    number of added dimensions.</span>
<a id="__codelineno-0-38" name="__codelineno-0-38"></a>
<a id="__codelineno-0-39" name="__codelineno-0-39"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-40" name="__codelineno-0-40"></a><span class="sd">        dims_add (int): Number of dimensions to add as an encoding</span>
<a id="__codelineno-0-41" name="__codelineno-0-41"></a><span class="sd">        max_val (float, optional):</span>
<a id="__codelineno-0-42" name="__codelineno-0-42"></a><span class="sd">            maximum expected value of the variable that will be encoded,</span>
<a id="__codelineno-0-43" name="__codelineno-0-43"></a><span class="sd">            by default 200.0</span>
<a id="__codelineno-0-44" name="__codelineno-0-44"></a><span class="sd">        static_size (Union[Literal[False], float], optional):</span>
<a id="__codelineno-0-45" name="__codelineno-0-45"></a><span class="sd">            Optional ingeter to pass in order to make the size deterministic.</span>
<a id="__codelineno-0-46" name="__codelineno-0-46"></a><span class="sd">            This is only required if you want to export your model to torchscript,</span>
<a id="__codelineno-0-47" name="__codelineno-0-47"></a><span class="sd">            by default False</span>
<a id="__codelineno-0-48" name="__codelineno-0-48"></a>
<a id="__codelineno-0-49" name="__codelineno-0-49"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-50" name="__codelineno-0-50"></a><span class="sd">        &gt;&gt;&gt; x1 = torch.zeros((5, 1, 20))</span>
<a id="__codelineno-0-51" name="__codelineno-0-51"></a><span class="sd">        &gt;&gt;&gt; x2 = torch.zeros((5, 2, 20))</span>
<a id="__codelineno-0-52" name="__codelineno-0-52"></a><span class="sd">        &gt;&gt;&gt; encoder = ConcatenationEncoder(dims_add = 10, max_val=10)</span>
<a id="__codelineno-0-53" name="__codelineno-0-53"></a><span class="sd">        &gt;&gt;&gt; output = encoder(x1, torch.tensor([[7]]))</span>
<a id="__codelineno-0-54" name="__codelineno-0-54"></a><span class="sd">        &gt;&gt;&gt; output = encoder(x2, torch.tensor([[7], [4]]))</span>
<a id="__codelineno-0-55" name="__codelineno-0-55"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-56" name="__codelineno-0-56"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-57" name="__codelineno-0-57"></a>
<a id="__codelineno-0-58" name="__codelineno-0-58"></a>    <span class="c1"># pos would be a variable ...</span>
<a id="__codelineno-0-59" name="__codelineno-0-59"></a>    <span class="n">div_term</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
<a id="__codelineno-0-60" name="__codelineno-0-60"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">dims_add</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-61" name="__codelineno-0-61"></a>        <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="mi">2</span> <span class="o">*</span> <span class="n">max_val</span><span class="p">))</span> <span class="o">/</span> <span class="p">(</span><span class="n">dims_add</span><span class="p">))</span>
<a id="__codelineno-0-62" name="__codelineno-0-62"></a>    <span class="p">)</span>
<a id="__codelineno-0-63" name="__codelineno-0-63"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;div_term&quot;</span><span class="p">,</span> <span class="n">div_term</span><span class="p">)</span>
<a id="__codelineno-0-64" name="__codelineno-0-64"></a>    <span class="c1"># TODO add option to make trainable</span>
<a id="__codelineno-0-65" name="__codelineno-0-65"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="n">static_size</span>
<a id="__codelineno-0-66" name="__codelineno-0-66"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">dims_add</span> <span class="o">=</span> <span class="n">dims_add</span>
<a id="__codelineno-0-67" name="__codelineno-0-67"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span> <span class="o">=</span> <span class="n">scaling</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.nn_encoding.ConcatenationEncoder-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.ConcatenationEncoder.static_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">static_size</span> <span class="o">=</span> <span class="n">static_size</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.ConcatenationEncoder.dims_add" class="doc doc-heading">
<code class="highlight language-python"><span class="n">dims_add</span> <span class="o">=</span> <span class="n">dims_add</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.ConcatenationEncoder.scaling" class="doc doc-heading">
<code class="highlight language-python"><span class="n">scaling</span> <span class="o">=</span> <span class="n">scaling</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.nn_encoding.ConcatenationEncoder-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.ConcatenationEncoder.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Forward pass thought the encoder.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td class="doc-param-details">
            <p>the sequence fed to the encoder model (required).
shape is <strong>[sequence length, batch size, embed dim]</strong>.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>val</code></td>
          <td class="doc-param-details">
            <p>value to be encoded into the sequence (required).
Shape is <strong>[batch size, 1]</strong>.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="torch.Tensor">Tensor</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Tensor (Tensor),</p>
          </td>
        </tr>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="torch.Tensor">Tensor</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Of shape <strong>[sequence length, batch size, embed_dim + added_dims]</strong></p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x1</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">((</span><span class="mi">5</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">20</span><span class="p">))</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x2</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">x1</span><span class="p">,</span> <span class="n">x1</span><span class="o">+</span><span class="mi">1</span><span class="p">],</span> <span class="n">axis</span> <span class="o">=</span> <span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">encoder</span> <span class="o">=</span> <span class="n">ConcatenationEncoder</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="n">max_val</span> <span class="o">=</span> <span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">7</span><span class="p">]]))</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">torch.Size([5, 1, 30])</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">encoder</span><span class="p">(</span><span class="n">x2</span><span class="p">,</span> <span class="n">torch</span><span class="o">.</span><span class="n">tensor</span><span class="p">([[</span><span class="mi">7</span><span class="p">],</span> <span class="p">[</span><span class="mi">4</span><span class="p">]]))</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-69"> 69</a></span>
<span class="normal"><a href="#__codelineno-0-70"> 70</a></span>
<span class="normal"><a href="#__codelineno-0-71"> 71</a></span>
<span class="normal"><a href="#__codelineno-0-72"> 72</a></span>
<span class="normal"><a href="#__codelineno-0-73"> 73</a></span>
<span class="normal"><a href="#__codelineno-0-74"> 74</a></span>
<span class="normal"><a href="#__codelineno-0-75"> 75</a></span>
<span class="normal"><a href="#__codelineno-0-76"> 76</a></span>
<span class="normal"><a href="#__codelineno-0-77"> 77</a></span>
<span class="normal"><a href="#__codelineno-0-78"> 78</a></span>
<span class="normal"><a href="#__codelineno-0-79"> 79</a></span>
<span class="normal"><a href="#__codelineno-0-80"> 80</a></span>
<span class="normal"><a href="#__codelineno-0-81"> 81</a></span>
<span class="normal"><a href="#__codelineno-0-82"> 82</a></span>
<span class="normal"><a href="#__codelineno-0-83"> 83</a></span>
<span class="normal"><a href="#__codelineno-0-84"> 84</a></span>
<span class="normal"><a href="#__codelineno-0-85"> 85</a></span>
<span class="normal"><a href="#__codelineno-0-86"> 86</a></span>
<span class="normal"><a href="#__codelineno-0-87"> 87</a></span>
<span class="normal"><a href="#__codelineno-0-88"> 88</a></span>
<span class="normal"><a href="#__codelineno-0-89"> 89</a></span>
<span class="normal"><a href="#__codelineno-0-90"> 90</a></span>
<span class="normal"><a href="#__codelineno-0-91"> 91</a></span>
<span class="normal"><a href="#__codelineno-0-92"> 92</a></span>
<span class="normal"><a href="#__codelineno-0-93"> 93</a></span>
<span class="normal"><a href="#__codelineno-0-94"> 94</a></span>
<span class="normal"><a href="#__codelineno-0-95"> 95</a></span>
<span class="normal"><a href="#__codelineno-0-96"> 96</a></span>
<span class="normal"><a href="#__codelineno-0-97"> 97</a></span>
<span class="normal"><a href="#__codelineno-0-98"> 98</a></span>
<span class="normal"><a href="#__codelineno-0-99"> 99</a></span>
<span class="normal"><a href="#__codelineno-0-100">100</a></span>
<span class="normal"><a href="#__codelineno-0-101">101</a></span>
<span class="normal"><a href="#__codelineno-0-102">102</a></span>
<span class="normal"><a href="#__codelineno-0-103">103</a></span>
<span class="normal"><a href="#__codelineno-0-104">104</a></span>
<span class="normal"><a href="#__codelineno-0-105">105</a></span>
<span class="normal"><a href="#__codelineno-0-106">106</a></span>
<span class="normal"><a href="#__codelineno-0-107">107</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-69" name="__codelineno-0-69"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">,</span> <span class="n">val</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-70" name="__codelineno-0-70"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-71" name="__codelineno-0-71"></a><span class="sd">    Forward pass thought the encoder.</span>
<a id="__codelineno-0-72" name="__codelineno-0-72"></a>
<a id="__codelineno-0-73" name="__codelineno-0-73"></a><span class="sd">    Parameters:</span>
<a id="__codelineno-0-74" name="__codelineno-0-74"></a><span class="sd">        x (Tensor):</span>
<a id="__codelineno-0-75" name="__codelineno-0-75"></a><span class="sd">            the sequence fed to the encoder model (required).</span>
<a id="__codelineno-0-76" name="__codelineno-0-76"></a><span class="sd">            shape is **[sequence length, batch size, embed dim]**.</span>
<a id="__codelineno-0-77" name="__codelineno-0-77"></a><span class="sd">        val (Tensor):</span>
<a id="__codelineno-0-78" name="__codelineno-0-78"></a><span class="sd">            value to be encoded into the sequence (required).</span>
<a id="__codelineno-0-79" name="__codelineno-0-79"></a><span class="sd">            Shape is **[batch size, 1]**.</span>
<a id="__codelineno-0-80" name="__codelineno-0-80"></a>
<a id="__codelineno-0-81" name="__codelineno-0-81"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-82" name="__codelineno-0-82"></a><span class="sd">        Tensor (Tensor),</span>
<a id="__codelineno-0-83" name="__codelineno-0-83"></a><span class="sd">        Of shape **[sequence length, batch size, embed_dim + added_dims]**</span>
<a id="__codelineno-0-84" name="__codelineno-0-84"></a>
<a id="__codelineno-0-85" name="__codelineno-0-85"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-86" name="__codelineno-0-86"></a><span class="sd">        &gt;&gt;&gt; x1 = torch.zeros((5, 1, 20))</span>
<a id="__codelineno-0-87" name="__codelineno-0-87"></a><span class="sd">        &gt;&gt;&gt; x2 = torch.cat([x1, x1+1], axis = 1)</span>
<a id="__codelineno-0-88" name="__codelineno-0-88"></a><span class="sd">        &gt;&gt;&gt; encoder = ConcatenationEncoder(10, max_val = 10)</span>
<a id="__codelineno-0-89" name="__codelineno-0-89"></a><span class="sd">        &gt;&gt;&gt; output = encoder(x1, torch.tensor([[7]]))</span>
<a id="__codelineno-0-90" name="__codelineno-0-90"></a><span class="sd">        &gt;&gt;&gt; output.shape</span>
<a id="__codelineno-0-91" name="__codelineno-0-91"></a><span class="sd">        torch.Size([5, 1, 30])</span>
<a id="__codelineno-0-92" name="__codelineno-0-92"></a><span class="sd">        &gt;&gt;&gt; output = encoder(x2, torch.tensor([[7], [4]]))</span>
<a id="__codelineno-0-93" name="__codelineno-0-93"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-94" name="__codelineno-0-94"></a>
<a id="__codelineno-0-95" name="__codelineno-0-95"></a>    <span class="n">e_sin</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">div_term</span><span class="p">)</span>
<a id="__codelineno-0-96" name="__codelineno-0-96"></a>    <span class="n">e_cos</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">val</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">div_term</span><span class="p">)</span>
<a id="__codelineno-0-97" name="__codelineno-0-97"></a>    <span class="n">e</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">([</span><span class="n">e_sin</span><span class="p">,</span> <span class="n">e_cos</span><span class="p">],</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-98" name="__codelineno-0-98"></a>
<a id="__codelineno-0-99" name="__codelineno-0-99"></a>    <span class="k">assert</span> <span class="p">(</span>
<a id="__codelineno-0-100" name="__codelineno-0-100"></a>        <span class="n">e</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">&lt;</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims_add</span> <span class="o">+</span> <span class="mi">2</span>
<a id="__codelineno-0-101" name="__codelineno-0-101"></a>    <span class="p">),</span> <span class="s2">&quot;Internal error in concatenation encoder&quot;</span>
<a id="__codelineno-0-102" name="__codelineno-0-102"></a>
<a id="__codelineno-0-103" name="__codelineno-0-103"></a>    <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="p">[</span><span class="o">...</span><span class="p">,</span> <span class="p">:</span> <span class="bp">self</span><span class="o">.</span><span class="n">dims_add</span><span class="p">]</span>
<a id="__codelineno-0-104" name="__codelineno-0-104"></a>    <span class="n">e</span> <span class="o">=</span> <span class="n">e</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">expand</span><span class="p">(</span><span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">),</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">scaling</span>
<a id="__codelineno-0-105" name="__codelineno-0-105"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cat</span><span class="p">((</span><span class="n">x</span><span class="p">,</span> <span class="n">e</span><span class="p">),</span> <span class="n">axis</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-106" name="__codelineno-0-106"></a>
<a id="__codelineno-0-107" name="__codelineno-0-107"></a>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nn_encoding</span><span class="o">.</span><span class="n">FourierPositionalEncoding</span><span class="p">(</span><span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span> <span class="n">static_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LiteralFalse</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>


  
      <p>FourierPositionalEncoding adds positional information to tensors.</p>
<p>Inject some information about the relative or absolute position of the tokens
in the sequence. The positional encodings have the same dimension as
the embeddings, so that the two can be summed. Here, we use sine and cosine
functions of different frequencies.</p>
<p>({PosEncoder}(pos, 2i) = sin(pos/10000^(2i/d_model))
({PosEncoder}(pos, 2i+1) = cos(pos/10000^(2i/d_model)))</p>
<p>where pos is the word position and i is the embed idx)</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>d_model</code></td>
          <td class="doc-param-details">
            <p>the embed dim (required), must be even.</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>max_len</code></td>
          <td class="doc-param-details">
            <p>the max. length of the incoming sequence (default=5000).</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code>int</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>5000</code>
                </span>
            </p>
          </td>
        </tr>
        <tr>
          <td><code>static_size</code></td>
          <td class="doc-param-details">
            <p>If it is an integer it is the size of the inputs that will
be given, it is used only when tracing the model for torchscript
(since torchscript needs fixed length inputs), by default False</p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="typing.Union">Union</span>[<a class="autorefs autorefs-internal" title="elfragmentador.model.nn_encoding.LiteralFalse" href="#elfragmentador.model.nn_encoding.LiteralFalse">LiteralFalse</a>, int]</code>
                </span>
                <span class="doc-param-default">
                  <b>DEFAULT:</b> 
                    <code>False</code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

<details class="note">
  <summary>Note</summary>
  <p>Therefore encoding are <strong>(seq_length, batch, encodings)</strong></p>
</details>
<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">posencoder</span> <span class="o">=</span> <span class="n">FourierPositionalEncoding</span><span class="p">(</span><span class="mi">20</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">20</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="go">torch.Size([2, 1, 20])</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">posencoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="go">torch.Size([2, 1, 20])</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-111">111</a></span>
<span class="normal"><a href="#__codelineno-0-112">112</a></span>
<span class="normal"><a href="#__codelineno-0-113">113</a></span>
<span class="normal"><a href="#__codelineno-0-114">114</a></span>
<span class="normal"><a href="#__codelineno-0-115">115</a></span>
<span class="normal"><a href="#__codelineno-0-116">116</a></span>
<span class="normal"><a href="#__codelineno-0-117">117</a></span>
<span class="normal"><a href="#__codelineno-0-118">118</a></span>
<span class="normal"><a href="#__codelineno-0-119">119</a></span>
<span class="normal"><a href="#__codelineno-0-120">120</a></span>
<span class="normal"><a href="#__codelineno-0-121">121</a></span>
<span class="normal"><a href="#__codelineno-0-122">122</a></span>
<span class="normal"><a href="#__codelineno-0-123">123</a></span>
<span class="normal"><a href="#__codelineno-0-124">124</a></span>
<span class="normal"><a href="#__codelineno-0-125">125</a></span>
<span class="normal"><a href="#__codelineno-0-126">126</a></span>
<span class="normal"><a href="#__codelineno-0-127">127</a></span>
<span class="normal"><a href="#__codelineno-0-128">128</a></span>
<span class="normal"><a href="#__codelineno-0-129">129</a></span>
<span class="normal"><a href="#__codelineno-0-130">130</a></span>
<span class="normal"><a href="#__codelineno-0-131">131</a></span>
<span class="normal"><a href="#__codelineno-0-132">132</a></span>
<span class="normal"><a href="#__codelineno-0-133">133</a></span>
<span class="normal"><a href="#__codelineno-0-134">134</a></span>
<span class="normal"><a href="#__codelineno-0-135">135</a></span>
<span class="normal"><a href="#__codelineno-0-136">136</a></span>
<span class="normal"><a href="#__codelineno-0-137">137</a></span>
<span class="normal"><a href="#__codelineno-0-138">138</a></span>
<span class="normal"><a href="#__codelineno-0-139">139</a></span>
<span class="normal"><a href="#__codelineno-0-140">140</a></span>
<span class="normal"><a href="#__codelineno-0-141">141</a></span>
<span class="normal"><a href="#__codelineno-0-142">142</a></span>
<span class="normal"><a href="#__codelineno-0-143">143</a></span>
<span class="normal"><a href="#__codelineno-0-144">144</a></span>
<span class="normal"><a href="#__codelineno-0-145">145</a></span>
<span class="normal"><a href="#__codelineno-0-146">146</a></span>
<span class="normal"><a href="#__codelineno-0-147">147</a></span>
<span class="normal"><a href="#__codelineno-0-148">148</a></span>
<span class="normal"><a href="#__codelineno-0-149">149</a></span>
<span class="normal"><a href="#__codelineno-0-150">150</a></span>
<span class="normal"><a href="#__codelineno-0-151">151</a></span>
<span class="normal"><a href="#__codelineno-0-152">152</a></span>
<span class="normal"><a href="#__codelineno-0-153">153</a></span>
<span class="normal"><a href="#__codelineno-0-154">154</a></span>
<span class="normal"><a href="#__codelineno-0-155">155</a></span>
<span class="normal"><a href="#__codelineno-0-156">156</a></span>
<span class="normal"><a href="#__codelineno-0-157">157</a></span>
<span class="normal"><a href="#__codelineno-0-158">158</a></span>
<span class="normal"><a href="#__codelineno-0-159">159</a></span>
<span class="normal"><a href="#__codelineno-0-160">160</a></span>
<span class="normal"><a href="#__codelineno-0-161">161</a></span>
<span class="normal"><a href="#__codelineno-0-162">162</a></span>
<span class="normal"><a href="#__codelineno-0-163">163</a></span>
<span class="normal"><a href="#__codelineno-0-164">164</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-111" name="__codelineno-0-111"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-112" name="__codelineno-0-112"></a>    <span class="bp">self</span><span class="p">,</span>
<a id="__codelineno-0-113" name="__codelineno-0-113"></a>    <span class="n">d_model</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
<a id="__codelineno-0-114" name="__codelineno-0-114"></a>    <span class="n">max_len</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">5000</span><span class="p">,</span>
<a id="__codelineno-0-115" name="__codelineno-0-115"></a>    <span class="n">static_size</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">LiteralFalse</span><span class="p">,</span> <span class="nb">int</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<a id="__codelineno-0-116" name="__codelineno-0-116"></a><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-117" name="__codelineno-0-117"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;FourierPositionalEncoding adds positional information to tensors.</span>
<a id="__codelineno-0-118" name="__codelineno-0-118"></a>
<a id="__codelineno-0-119" name="__codelineno-0-119"></a><span class="sd">    Inject some information about the relative or absolute position of the tokens</span>
<a id="__codelineno-0-120" name="__codelineno-0-120"></a><span class="sd">    in the sequence. The positional encodings have the same dimension as</span>
<a id="__codelineno-0-121" name="__codelineno-0-121"></a><span class="sd">    the embeddings, so that the two can be summed. Here, we use sine and cosine</span>
<a id="__codelineno-0-122" name="__codelineno-0-122"></a><span class="sd">    functions of different frequencies.</span>
<a id="__codelineno-0-123" name="__codelineno-0-123"></a>
<a id="__codelineno-0-124" name="__codelineno-0-124"></a><span class="sd">    \({PosEncoder}(pos, 2i) = sin(pos/10000^(2i/d_model)\)</span>
<a id="__codelineno-0-125" name="__codelineno-0-125"></a><span class="sd">    \({PosEncoder}(pos, 2i+1) = cos(pos/10000^(2i/d_model))\)</span>
<a id="__codelineno-0-126" name="__codelineno-0-126"></a>
<a id="__codelineno-0-127" name="__codelineno-0-127"></a><span class="sd">    where pos is the word position and i is the embed idx)</span>
<a id="__codelineno-0-128" name="__codelineno-0-128"></a>
<a id="__codelineno-0-129" name="__codelineno-0-129"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-130" name="__codelineno-0-130"></a><span class="sd">        d_model (int):</span>
<a id="__codelineno-0-131" name="__codelineno-0-131"></a><span class="sd">            the embed dim (required), must be even.</span>
<a id="__codelineno-0-132" name="__codelineno-0-132"></a><span class="sd">        max_len (int):</span>
<a id="__codelineno-0-133" name="__codelineno-0-133"></a><span class="sd">            the max. length of the incoming sequence (default=5000).</span>
<a id="__codelineno-0-134" name="__codelineno-0-134"></a><span class="sd">        static_size (Union[LiteralFalse, int], optional):</span>
<a id="__codelineno-0-135" name="__codelineno-0-135"></a><span class="sd">            If it is an integer it is the size of the inputs that will</span>
<a id="__codelineno-0-136" name="__codelineno-0-136"></a><span class="sd">            be given, it is used only when tracing the model for torchscript</span>
<a id="__codelineno-0-137" name="__codelineno-0-137"></a><span class="sd">            (since torchscript needs fixed length inputs), by default False</span>
<a id="__codelineno-0-138" name="__codelineno-0-138"></a>
<a id="__codelineno-0-139" name="__codelineno-0-139"></a><span class="sd">    Note:</span>
<a id="__codelineno-0-140" name="__codelineno-0-140"></a><span class="sd">        Therefore encoding are **(seq_length, batch, encodings)**</span>
<a id="__codelineno-0-141" name="__codelineno-0-141"></a>
<a id="__codelineno-0-142" name="__codelineno-0-142"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-143" name="__codelineno-0-143"></a><span class="sd">        &gt;&gt;&gt; posencoder = FourierPositionalEncoding(20, max_len=20)</span>
<a id="__codelineno-0-144" name="__codelineno-0-144"></a><span class="sd">        &gt;&gt;&gt; x = torch.ones((2,1,20)).float()</span>
<a id="__codelineno-0-145" name="__codelineno-0-145"></a><span class="sd">        &gt;&gt;&gt; x.shape</span>
<a id="__codelineno-0-146" name="__codelineno-0-146"></a><span class="sd">        torch.Size([2, 1, 20])</span>
<a id="__codelineno-0-147" name="__codelineno-0-147"></a><span class="sd">        &gt;&gt;&gt; posencoder(x).shape</span>
<a id="__codelineno-0-148" name="__codelineno-0-148"></a><span class="sd">        torch.Size([2, 1, 20])</span>
<a id="__codelineno-0-149" name="__codelineno-0-149"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-150" name="__codelineno-0-150"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-151" name="__codelineno-0-151"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">d_model</span> <span class="o">=</span> <span class="n">d_model</span>
<a id="__codelineno-0-152" name="__codelineno-0-152"></a>
<a id="__codelineno-0-153" name="__codelineno-0-153"></a>    <span class="n">pe</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">zeros</span><span class="p">(</span><span class="n">max_len</span><span class="p">,</span> <span class="n">d_model</span><span class="p">)</span>
<a id="__codelineno-0-154" name="__codelineno-0-154"></a>    <span class="n">position</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_len</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
<a id="__codelineno-0-155" name="__codelineno-0-155"></a>    <span class="n">div_term</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span>
<a id="__codelineno-0-156" name="__codelineno-0-156"></a>        <span class="n">torch</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">d_model</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="n">dtype</span><span class="o">=</span><span class="n">torch</span><span class="o">.</span><span class="n">float</span><span class="p">)</span>
<a id="__codelineno-0-157" name="__codelineno-0-157"></a>        <span class="o">*</span> <span class="p">(</span><span class="o">-</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="mf">10000.0</span><span class="p">)</span> <span class="o">/</span> <span class="n">d_model</span><span class="p">)</span>
<a id="__codelineno-0-158" name="__codelineno-0-158"></a>    <span class="p">)</span>
<a id="__codelineno-0-159" name="__codelineno-0-159"></a>    <span class="n">pe</span><span class="p">[:,</span> <span class="mi">0</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">sin</span><span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="n">div_term</span><span class="p">)</span>
<a id="__codelineno-0-160" name="__codelineno-0-160"></a>    <span class="n">pe</span><span class="p">[:,</span> <span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">cos</span><span class="p">(</span><span class="n">position</span> <span class="o">*</span> <span class="n">div_term</span><span class="p">)</span>
<a id="__codelineno-0-161" name="__codelineno-0-161"></a>    <span class="n">pe</span> <span class="o">=</span> <span class="n">pe</span><span class="o">.</span><span class="n">unsqueeze</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span> <span class="o">/</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">d_model</span><span class="p">)</span>
<a id="__codelineno-0-162" name="__codelineno-0-162"></a>    <span class="c1"># Pe has [shape max_len, 1, d_model]</span>
<a id="__codelineno-0-163" name="__codelineno-0-163"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">register_buffer</span><span class="p">(</span><span class="s2">&quot;pe&quot;</span><span class="p">,</span> <span class="n">pe</span><span class="p">)</span>
<a id="__codelineno-0-164" name="__codelineno-0-164"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">static_size</span> <span class="o">=</span> <span class="n">static_size</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding.d_model" class="doc doc-heading">
<code class="highlight language-python"><span class="n">d_model</span> <span class="o">=</span> <span class="n">d_model</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding.static_size" class="doc doc-heading">
<code class="highlight language-python"><span class="n">static_size</span> <span class="o">=</span> <span class="n">static_size</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Forward pass though the encoder.</p>

  <table>
    <thead>
      <tr>
        <th><b>PARAMETER</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td><code>x</code></td>
          <td class="doc-param-details">
            <p>the sequence fed to the positional encoder model (required).
Shape <strong>[sequence length, batch size, embed dim]</strong></p>
            <p>
                <span class="doc-param-annotation">
                  <b>TYPE:</b>
                    <code><span title="torch.Tensor">Tensor</span></code>
                </span>
            </p>
          </td>
        </tr>
    </tbody>
  </table>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="torch.Tensor">Tensor</span></code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Tensor (Tensor), of shape <strong>[sequence length, batch size, embed dim]</strong></p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pytorch_lightning</span> <span class="k">as</span> <span class="nn">pl</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pl</span><span class="o">.</span><span class="n">seed_everything</span><span class="p">(</span><span class="mi">42</span><span class="p">)</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="go">42</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">x</span> <span class="o">=</span> <span class="n">torch</span><span class="o">.</span><span class="n">ones</span><span class="p">((</span><span class="mi">4</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span><span class="o">.</span><span class="n">float</span><span class="p">()</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">pos_encoder</span> <span class="o">=</span> <span class="n">FourierPositionalEncoding</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="mi">10</span><span class="p">)</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span> <span class="o">=</span> <span class="n">pos_encoder</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span><span class="o">.</span><span class="n">shape</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="go">torch.Size([4, 1, 6])</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">output</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go">tensor([[[...]],</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go">    [[...]],</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="go">    [[...]],</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="go">    [[...]]])</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-166">166</a></span>
<span class="normal"><a href="#__codelineno-0-167">167</a></span>
<span class="normal"><a href="#__codelineno-0-168">168</a></span>
<span class="normal"><a href="#__codelineno-0-169">169</a></span>
<span class="normal"><a href="#__codelineno-0-170">170</a></span>
<span class="normal"><a href="#__codelineno-0-171">171</a></span>
<span class="normal"><a href="#__codelineno-0-172">172</a></span>
<span class="normal"><a href="#__codelineno-0-173">173</a></span>
<span class="normal"><a href="#__codelineno-0-174">174</a></span>
<span class="normal"><a href="#__codelineno-0-175">175</a></span>
<span class="normal"><a href="#__codelineno-0-176">176</a></span>
<span class="normal"><a href="#__codelineno-0-177">177</a></span>
<span class="normal"><a href="#__codelineno-0-178">178</a></span>
<span class="normal"><a href="#__codelineno-0-179">179</a></span>
<span class="normal"><a href="#__codelineno-0-180">180</a></span>
<span class="normal"><a href="#__codelineno-0-181">181</a></span>
<span class="normal"><a href="#__codelineno-0-182">182</a></span>
<span class="normal"><a href="#__codelineno-0-183">183</a></span>
<span class="normal"><a href="#__codelineno-0-184">184</a></span>
<span class="normal"><a href="#__codelineno-0-185">185</a></span>
<span class="normal"><a href="#__codelineno-0-186">186</a></span>
<span class="normal"><a href="#__codelineno-0-187">187</a></span>
<span class="normal"><a href="#__codelineno-0-188">188</a></span>
<span class="normal"><a href="#__codelineno-0-189">189</a></span>
<span class="normal"><a href="#__codelineno-0-190">190</a></span>
<span class="normal"><a href="#__codelineno-0-191">191</a></span>
<span class="normal"><a href="#__codelineno-0-192">192</a></span>
<span class="normal"><a href="#__codelineno-0-193">193</a></span>
<span class="normal"><a href="#__codelineno-0-194">194</a></span>
<span class="normal"><a href="#__codelineno-0-195">195</a></span>
<span class="normal"><a href="#__codelineno-0-196">196</a></span>
<span class="normal"><a href="#__codelineno-0-197">197</a></span>
<span class="normal"><a href="#__codelineno-0-198">198</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-166" name="__codelineno-0-166"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span> <span class="n">Tensor</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tensor</span><span class="p">:</span>
<a id="__codelineno-0-167" name="__codelineno-0-167"></a><span class="w">    </span><span class="sa">r</span><span class="sd">&quot;&quot;&quot;Forward pass though the encoder.</span>
<a id="__codelineno-0-168" name="__codelineno-0-168"></a>
<a id="__codelineno-0-169" name="__codelineno-0-169"></a><span class="sd">    Args:</span>
<a id="__codelineno-0-170" name="__codelineno-0-170"></a><span class="sd">        x (Tensor):</span>
<a id="__codelineno-0-171" name="__codelineno-0-171"></a><span class="sd">            the sequence fed to the positional encoder model (required).</span>
<a id="__codelineno-0-172" name="__codelineno-0-172"></a><span class="sd">            Shape **[sequence length, batch size, embed dim]**</span>
<a id="__codelineno-0-173" name="__codelineno-0-173"></a>
<a id="__codelineno-0-174" name="__codelineno-0-174"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-175" name="__codelineno-0-175"></a><span class="sd">        Tensor (Tensor), of shape **[sequence length, batch size, embed dim]**</span>
<a id="__codelineno-0-176" name="__codelineno-0-176"></a>
<a id="__codelineno-0-177" name="__codelineno-0-177"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-178" name="__codelineno-0-178"></a><span class="sd">        &gt;&gt;&gt; import pytorch_lightning as pl</span>
<a id="__codelineno-0-179" name="__codelineno-0-179"></a><span class="sd">        &gt;&gt;&gt; pl.seed_everything(42)</span>
<a id="__codelineno-0-180" name="__codelineno-0-180"></a><span class="sd">        42</span>
<a id="__codelineno-0-181" name="__codelineno-0-181"></a><span class="sd">        &gt;&gt;&gt; x = torch.ones((4,1,6)).float()</span>
<a id="__codelineno-0-182" name="__codelineno-0-182"></a><span class="sd">        &gt;&gt;&gt; pos_encoder = FourierPositionalEncoding(6, max_len=10)</span>
<a id="__codelineno-0-183" name="__codelineno-0-183"></a><span class="sd">        &gt;&gt;&gt; output = pos_encoder(x)</span>
<a id="__codelineno-0-184" name="__codelineno-0-184"></a><span class="sd">        &gt;&gt;&gt; output.shape</span>
<a id="__codelineno-0-185" name="__codelineno-0-185"></a><span class="sd">        torch.Size([4, 1, 6])</span>
<a id="__codelineno-0-186" name="__codelineno-0-186"></a><span class="sd">        &gt;&gt;&gt; output</span>
<a id="__codelineno-0-187" name="__codelineno-0-187"></a><span class="sd">        tensor([[[...]],</span>
<a id="__codelineno-0-188" name="__codelineno-0-188"></a><span class="sd">            [[...]],</span>
<a id="__codelineno-0-189" name="__codelineno-0-189"></a><span class="sd">            [[...]],</span>
<a id="__codelineno-0-190" name="__codelineno-0-190"></a><span class="sd">            [[...]]])</span>
<a id="__codelineno-0-191" name="__codelineno-0-191"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-192" name="__codelineno-0-192"></a>    <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_size</span><span class="p">:</span>
<a id="__codelineno-0-193" name="__codelineno-0-193"></a>        <span class="n">end_position</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">static_size</span>
<a id="__codelineno-0-194" name="__codelineno-0-194"></a>    <span class="k">else</span><span class="p">:</span>
<a id="__codelineno-0-195" name="__codelineno-0-195"></a>        <span class="n">end_position</span> <span class="o">=</span> <span class="n">x</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span>
<a id="__codelineno-0-196" name="__codelineno-0-196"></a>
<a id="__codelineno-0-197" name="__codelineno-0-197"></a>    <span class="n">x</span> <span class="o">=</span> <span class="n">x</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">pe</span><span class="p">[:</span><span class="n">end_position</span><span class="p">,</span> <span class="p">:]</span>
<a id="__codelineno-0-198" name="__codelineno-0-198"></a>    <span class="k">return</span> <span class="n">x</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.FourierPositionalEncoding.plot_encoding" class="doc doc-heading">
<code class="highlight language-python"><span class="n">plot_encoding</span><span class="p">(</span><span class="n">ax</span> <span class="o">=</span> <span class="kc">None</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-200">200</a></span>
<span class="normal"><a href="#__codelineno-0-201">201</a></span>
<span class="normal"><a href="#__codelineno-0-202">202</a></span>
<span class="normal"><a href="#__codelineno-0-203">203</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-200" name="__codelineno-0-200"></a><span class="k">def</span> <span class="nf">plot_encoding</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">ax</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<a id="__codelineno-0-201" name="__codelineno-0-201"></a>    <span class="k">if</span> <span class="n">ax</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-202" name="__codelineno-0-202"></a>        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Must pass an axis to plot on&quot;</span><span class="p">)</span>
<a id="__codelineno-0-203" name="__codelineno-0-203"></a>    <span class="n">ax</span><span class="o">.</span><span class="n">imwhow</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">pe</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">squeeze</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">())</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>

<div class="doc doc-object doc-class">



<h4 id="elfragmentador.model.nn_encoding.AASequenceEmbedding" class="doc doc-heading">
<code class="highlight language-python"><span class="n">elfragmentador</span><span class="o">.</span><span class="n">model</span><span class="o">.</span><span class="n">nn_encoding</span><span class="o">.</span><span class="n">AASequenceEmbedding</span><span class="p">(</span><span class="n">d_model</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">aa_names</span><span class="p">,</span> <span class="n">mod_names</span><span class="p">,</span> <span class="n">mod_pad_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">aa_pad_index</span> <span class="o">=</span> <span class="mi">0</span><span class="p">)</span></code>

</h4>


  <div class="doc doc-contents ">
      <p class="doc doc-class-bases">
        Bases: <code>torch.<span title="torch.nn">nn</span>.<span title="torch.nn.Module">Module</span></code></p>



          <details class="quote">
            <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-207">207</a></span>
<span class="normal"><a href="#__codelineno-0-208">208</a></span>
<span class="normal"><a href="#__codelineno-0-209">209</a></span>
<span class="normal"><a href="#__codelineno-0-210">210</a></span>
<span class="normal"><a href="#__codelineno-0-211">211</a></span>
<span class="normal"><a href="#__codelineno-0-212">212</a></span>
<span class="normal"><a href="#__codelineno-0-213">213</a></span>
<span class="normal"><a href="#__codelineno-0-214">214</a></span>
<span class="normal"><a href="#__codelineno-0-215">215</a></span>
<span class="normal"><a href="#__codelineno-0-216">216</a></span>
<span class="normal"><a href="#__codelineno-0-217">217</a></span>
<span class="normal"><a href="#__codelineno-0-218">218</a></span>
<span class="normal"><a href="#__codelineno-0-219">219</a></span>
<span class="normal"><a href="#__codelineno-0-220">220</a></span>
<span class="normal"><a href="#__codelineno-0-221">221</a></span>
<span class="normal"><a href="#__codelineno-0-222">222</a></span>
<span class="normal"><a href="#__codelineno-0-223">223</a></span>
<span class="normal"><a href="#__codelineno-0-224">224</a></span>
<span class="normal"><a href="#__codelineno-0-225">225</a></span>
<span class="normal"><a href="#__codelineno-0-226">226</a></span>
<span class="normal"><a href="#__codelineno-0-227">227</a></span>
<span class="normal"><a href="#__codelineno-0-228">228</a></span>
<span class="normal"><a href="#__codelineno-0-229">229</a></span>
<span class="normal"><a href="#__codelineno-0-230">230</a></span>
<span class="normal"><a href="#__codelineno-0-231">231</a></span>
<span class="normal"><a href="#__codelineno-0-232">232</a></span>
<span class="normal"><a href="#__codelineno-0-233">233</a></span>
<span class="normal"><a href="#__codelineno-0-234">234</a></span>
<span class="normal"><a href="#__codelineno-0-235">235</a></span>
<span class="normal"><a href="#__codelineno-0-236">236</a></span>
<span class="normal"><a href="#__codelineno-0-237">237</a></span>
<span class="normal"><a href="#__codelineno-0-238">238</a></span>
<span class="normal"><a href="#__codelineno-0-239">239</a></span>
<span class="normal"><a href="#__codelineno-0-240">240</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-207" name="__codelineno-0-207"></a><span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span>
<a id="__codelineno-0-208" name="__codelineno-0-208"></a>    <span class="bp">self</span><span class="p">,</span> <span class="n">d_model</span><span class="p">,</span> <span class="n">max_length</span><span class="p">,</span> <span class="n">aa_names</span><span class="p">,</span> <span class="n">mod_names</span><span class="p">,</span> <span class="n">mod_pad_index</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">aa_pad_index</span><span class="o">=</span><span class="mi">0</span>
<a id="__codelineno-0-209" name="__codelineno-0-209"></a><span class="p">):</span>
<a id="__codelineno-0-210" name="__codelineno-0-210"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing AASequenceEmbedding&quot;</span><span class="p">)</span>
<a id="__codelineno-0-211" name="__codelineno-0-211"></a>    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">()</span>
<a id="__codelineno-0-212" name="__codelineno-0-212"></a>    <span class="c1"># Positional information additions</span>
<a id="__codelineno-0-213" name="__codelineno-0-213"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">aa_names</span> <span class="o">=</span> <span class="n">aa_names</span>
<a id="__codelineno-0-214" name="__codelineno-0-214"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mod_names</span> <span class="o">=</span> <span class="n">mod_names</span>
<a id="__codelineno-0-215" name="__codelineno-0-215"></a>
<a id="__codelineno-0-216" name="__codelineno-0-216"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">position_embed</span> <span class="o">=</span> <span class="n">FourierPositionalEncoding</span><span class="p">(</span>
<a id="__codelineno-0-217" name="__codelineno-0-217"></a>        <span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span>
<a id="__codelineno-0-218" name="__codelineno-0-218"></a>        <span class="n">max_len</span><span class="o">=</span><span class="n">max_length</span><span class="p">,</span>
<a id="__codelineno-0-219" name="__codelineno-0-219"></a>    <span class="p">)</span>
<a id="__codelineno-0-220" name="__codelineno-0-220"></a>
<a id="__codelineno-0-221" name="__codelineno-0-221"></a>    <span class="c1"># Aminoacid embedding</span>
<a id="__codelineno-0-222" name="__codelineno-0-222"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span>
<a id="__codelineno-0-223" name="__codelineno-0-223"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_names</span><span class="p">),</span> <span class="n">d_model</span><span class="p">,</span> <span class="n">padding_idx</span><span class="o">=</span><span class="n">aa_pad_index</span>
<a id="__codelineno-0-224" name="__codelineno-0-224"></a>    <span class="p">)</span>
<a id="__codelineno-0-225" name="__codelineno-0-225"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-226" name="__codelineno-0-226"></a>        <span class="s2">&quot;Aminoacid embedding will use:&quot;</span>
<a id="__codelineno-0-227" name="__codelineno-0-227"></a>        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">aa_names</span><span class="p">[</span><span class="n">aa_pad_index</span><span class="p">]</span><span class="si">}</span><span class="s2"> as the padding index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-228" name="__codelineno-0-228"></a>    <span class="p">)</span>
<a id="__codelineno-0-229" name="__codelineno-0-229"></a>
<a id="__codelineno-0-230" name="__codelineno-0-230"></a>    <span class="c1"># PTM embedding</span>
<a id="__codelineno-0-231" name="__codelineno-0-231"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">mod_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span>
<a id="__codelineno-0-232" name="__codelineno-0-232"></a>        <span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod_names</span><span class="p">),</span> <span class="n">d_model</span><span class="p">,</span> <span class="n">padding_idx</span><span class="o">=</span><span class="n">mod_pad_index</span>
<a id="__codelineno-0-233" name="__codelineno-0-233"></a>    <span class="p">)</span>
<a id="__codelineno-0-234" name="__codelineno-0-234"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span>
<a id="__codelineno-0-235" name="__codelineno-0-235"></a>        <span class="s2">&quot;Modification embedding will use:&quot;</span>
<a id="__codelineno-0-236" name="__codelineno-0-236"></a>        <span class="sa">f</span><span class="s2">&quot; </span><span class="si">{</span><span class="n">mod_names</span><span class="p">[</span><span class="n">aa_pad_index</span><span class="p">]</span><span class="si">}</span><span class="s2"> as the padding index&quot;</span><span class="p">,</span>
<a id="__codelineno-0-237" name="__codelineno-0-237"></a>    <span class="p">)</span>
<a id="__codelineno-0-238" name="__codelineno-0-238"></a>
<a id="__codelineno-0-239" name="__codelineno-0-239"></a>    <span class="c1"># Weight Initialization</span>
<a id="__codelineno-0-240" name="__codelineno-0-240"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">init_weights</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>

  

  <div class="doc doc-children">





<h5 id="elfragmentador.model.nn_encoding.AASequenceEmbedding-attributes">Attributes</h5>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aa_names</span> <span class="o">=</span> <span class="n">aa_names</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_names" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod_names</span> <span class="o">=</span> <span class="n">mod_names</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.position_embed" class="doc doc-heading">
<code class="highlight language-python"><span class="n">position_embed</span> <span class="o">=</span> <span class="n">FourierPositionalEncoding</span><span class="p">(</span><span class="n">d_model</span><span class="o">=</span><span class="n">d_model</span><span class="p">,</span> <span class="n">max_len</span><span class="o">=</span><span class="n">max_length</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.aa_encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">aa_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_names</span><span class="p">),</span> <span class="n">d_model</span><span class="p">,</span> <span class="n">padding_idx</span><span class="o">=</span><span class="n">aa_pad_index</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<div class="doc doc-object doc-attribute">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.mod_encoder" class="doc doc-heading">
<code class="highlight language-python"><span class="n">mod_encoder</span> <span class="o">=</span> <span class="n">nn</span><span class="o">.</span><span class="n">Embedding</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod_names</span><span class="p">),</span> <span class="n">d_model</span><span class="p">,</span> <span class="n">padding_idx</span><span class="o">=</span><span class="n">mod_pad_index</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-instance-attribute"><code>instance-attribute</code></small>
  </span>

</h6>


  <div class="doc doc-contents ">
  </div>

</div>

<h5 id="elfragmentador.model.nn_encoding.AASequenceEmbedding-functions">Functions</h5>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.init_weights" class="doc doc-heading">
<code class="highlight language-python"><span class="n">init_weights</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="kc">None</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-242">242</a></span>
<span class="normal"><a href="#__codelineno-0-243">243</a></span>
<span class="normal"><a href="#__codelineno-0-244">244</a></span>
<span class="normal"><a href="#__codelineno-0-245">245</a></span>
<span class="normal"><a href="#__codelineno-0-246">246</a></span>
<span class="normal"><a href="#__codelineno-0-247">247</a></span>
<span class="normal"><a href="#__codelineno-0-248">248</a></span>
<span class="normal"><a href="#__codelineno-0-249">249</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-242" name="__codelineno-0-242"></a><span class="k">def</span> <span class="nf">init_weights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<a id="__codelineno-0-243" name="__codelineno-0-243"></a>    <span class="n">logger</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initializing weights on AASequenceEmbedding&quot;</span><span class="p">)</span>
<a id="__codelineno-0-244" name="__codelineno-0-244"></a>    <span class="n">initrange</span> <span class="o">=</span> <span class="mf">0.1</span>
<a id="__codelineno-0-245" name="__codelineno-0-245"></a>    <span class="n">ptm_initrange</span> <span class="o">=</span> <span class="n">initrange</span> <span class="o">*</span> <span class="mf">0.01</span>
<a id="__codelineno-0-246" name="__codelineno-0-246"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="n">initrange</span><span class="p">,</span> <span class="n">initrange</span><span class="p">)</span>
<a id="__codelineno-0-247" name="__codelineno-0-247"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_aa_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
<a id="__codelineno-0-248" name="__codelineno-0-248"></a>    <span class="n">torch</span><span class="o">.</span><span class="n">nn</span><span class="o">.</span><span class="n">init</span><span class="o">.</span><span class="n">uniform_</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">mod_encoder</span><span class="o">.</span><span class="n">weight</span><span class="p">,</span> <span class="o">-</span><span class="n">ptm_initrange</span><span class="p">,</span> <span class="n">ptm_initrange</span><span class="p">)</span>
<a id="__codelineno-0-249" name="__codelineno-0-249"></a>    <span class="bp">self</span><span class="o">.</span><span class="n">initial_mod_weights</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_encoder</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.forward" class="doc doc-heading">
<code class="highlight language-python"><span class="n">forward</span><span class="p">(</span><span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">)</span></code>

</h6>


  <div class="doc doc-contents ">

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-251">251</a></span>
<span class="normal"><a href="#__codelineno-0-252">252</a></span>
<span class="normal"><a href="#__codelineno-0-253">253</a></span>
<span class="normal"><a href="#__codelineno-0-254">254</a></span>
<span class="normal"><a href="#__codelineno-0-255">255</a></span>
<span class="normal"><a href="#__codelineno-0-256">256</a></span>
<span class="normal"><a href="#__codelineno-0-257">257</a></span>
<span class="normal"><a href="#__codelineno-0-258">258</a></span>
<span class="normal"><a href="#__codelineno-0-259">259</a></span>
<span class="normal"><a href="#__codelineno-0-260">260</a></span>
<span class="normal"><a href="#__codelineno-0-261">261</a></span>
<span class="normal"><a href="#__codelineno-0-262">262</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-251" name="__codelineno-0-251"></a><span class="k">def</span> <span class="nf">forward</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">seq</span><span class="p">,</span> <span class="n">mods</span><span class="p">):</span>
<a id="__codelineno-0-252" name="__codelineno-0-252"></a>    <span class="c1"># seq and mod are [N, S] shaped</span>
<a id="__codelineno-0-253" name="__codelineno-0-253"></a>    <span class="n">mods</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">pad</span><span class="p">(</span><span class="n">mods</span><span class="p">,</span> <span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">seq</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="o">-</span> <span class="n">mods</span><span class="o">.</span><span class="n">size</span><span class="p">(</span><span class="mi">1</span><span class="p">)),</span> <span class="s2">&quot;constant&quot;</span><span class="p">)</span>
<a id="__codelineno-0-254" name="__codelineno-0-254"></a>    <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span><span class="p">(</span><span class="n">seq</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-255" name="__codelineno-0-255"></a>    <span class="n">mods</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_encoder</span><span class="p">(</span><span class="n">mods</span><span class="o">.</span><span class="n">permute</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<a id="__codelineno-0-256" name="__codelineno-0-256"></a>    <span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">+</span> <span class="n">mods</span>
<a id="__codelineno-0-257" name="__codelineno-0-257"></a>
<a id="__codelineno-0-258" name="__codelineno-0-258"></a>    <span class="c1"># TODO consider if this line is needed, it is used in attention is all you need</span>
<a id="__codelineno-0-259" name="__codelineno-0-259"></a>    <span class="n">seq</span> <span class="o">=</span> <span class="n">seq</span> <span class="o">*</span> <span class="n">math</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span><span class="o">.</span><span class="n">num_embeddings</span><span class="p">)</span>
<a id="__codelineno-0-260" name="__codelineno-0-260"></a>    <span class="n">seq</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">position_embed</span><span class="p">(</span><span class="n">seq</span><span class="p">)</span>
<a id="__codelineno-0-261" name="__codelineno-0-261"></a>
<a id="__codelineno-0-262" name="__codelineno-0-262"></a>    <span class="k">return</span> <span class="n">seq</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>

<div class="doc doc-object doc-function">



<h6 id="elfragmentador.model.nn_encoding.AASequenceEmbedding.as_DataFrames" class="doc doc-heading">
<code class="highlight language-python"><span class="n">as_DataFrames</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]</span></code>

</h6>


  <div class="doc doc-contents ">
  
      <p>Returns the weights as data frames.</p>

  <table>
    <thead>
      <tr>
        <th><b>RETURNS</b></th>
        <th><b>DESCRIPTION</b></th>
      </tr>
    </thead>
    <tbody>
        <tr>
          <td>
              <span class="doc-returns-annotation">
                  <code><span title="typing.Tuple">Tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, <span title="pandas.DataFrame">DataFrame</span>]</code>
              </span>
          </td>
          <td class="doc-returns-details">
            <p>Tuple[DataFrame, DataFrame]:
A data frame of the aminoacid embeddings
and the modification embeddings</p>
          </td>
        </tr>
    </tbody>
  </table>

<p><strong>Examples:</strong></p>
    <div class="highlight"><pre><span></span><code><a id="__codelineno-0-1" name="__codelineno-0-1" href="#__codelineno-0-1"></a><span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">elfragmentador.config</span> <span class="kn">import</span> <span class="n">CONFIG</span>
<a id="__codelineno-0-2" name="__codelineno-0-2" href="#__codelineno-0-2"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">embed</span> <span class="o">=</span> <span class="n">AASequenceEmbedding</span><span class="p">(</span>
<a id="__codelineno-0-3" name="__codelineno-0-3" href="#__codelineno-0-3"></a><span class="gp">... </span>    <span class="n">d_model</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span>
<a id="__codelineno-0-4" name="__codelineno-0-4" href="#__codelineno-0-4"></a><span class="gp">... </span>    <span class="n">aa_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_aa_order</span><span class="p">,</span>
<a id="__codelineno-0-5" name="__codelineno-0-5" href="#__codelineno-0-5"></a><span class="gp">... </span>    <span class="n">mod_names</span><span class="o">=</span><span class="n">CONFIG</span><span class="o">.</span><span class="n">encoding_mod_order</span><span class="p">,</span>
<a id="__codelineno-0-6" name="__codelineno-0-6" href="#__codelineno-0-6"></a><span class="gp">... </span>    <span class="n">max_length</span><span class="o">=</span><span class="mi">100</span><span class="p">,)</span>
<a id="__codelineno-0-7" name="__codelineno-0-7" href="#__codelineno-0-7"></a><span class="gp">&gt;&gt;&gt; </span><span class="n">aa_embed</span><span class="p">,</span> <span class="n">mod_embed</span> <span class="o">=</span> <span class="n">embed</span><span class="o">.</span><span class="n">as_DataFrames</span><span class="p">()</span>
<a id="__codelineno-0-8" name="__codelineno-0-8" href="#__codelineno-0-8"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">aa_embed</span><span class="p">)</span>
<a id="__codelineno-0-9" name="__codelineno-0-9" href="#__codelineno-0-9"></a><span class="go">[&#39;__missing__&#39;, &#39;A&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;K&#39;,</span>
<a id="__codelineno-0-10" name="__codelineno-0-10" href="#__codelineno-0-10"></a><span class="go"> &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;,</span>
<a id="__codelineno-0-11" name="__codelineno-0-11" href="#__codelineno-0-11"></a><span class="go"> &#39;c_term&#39;, &#39;n_term&#39;]</span>
<a id="__codelineno-0-12" name="__codelineno-0-12" href="#__codelineno-0-12"></a><span class="gp">&gt;&gt;&gt; </span><span class="nb">list</span><span class="p">(</span><span class="n">mod_embed</span><span class="p">)</span>
<a id="__codelineno-0-13" name="__codelineno-0-13" href="#__codelineno-0-13"></a><span class="go">[None, &#39;[UNIMOD:4]&#39;, &#39;[UNIMOD:35]&#39;, &#39;[UNIMOD:21]&#39;, &#39;[UNIMOD:121]&#39;,</span>
<a id="__codelineno-0-14" name="__codelineno-0-14" href="#__codelineno-0-14"></a><span class="go">&#39;[UNIMOD:737]&#39;, &#39;[UNIMOD:1]&#39;, &#39;[UNIMOD:34]&#39;, &#39;[UNIMOD:36]&#39;,</span>
<a id="__codelineno-0-15" name="__codelineno-0-15" href="#__codelineno-0-15"></a><span class="go">&#39;[UNIMOD:37]&#39;, &#39;[UNIMOD:354]&#39;, &#39;[UNIMOD:7]&#39;, &#39;__unknown1__&#39;]</span>
</code></pre></div>

      <details class="quote">
        <summary>Source code in <code>elfragmentador/model/nn_encoding.py</code></summary>
        <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"><a href="#__codelineno-0-264">264</a></span>
<span class="normal"><a href="#__codelineno-0-265">265</a></span>
<span class="normal"><a href="#__codelineno-0-266">266</a></span>
<span class="normal"><a href="#__codelineno-0-267">267</a></span>
<span class="normal"><a href="#__codelineno-0-268">268</a></span>
<span class="normal"><a href="#__codelineno-0-269">269</a></span>
<span class="normal"><a href="#__codelineno-0-270">270</a></span>
<span class="normal"><a href="#__codelineno-0-271">271</a></span>
<span class="normal"><a href="#__codelineno-0-272">272</a></span>
<span class="normal"><a href="#__codelineno-0-273">273</a></span>
<span class="normal"><a href="#__codelineno-0-274">274</a></span>
<span class="normal"><a href="#__codelineno-0-275">275</a></span>
<span class="normal"><a href="#__codelineno-0-276">276</a></span>
<span class="normal"><a href="#__codelineno-0-277">277</a></span>
<span class="normal"><a href="#__codelineno-0-278">278</a></span>
<span class="normal"><a href="#__codelineno-0-279">279</a></span>
<span class="normal"><a href="#__codelineno-0-280">280</a></span>
<span class="normal"><a href="#__codelineno-0-281">281</a></span>
<span class="normal"><a href="#__codelineno-0-282">282</a></span>
<span class="normal"><a href="#__codelineno-0-283">283</a></span>
<span class="normal"><a href="#__codelineno-0-284">284</a></span>
<span class="normal"><a href="#__codelineno-0-285">285</a></span>
<span class="normal"><a href="#__codelineno-0-286">286</a></span>
<span class="normal"><a href="#__codelineno-0-287">287</a></span>
<span class="normal"><a href="#__codelineno-0-288">288</a></span>
<span class="normal"><a href="#__codelineno-0-289">289</a></span>
<span class="normal"><a href="#__codelineno-0-290">290</a></span>
<span class="normal"><a href="#__codelineno-0-291">291</a></span>
<span class="normal"><a href="#__codelineno-0-292">292</a></span>
<span class="normal"><a href="#__codelineno-0-293">293</a></span>
<span class="normal"><a href="#__codelineno-0-294">294</a></span>
<span class="normal"><a href="#__codelineno-0-295">295</a></span>
<span class="normal"><a href="#__codelineno-0-296">296</a></span></pre></div></td><td class="code"><div><pre><span></span><code><a id="__codelineno-0-264" name="__codelineno-0-264"></a><span class="k">def</span> <span class="nf">as_DataFrames</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">DataFrame</span><span class="p">]:</span>
<a id="__codelineno-0-265" name="__codelineno-0-265"></a><span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<a id="__codelineno-0-266" name="__codelineno-0-266"></a><span class="sd">    Returns the weights as data frames.</span>
<a id="__codelineno-0-267" name="__codelineno-0-267"></a>
<a id="__codelineno-0-268" name="__codelineno-0-268"></a><span class="sd">    Returns:</span>
<a id="__codelineno-0-269" name="__codelineno-0-269"></a><span class="sd">        Tuple[DataFrame, DataFrame]:</span>
<a id="__codelineno-0-270" name="__codelineno-0-270"></a><span class="sd">            A data frame of the aminoacid embeddings</span>
<a id="__codelineno-0-271" name="__codelineno-0-271"></a><span class="sd">            and the modification embeddings</span>
<a id="__codelineno-0-272" name="__codelineno-0-272"></a>
<a id="__codelineno-0-273" name="__codelineno-0-273"></a><span class="sd">    Examples:</span>
<a id="__codelineno-0-274" name="__codelineno-0-274"></a><span class="sd">        &gt;&gt;&gt; from elfragmentador.config import CONFIG</span>
<a id="__codelineno-0-275" name="__codelineno-0-275"></a><span class="sd">        &gt;&gt;&gt; embed = AASequenceEmbedding(</span>
<a id="__codelineno-0-276" name="__codelineno-0-276"></a><span class="sd">        ...     d_model=20,</span>
<a id="__codelineno-0-277" name="__codelineno-0-277"></a><span class="sd">        ...     aa_names=CONFIG.encoding_aa_order,</span>
<a id="__codelineno-0-278" name="__codelineno-0-278"></a><span class="sd">        ...     mod_names=CONFIG.encoding_mod_order,</span>
<a id="__codelineno-0-279" name="__codelineno-0-279"></a><span class="sd">        ...     max_length=100,)</span>
<a id="__codelineno-0-280" name="__codelineno-0-280"></a><span class="sd">        &gt;&gt;&gt; aa_embed, mod_embed = embed.as_DataFrames()</span>
<a id="__codelineno-0-281" name="__codelineno-0-281"></a><span class="sd">        &gt;&gt;&gt; list(aa_embed)</span>
<a id="__codelineno-0-282" name="__codelineno-0-282"></a><span class="sd">        [&#39;__missing__&#39;, &#39;A&#39;, &#39;C&#39;, &#39;D&#39;, &#39;E&#39;, &#39;F&#39;, &#39;G&#39;, &#39;H&#39;, &#39;I&#39;, &#39;K&#39;,</span>
<a id="__codelineno-0-283" name="__codelineno-0-283"></a><span class="sd">         &#39;L&#39;, &#39;M&#39;, &#39;N&#39;, &#39;P&#39;, &#39;Q&#39;, &#39;R&#39;, &#39;S&#39;, &#39;T&#39;, &#39;V&#39;, &#39;W&#39;, &#39;X&#39;, &#39;Y&#39;,</span>
<a id="__codelineno-0-284" name="__codelineno-0-284"></a><span class="sd">         &#39;c_term&#39;, &#39;n_term&#39;]</span>
<a id="__codelineno-0-285" name="__codelineno-0-285"></a><span class="sd">        &gt;&gt;&gt; list(mod_embed)</span>
<a id="__codelineno-0-286" name="__codelineno-0-286"></a><span class="sd">        [None, &#39;[UNIMOD:4]&#39;, &#39;[UNIMOD:35]&#39;, &#39;[UNIMOD:21]&#39;, &#39;[UNIMOD:121]&#39;,</span>
<a id="__codelineno-0-287" name="__codelineno-0-287"></a><span class="sd">        &#39;[UNIMOD:737]&#39;, &#39;[UNIMOD:1]&#39;, &#39;[UNIMOD:34]&#39;, &#39;[UNIMOD:36]&#39;,</span>
<a id="__codelineno-0-288" name="__codelineno-0-288"></a><span class="sd">        &#39;[UNIMOD:37]&#39;, &#39;[UNIMOD:354]&#39;, &#39;[UNIMOD:7]&#39;, &#39;__unknown1__&#39;]</span>
<a id="__codelineno-0-289" name="__codelineno-0-289"></a><span class="sd">    &quot;&quot;&quot;</span>
<a id="__codelineno-0-290" name="__codelineno-0-290"></a>    <span class="n">df_aa</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">aa_encoder</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-291" name="__codelineno-0-291"></a>    <span class="n">df_aa</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">aa_names</span>
<a id="__codelineno-0-292" name="__codelineno-0-292"></a>
<a id="__codelineno-0-293" name="__codelineno-0-293"></a>    <span class="n">df_mod</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">mod_encoder</span><span class="o">.</span><span class="n">weight</span><span class="o">.</span><span class="n">detach</span><span class="p">()</span><span class="o">.</span><span class="n">cpu</span><span class="p">()</span><span class="o">.</span><span class="n">numpy</span><span class="p">()</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<a id="__codelineno-0-294" name="__codelineno-0-294"></a>    <span class="n">df_mod</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">mod_names</span>
<a id="__codelineno-0-295" name="__codelineno-0-295"></a>
<a id="__codelineno-0-296" name="__codelineno-0-296"></a>    <span class="k">return</span> <span class="n">df_aa</span><span class="p">,</span> <span class="n">df_mod</span>
</code></pre></div></td></tr></table></div>
      </details>
  </div>

</div>



  </div>

  </div>

</div>




  </div>

  </div>

</div>


  




                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
    
    <nav class="md-footer__inner md-grid" aria-label="Footer" >
      
        
        <a href="../../quickstart/" class="md-footer__link md-footer__link--prev" aria-label="Previous: Quickstart" rel="prev">
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
          </div>
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Previous
              </span>
              Quickstart
            </div>
          </div>
        </a>
      
      
        
        <a href="../../CLI%20reference/cli/" class="md-footer__link md-footer__link--next" aria-label="Next: Usage of the multiple command line interface options ..." rel="next">
          <div class="md-footer__title">
            <div class="md-ellipsis">
              <span class="md-footer__direction">
                Next
              </span>
              Usage of the multiple command line interface options ...
            </div>
          </div>
          <div class="md-footer__button md-icon">
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4Z"/></svg>
          </div>
        </a>
      
    </nav>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../..", "features": [], "search": "../../assets/javascripts/workers/search.16e2a7d4.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version.title": "Select version"}}</script>
    
    
      <script src="../../assets/javascripts/bundle.5a2dcb6a.min.js"></script>
      
    
    
  </body>
</html>